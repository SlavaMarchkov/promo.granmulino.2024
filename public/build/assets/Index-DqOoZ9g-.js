import{u as le,a as ae,b as oe,d as V,r as R,e as de,A as N,c,f as e,g as a,w as o,F as U,h as $,t as d,i as p,j as i,k as ie,o as u,l as ne,m as re,n as ue,p as h,q as v,s as ce,v as me,T as _e,x as pe,R as fe,U as L,E as he,D as ve}from"./app-BPdZrYo3.js";import{u as be}from"./useHttpService-BNZ4gPHT.js";import{u as ye}from"./useArrayHandlers-D3DGTb70.js";import{_ as we,a as g}from"./TheFilter-BiC8Pmxx.js";import{_ as M}from"./Modal-BJimFcRn.js";import{_ as Ee,a as A}from"./TdButton-DMXdDj8-.js";import{_ as Ve}from"./TheCheckbox-CGFEuL4J.js";import{_ as x}from"./TheBadge-DfL1MJO3.js";const Ne={class:"row mb-2"},Ue={class:"col-12"},ge={class:"col-md-4 mb-2"},Se={class:"col-md-4 mb-2"},ke={class:"col-md-4 mb-2"},Ae={class:"col-md-4 mb-2"},xe={class:"col-md-4 mb-2"},Ie={class:"row mb-4"},Be={class:"col-12"},De={class:"card"},Re={class:"card-body pb-0"},$e={key:0,class:"table-responsive"},Le={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Me={scope:"row"},He={class:"text-start"},Te={class:"text-start"},Ce={class:"text-start"},Fe={class:"text-start"},Pe={class:"text-start"},qe={key:1,class:"mt-3 text-center lead"},Ke={class:"fw-bold"},Oe={key:0},je={key:1},ze={class:"row g-3"},Ge={class:"col-12"},Je={class:"col-12"},Qe={class:"col-12"},We={class:"col-12"},Xe={class:"col-12"},Ye={class:"col-12"},Ze={class:"form-check"},et=["checked"],tt=e("label",{class:"form-check-label",for:"is-active"}," Работает? ",-1),st={key:0},lt={key:1},at={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},ot=e("th",{style:{width:"35%"}},"ID",-1),dt=e("th",null,"Фамилия",-1),it=e("th",null,"Имя",-1),nt=e("th",null,"Отчество",-1),rt=e("th",null,"Системное имя",-1),ut=e("th",null,"Email",-1),ct=e("th",null,"Работает?",-1),mt=e("th",null,"Админ?",-1),_t=e("th",null,"Последний вход",-1),pt=e("span",null,null,-1),gt={__name:"Index",setup(ft){const b=le(),S=ae(),H=oe(),m=ye(),{get:T,post:C,update:F,destroy:P}=be(),q=H.getUser.role,I=V(()=>q===fe.SUPER_ADMIN),K=V(()=>I?L.concat(he,ve):L),y=()=>({firstName:"",lastName:"",middleName:"",displayName:"",email:"",password:"",isActive:!0}),t=R({users:[],user:y(),isEditing:!1}),r=R({firstName:"",lastName:"",middleName:"",email:"",isActive:!1});let _=null,f=null;function w(){t.isEditing=!1,t.user=y(),document.activeElement&&document.activeElement.blur()}de(async()=>{await E(),_=new bootstrap.Modal(document.getElementById("modalPopUp")),_._element.addEventListener("hide.bs.modal",w)});const E=async()=>{const{data:n}=await T(N.USER);t.users=n.users},B=n=>t.users.find(l=>l.id===n),O=()=>{b.clear(),t.isEditing=!1,t.user=y(),_.show()},j=n=>{b.clear(),t.isEditing=!0,t.user=B(n),_.show()},z=n=>{f=new bootstrap.Modal(document.getElementById("viewModalPopUp")),t.user=B(n),f.show(),f._element.addEventListener("hide.bs.modal",w)},G=()=>{_.hide(),_._element.removeEventListener("hide.bs.modal",w)},J=()=>{f.hide(),f._element.removeEventListener("hide.bs.modal",w)},Q=()=>{m.resetSearchKeys(r),m.resetSortKeys()},W=async()=>{if(t.isEditing){const n=await F(`${N.USER}/${t.user.id}`,t.user);n&&n.status==="success"&&(b.clear(),_.hide(),await E())}else{const n=await C(N.USER,t.user);n&&n.status==="success"&&(b.clear(),t.user=y(),_.hide(),m.resetSearchKeys(r),m.resetSortKeys("id",!1),await E())}},X=async n=>{if(confirm("Точно удалить пользователя? Уверены?")){const l=await P(`${N.USER}/${n}`);l&&l.status==="success"&&await E()}},Y=V(()=>m.sortArray(t.users)),k=V(()=>m.filterArray(Y.value,r));return(n,l)=>{const Z=ie("RouterLink");return u(),c(U,null,[e("div",{class:"row mb-4"},[e("div",{class:"col-12"},[e("button",{class:"btn btn-primary",type:"button",onClick:O}," Новый пользователь ")])]),e("div",Ne,[e("div",Ue,[a(we,{onResetFilter:Q},{default:o(()=>[e("div",ge,[a(g,{modelValue:r.lastName,"onUpdate:modelValue":l[0]||(l[0]=s=>r.lastName=s),placeholder:"Поиск по фамилии"},{default:o(()=>[i("Фамилия")]),_:1},8,["modelValue"])]),e("div",Se,[a(g,{modelValue:r.firstName,"onUpdate:modelValue":l[1]||(l[1]=s=>r.firstName=s),placeholder:"Поиск по имени"},{default:o(()=>[i("Имя")]),_:1},8,["modelValue"])]),e("div",ke,[a(g,{modelValue:r.middleName,"onUpdate:modelValue":l[2]||(l[2]=s=>r.middleName=s),placeholder:"Поиск по отчеству"},{default:o(()=>[i("Отчество")]),_:1},8,["modelValue"])]),e("div",Ae,[a(g,{modelValue:r.email,"onUpdate:modelValue":l[3]||(l[3]=s=>r.email=s),placeholder:"Поиск по email"},{default:o(()=>[i("Email")]),_:1},8,["modelValue"])]),e("div",xe,[a(Ve,{id:"is_active",modelValue:r.isActive,"onUpdate:modelValue":l[4]||(l[4]=s=>r.isActive=s)},{default:o(()=>[i(" Работает? ")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Ie,[e("div",Be,[e("div",De,[e("div",Re,[k.value.length>0?(u(),c("div",$e,[e("table",Le,[e("thead",null,[e("tr",null,[(u(!0),c(U,null,$(K.value,({column:s,label:ee,sortable:te,is_num:D,width:se})=>(u(),ne(Ee,{key:s,column:s,"is-numeric":D,"sort-by-asc":p(m).sortBy.asc,"sort-by-column":p(m).sortBy.column===s,sortable:te,width:se,onSetSort:ht=>p(m).setSort(s,D)},{default:o(()=>[i(d(ee),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(u(!0),c(U,null,$(k.value,s=>(u(),c("tr",{key:s.id},[e("th",Me,d(s.id),1),e("td",He,[a(Z,{to:{name:"User.View",params:{id:s.id}}},{default:o(()=>[i(d(s.lastName),1)]),_:2},1032,["to"])]),e("td",Te,d(s.firstName),1),e("td",Ce,d(s.middleName),1),e("td",Fe,d(s.email),1),e("td",Pe,d(s.loggedInAt),1),e("td",null,[a(x,{"is-active":s.isActive},null,8,["is-active"])]),a(A,{id:s.id,intent:"view",onRunButtonHandler:z},{default:o(()=>[i("View ")]),_:2},1032,["id"]),I.value?(u(),c(U,{key:0},[a(A,{id:s.id,intent:"edit",onRunButtonHandler:j},{default:o(()=>[i("Edit ")]),_:2},1032,["id"]),a(A,{id:s.id,intent:"delete",onRunButtonHandler:X},{default:o(()=>[i("Delete ")]),_:2},1032,["id"])],64)):re("",!0)]))),128))])])])):(u(),c("p",qe,d(p(S).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[i("Всего записей: "),e("span",Ke,d(k.value.length),1)])])])])]),a(M,{id:"modalPopUp","close-func":G,"custom-classes":[""]},{title:o(()=>[t.isEditing?(u(),c("span",Oe,[i("Редактирование пользователя "),e("b",null,d(t.user.fullName),1)])):(u(),c("span",je,"Добавление пользователя"))]),body:o(()=>[a(ue),e("div",ze,[e("div",Ge,[a(h,{for:"last-name",required:""},{default:o(()=>[i("Фамилия")]),_:1}),a(v,{id:"last-name",modelValue:t.user.lastName,"onUpdate:modelValue":l[5]||(l[5]=s=>t.user.lastName=s),placeholder:"Например: Овчинникова",type:"text"},null,8,["modelValue"])]),e("div",Je,[a(h,{for:"first-name",required:""},{default:o(()=>[i("Имя")]),_:1}),a(v,{id:"first-name",modelValue:t.user.firstName,"onUpdate:modelValue":l[6]||(l[6]=s=>t.user.firstName=s),placeholder:"Например: Екатерина",type:"text"},null,8,["modelValue"])]),e("div",Qe,[a(h,{for:"middle-name"},{default:o(()=>[i("Отчество")]),_:1}),a(v,{id:"middle-name",modelValue:t.user.middleName,"onUpdate:modelValue":l[7]||(l[7]=s=>t.user.middleName=s),placeholder:"Например: Александровна",type:"text"},null,8,["modelValue"])]),e("div",We,[a(h,{for:"email",required:""},{default:o(()=>[i("Email")]),_:1}),a(v,{id:"email",modelValue:t.user.email,"onUpdate:modelValue":l[8]||(l[8]=s=>t.user.email=s),placeholder:"Например: 508@altan.ru",type:"email"},null,8,["modelValue"])]),e("div",Xe,[a(h,{for:"password",required:!t.isEditing},{default:o(()=>[i(d(t.isEditing?"Пароль (оставьте пустым, если не изменяете пароль)":"Пароль"),1)]),_:1},8,["required"]),a(v,{id:"password",modelValue:t.user.password,"onUpdate:modelValue":l[9]||(l[9]=s=>t.user.password=s),type:"password"},null,8,["modelValue"])]),e("div",Ye,[e("div",Ze,[ce(e("input",{id:"is-active","onUpdate:modelValue":l[10]||(l[10]=s=>t.user.isActive=s),checked:t.user.isActive,class:"form-check-input",type:"checkbox"},null,8,et),[[me,t.user.isActive]]),tt])])])]),footer:o(()=>[a(_e,{class:pe([t.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:p(S).isButtonDisabled,loading:p(S).isButtonDisabled,type:"button",onClick:W},{default:o(()=>[t.isEditing?(u(),c("span",st,"Сохранить")):(u(),c("span",lt,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(M,{id:"viewModalPopUp","close-func":J,"custom-classes":[""]},{title:o(()=>[i(" Просмотр пользователя "),e("b",null,d(t.user.fullName),1)]),body:o(()=>[e("table",at,[e("tbody",null,[e("tr",null,[ot,e("td",null,d(t.user.id),1)]),e("tr",null,[dt,e("td",null,d(t.user.lastName),1)]),e("tr",null,[it,e("td",null,d(t.user.firstName),1)]),e("tr",null,[nt,e("td",null,d(t.user.middleName),1)]),e("tr",null,[rt,e("td",null,d(t.user.fullName),1)]),e("tr",null,[ut,e("td",null,d(t.user.email),1)]),e("tr",null,[ct,e("td",null,[a(x,{"is-active":t.user.isActive},null,8,["is-active"])])]),e("tr",null,[mt,e("td",null,[a(x,{"is-active":t.user.isAdmin},null,8,["is-active"])])]),e("tr",null,[_t,e("td",null,d(t.user.loggedInAt),1)])])])]),footer:o(()=>[pt]),_:1})],64)}}};export{gt as default};
