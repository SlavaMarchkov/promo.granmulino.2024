import{u as nt,a as it,b as dt,d as S,r as $,e as rt,A as b,c,f as t,g as a,w as l,F as x,h as k,t as i,i as p,j as d,k as ct,o as r,l as A,m as ut,n as _t,p as h,q as v,s as mt,H as yt,T as pt,x as ht,R as ft,I as H,E as P,D as gt,O as bt,J as vt}from"./app-CvDqXEOd.js";import{u as wt}from"./useHttpService-Cv4QBHm9.js";import{u as Et}from"./useArrayHandlers-Dmi2z74m.js";import{_ as Vt,a as B}from"./TheFilter-VzPJfpVU.js";import{_ as M}from"./Modal-BjKEkhVV.js";import{_ as It,a as R}from"./TdButton-DoOWIy6T.js";const St={class:"row mb-2"},xt={class:"col-12"},Ct={class:"col-md-4 mb-2"},Ut={class:"col-md-4 mb-2"},kt={class:"col-md-4 mb-2"},Bt={class:"row mb-4"},Rt={class:"col-12"},Lt={class:"card"},Dt={class:"card-body pb-0"},Nt={key:0,class:"table-responsive"},Tt={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},$t={scope:"row"},At={class:"text-start"},Ht={class:"text-start"},Pt={class:"text-start"},Mt={class:"text-start"},Ft={class:"text-start"},Ot={key:1,class:"mt-3 text-center lead"},Yt={class:"fw-bold"},Kt={key:0},qt={key:1},jt={class:"row g-3"},Wt={class:"col-12"},zt={class:"col-6"},Gt={class:"col-6"},Jt={class:"col-6"},Qt={class:"col-6"},Xt={class:"col-12"},Zt=t("option",{disabled:"",selected:"",value:""},"-- Выберите регион --",-1),te=["value"],ee={key:0},se={key:1},oe={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},ae=t("th",{style:{width:"30%"}},"ID",-1),le=t("th",null,"Название",-1),ne=t("th",null,"Регион",-1),ie=t("th",null,"Широта",-1),de=t("th",null,"Долгота",-1),re=t("th",null,"Страна",-1),ce=t("th",null,"Локация",-1),ue=t("span",null,null,-1),ve={__name:"Index",setup(_e){const w=nt(),C=it(),F=dt(),u=Et(),{get:L,post:O,update:Y,destroy:K}=wt(),q=F.getUser.role,D=S(()=>q===ft.SUPER_ADMIN),j=S(()=>D?H.concat(P,gt):H.concat(P)),E=()=>({name:"",regionId:"",longitude:"",latitude:"",country:"",state:""}),e=$({cities:[],regions:[],city:E(),isEditing:!1}),_=$({name:"",state:"",regionName:""});let m=null,f=null;function V(){e.isEditing=!1,e.city=E()}rt(async()=>{await I(),await W(),m=new bootstrap.Modal(document.getElementById("modalPopUp")),m._element.addEventListener("hide.bs.modal",V)});const I=async()=>{const{data:n}=await L(b.CITY);e.cities=n.cities},N=n=>e.cities.find(o=>o.id===n),W=async()=>{const{data:n}=await L(b.REGION);e.regions=n.regions},z=()=>{w.clear(),e.isEditing=!1,e.city=E(),m.show()},G=n=>{w.clear(),e.isEditing=!0,e.city=N(n),m.show()},J=n=>{f=new bootstrap.Modal(document.getElementById("viewModalPopUp")),e.city=N(n),f.show(),f._element.addEventListener("hide.bs.modal",V)},Q=()=>{m.hide(),m._element.removeEventListener("hide.bs.modal",V)},X=()=>{f.hide(),f._element.removeEventListener("hide.bs.modal",V)},Z=()=>{u.resetSearchKeys(_),u.resetSortKeys()},tt=async()=>{if(e.isEditing){const n=await Y(`${b.CITY}/${e.city.id}`,e.city);n&&n.status==="success"&&(w.clear(),m.hide(),await I())}else{const n=await O(b.CITY,e.city);n&&n.status==="success"&&(w.clear(),e.city=E(),m.hide(),u.resetSearchKeys(_),u.resetSortKeys("id",!1),await I())}},et=async n=>{if(confirm("Точно удалить город? Уверены?")){const o=await K(`${b.CITY}/${n}`);o&&o.status==="success"&&await I()}},st=S(()=>u.sortArray(e.cities)),U=S(()=>u.filterArray(st.value,_)),ot=async n=>{const o=new URL(bt);o.searchParams.set("q",n),o.searchParams.set("appid",vt);try{const y=(await(await fetch(o.toString())).json())[0];e.city.latitude=y.lat,e.city.longitude=y.lon,e.city.country=y.country,e.city.state=y.state}catch(g){alert("Error: "+g.message)}};return(n,o)=>{const g=ct("RouterLink");return r(),c(x,null,[t("div",{class:"row mb-4"},[t("div",{class:"col-12"},[t("button",{class:"btn btn-primary",type:"button",onClick:z}," Новый город ")])]),t("div",St,[t("div",xt,[a(Vt,{onResetFilter:Z},{default:l(()=>[t("div",Ct,[a(B,{modelValue:_.name,"onUpdate:modelValue":o[0]||(o[0]=s=>_.name=s),placeholder:"Поиск по названию города"},{default:l(()=>[d("Город ")]),_:1},8,["modelValue"])]),t("div",Ut,[a(B,{modelValue:_.state,"onUpdate:modelValue":o[1]||(o[1]=s=>_.state=s),placeholder:"Поиск по локации (EN)"},{default:l(()=>[d("Локация ")]),_:1},8,["modelValue"])]),t("div",kt,[a(B,{modelValue:_.regionName,"onUpdate:modelValue":o[2]||(o[2]=s=>_.regionName=s),placeholder:"Поиск по названию региона"},{default:l(()=>[d("Регион ")]),_:1},8,["modelValue"])])]),_:1})])]),t("div",Bt,[t("div",Rt,[t("div",Lt,[t("div",Dt,[U.value.length>0?(r(),c("div",Nt,[t("table",Tt,[t("thead",null,[t("tr",null,[(r(!0),c(x,null,k(j.value,({column:s,label:y,sortable:at,is_num:T,width:lt})=>(r(),A(It,{key:s,column:s,"is-numeric":T,"sort-by-asc":p(u).sortBy.asc,"sort-by-column":p(u).sortBy.column===s,sortable:at,width:lt,onSetSort:me=>p(u).setSort(s,T)},{default:l(()=>[d(i(y),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),t("tbody",null,[(r(!0),c(x,null,k(U.value,s=>(r(),c("tr",{key:s.id},[t("th",$t,i(s.id),1),t("td",At,[a(g,{to:{name:"City.View",params:{id:s.id}}},{default:l(()=>[d(i(s.name),1)]),_:2},1032,["to"])]),t("td",Ht,i(s.latitude),1),t("td",Pt,i(s.longitude),1),t("td",Mt,i(s.state),1),t("td",Ft,[a(g,{to:{name:"Region.View",params:{id:s.regionId}}},{default:l(()=>[d(i(s.regionName),1)]),_:2},1032,["to"])]),a(R,{id:s.id,intent:"view",onRunButtonHandler:J},{default:l(()=>[d("View ")]),_:2},1032,["id"]),a(R,{id:s.id,intent:"edit",onRunButtonHandler:G},{default:l(()=>[d("Edit ")]),_:2},1032,["id"]),D.value?(r(),A(R,{key:0,id:s.id,intent:"delete",onRunButtonHandler:et},{default:l(()=>[d("Delete ")]),_:2},1032,["id"])):ut("",!0)]))),128))])])])):(r(),c("p",Ot,i(p(C).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),t("p",null,[d("Всего записей: "),t("span",Yt,i(U.value.length),1)])])])])]),a(M,{id:"modalPopUp","close-func":Q,"custom-classes":[""]},{title:l(()=>[e.isEditing?(r(),c("span",Kt,[d("Редактирование города "),t("b",null,i(e.city.name),1)])):(r(),c("span",qt,"Добавление города"))]),body:l(()=>[a(_t),t("div",jt,[t("div",Wt,[a(h,{for:"name",required:""},{default:l(()=>[d("Наименование города")]),_:1}),a(v,{id:"name",modelValue:e.city.name,"onUpdate:modelValue":o[3]||(o[3]=s=>e.city.name=s),onBlur:o[4]||(o[4]=s=>ot(e.city.name)),placeholder:"Например: Новосибирск",type:"text"},null,8,["modelValue"])]),t("div",zt,[a(h,{for:"latitude"},{default:l(()=>[d("Геокоординаты. Широта")]),_:1}),a(v,{id:"latitude",modelValue:e.city.latitude,"onUpdate:modelValue":o[5]||(o[5]=s=>e.city.latitude=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",Gt,[a(h,{for:"longitude"},{default:l(()=>[d("Геокоординаты. Долгота")]),_:1}),a(v,{id:"longitude",modelValue:e.city.longitude,"onUpdate:modelValue":o[6]||(o[6]=s=>e.city.longitude=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",Jt,[a(h,{for:"country"},{default:l(()=>[d("Страна")]),_:1}),a(v,{id:"country",modelValue:e.city.country,"onUpdate:modelValue":o[7]||(o[7]=s=>e.city.country=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",Qt,[a(h,{for:"state"},{default:l(()=>[d("Локация")]),_:1}),a(v,{id:"state",modelValue:e.city.state,"onUpdate:modelValue":o[8]||(o[8]=s=>e.city.state=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",Xt,[a(h,{for:"region_id",required:""},{default:l(()=>[d("Регион")]),_:1}),mt(t("select",{id:"region_id","onUpdate:modelValue":o[9]||(o[9]=s=>e.city.regionId=s),class:"form-select"},[Zt,(r(!0),c(x,null,k(e.regions,s=>(r(),c("option",{key:s.id,value:s.id},i(s.name),9,te))),128))],512),[[yt,e.city.regionId]])])])]),footer:l(()=>[a(pt,{class:ht([e.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:p(C).isButtonDisabled,loading:p(C).isButtonDisabled,type:"button",onClick:tt},{default:l(()=>[e.isEditing?(r(),c("span",ee,"Сохранить")):(r(),c("span",se,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(M,{id:"viewModalPopUp","close-func":X,"custom-classes":["modal-dialog-scrollable"]},{title:l(()=>[d(" Просмотр города "),t("b",null,i(e.city.name),1)]),body:l(()=>[t("table",oe,[t("tbody",null,[t("tr",null,[ae,t("td",null,i(e.city.id),1)]),t("tr",null,[le,t("td",null,i(e.city.name),1)]),t("tr",null,[ne,t("td",null,i(e.city.regionName),1)]),t("tr",null,[ie,t("td",null,i(e.city.latitude),1)]),t("tr",null,[de,t("td",null,i(e.city.longitude),1)]),t("tr",null,[re,t("td",null,i(e.city.country),1)]),t("tr",null,[ce,t("td",null,i(e.city.state),1)])])])]),footer:l(()=>[ue]),_:1})],64)}}};export{ve as default};
