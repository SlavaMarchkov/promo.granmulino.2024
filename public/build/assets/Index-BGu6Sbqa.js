import{d as w,o as n,c as d,f as e,Y as re,u as ce,a as ue,b as _e,r as N,e as me,A as R,s as h,C as pe,g as o,w as i,T as q,F as v,h as E,t as r,i as f,j as a,k as he,Z as ve,l as fe,x as K,m as ye,n as be,p as g,q as Ee,I as B,M as ge,v as z,R as we,$ as O,E as Ve,D as ke}from"./app-CcRn7-yu.js";import{u as Se}from"./useHttpService-F7Gi0evP.js";import{u as Re}from"./useArrayHandlers-HI3WadKX.js";import{_ as Y}from"./TheCheckbox-B4dmdo2T.js";import{_ as Ie,a as T}from"./TheFilter-CSf9971F.js";import{_ as De,a as M}from"./TdButton-BuTkbrOp.js";import{_ as I}from"./TheBadge-BlMSyGe5.js";import{_ as j}from"./Modal-BjgBNvva.js";const Ae={class:"input-group"},xe={class:"input-group-text"},Ue=["id","name","value","checked"],$e=["for"],Le={__name:"RadioButton",props:{id:String,name:String,modelValue:{type:String,default:""},value:{type:String,default:""}},emits:["update:modelValue"],setup(C,{emit:y}){const _=C,D=y,m=()=>{D("update:modelValue",_.value)},A=w(()=>_.modelValue===_.value);return(x,H)=>(n(),d("div",Ae,[e("div",xe,[e("input",{id:_.id,name:_.name,value:_.value,checked:A.value,class:"form-check-input mt-0",type:"radio",onChange:m},null,40,Ue)]),e("label",{for:_.id,class:"form-control text-start"},[re(x.$slots,"default")],8,$e)]))}},Be={class:"row mb-4"},Te={class:"col-12"},Me={class:"row mb-2"},Ce={class:"col-12"},He={class:"col-md-4 mb-2"},Pe={class:"col-md-4 mb-2"},Fe={class:"col-md-4 mb-2"},Ne={class:"col-md-2 mb-2"},qe={class:"col-md-2 mb-2"},Ke={class:"row mb-4"},ze={class:"col-12"},Oe={class:"card"},Ye={class:"card-body pb-0"},je={key:0,class:"table-responsive"},Ze={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Ge={scope:"row"},Je={class:"text-start"},Qe={class:"text-start"},We=["title"],Xe={class:"text-start"},et={class:"text-start"},tt={key:1,class:"mt-3 text-center lead"},st={class:"fw-bold"},lt={key:0},ot=e("br",null,null,-1),it={key:1},at={class:"row g-3"},nt={class:"col-12"},dt={class:"col-12"},rt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите дистрибутора, который поставляет в эту ТС -- ",-1),ct=["value"],ut={class:"col-12"},_t=e("option",{disabled:"",selected:"",value:""},"-- Выберите тип торговой сети --",-1),mt=e("option",{value:"local"},"Локальная",-1),pt=e("option",{value:"regional"},"Региональная",-1),ht=e("option",{value:"federal"},"Федеральная",-1),vt=[_t,mt,pt,ht],ft={class:"col-12"},yt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите город, где находится штаб-квартира ТС -- ",-1),bt=["value"],Et={class:"col-12"},gt={class:"col-12"},wt={class:"form-check"},Vt=["checked"],kt=e("label",{class:"form-check-label",for:"is-direct"}," Прямой контракт (да/нет) ",-1),St={class:"col-12"},Rt={class:"form-check"},It=["checked"],Dt=e("label",{class:"form-check-label",for:"is-active"}," ТС активная (да/нет) ",-1),At={key:0},xt={key:1},Ut={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},$t=e("th",{style:{width:"30%"}},"ID",-1),Lt=e("th",null,"Название",-1),Bt=e("th",null,"Контрагент",-1),Tt=e("th",null,"Город",-1),Mt=e("th",null,"Прямой контракт?",-1),Ct=e("th",null,"Активна?",-1),Ht=e("span",null,null,-1),Zt={__name:"Index",setup(C){const y=ce(),_=ue(),D=_e(),m=Re(),{get:A,post:x,update:H,destroy:Z}=Se(),G=D.getUser.role,U=w(()=>G===we.SUPER_ADMIN),J=w(()=>U.value?O.concat(Ve,ke):O),V=()=>({name:"",type:"",description:"",isActive:!0,isDirect:!1,customerId:null,cityId:null}),s=N({retailers:[],customers:[],cities:[],retailer:V(),isEditing:!1}),u=N({name:"",city:"",customer:"",type:"",isActive:!1,isDirect:!1});let p=null,b=null;function k(){s.isEditing=!1,s.retailer=V(),document.activeElement&&document.activeElement.blur()}me(async()=>{await S(),p=new bootstrap.Modal(document.getElementById("modalPopUp")),p._element.addEventListener("hide.bs.modal",k)});const S=async()=>{const{data:c}=await A(R.RETAILER);s.retailers=c.retailers},P=c=>s.retailers.find(l=>l.id===c),Q=()=>{y.clear(),s.isEditing=!1,s.retailer=V(),p.show()},W=c=>{y.clear(),s.isEditing=!0,s.retailer=P(c),p.show()},X=c=>{b=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.retailer=P(c),b.show(),b._element.addEventListener("hide.bs.modal",k)},ee=()=>{p.hide(),p._element.removeEventListener("hide.bs.modal",k)},te=()=>{b.hide(),b._element.removeEventListener("hide.bs.modal",k)},se=()=>{m.resetSearchKeys(u),m.resetSortKeys()},le=async()=>{if(s.isEditing){const c=await H(`${R.RETAILER}/${s.retailer.id}`,s.retailer);c&&c.status==="success"&&(y.clear(),p.hide(),await S())}else{const c=await x(R.RETAILER,s.retailer);c&&c.status==="success"&&(y.clear(),s.retailer=V(),p.hide(),m.resetSearchKeys(u),m.resetSortKeys("id",!1),await S())}},oe=async c=>{if(confirm("Точно удалить торговую сеть? Уверены?")){const l=await Z(`${R.RETAILER}/${c}`);l&&l.status==="success"&&await S()}},ie=w(()=>m.sortArray(s.retailers)),$=w(()=>m.filterArray(ie.value,u));return(c,l)=>{const ae=he("RouterLink");return n(),d(v,null,[e("div",Be,[e("div",Te,[h(o(q,{class:"btn-primary",onClick:Q},{default:i(()=>[a("Новая торговая сеть ")]),_:1},512),[[pe,U.value]])])]),e("div",Me,[e("div",Ce,[o(Ie,{onResetFilter:se},{default:i(()=>[e("div",He,[o(T,{modelValue:u.name,"onUpdate:modelValue":l[0]||(l[0]=t=>u.name=t),placeholder:"Поиск по названию ТС"},{default:i(()=>[a("Название")]),_:1},8,["modelValue"])]),(n(!0),d(v,null,E(f(ve),t=>(n(),d("div",{class:"col-md-2 mb-2",key:t.id},[o(Le,{id:t.id,value:t.value,name:"retailer-type",modelValue:u.type,"onUpdate:modelValue":l[1]||(l[1]=L=>u.type=L)},{default:i(()=>[a(r(t.title),1)]),_:2},1032,["id","value","modelValue"])]))),128)),e("div",Pe,[o(T,{modelValue:u.city,"onUpdate:modelValue":l[2]||(l[2]=t=>u.city=t),placeholder:"Поиск по городу"},{default:i(()=>[a("Город")]),_:1},8,["modelValue"])]),e("div",Fe,[o(T,{modelValue:u.customer,"onUpdate:modelValue":l[3]||(l[3]=t=>u.customer=t),placeholder:"Поиск по контрагенту"},{default:i(()=>[a("Контрагент")]),_:1},8,["modelValue"])]),e("div",Ne,[o(Y,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":l[4]||(l[4]=t=>u.isActive=t)},{default:i(()=>[a("Только активные")]),_:1},8,["modelValue"])]),e("div",qe,[o(Y,{id:"is_direct",modelValue:u.isDirect,"onUpdate:modelValue":l[5]||(l[5]=t=>u.isDirect=t)},{default:i(()=>[a("Только прямые")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Ke,[e("div",ze,[e("div",Oe,[e("div",Ye,[$.value.length>0?(n(),d("div",je,[e("table",Ze,[e("thead",null,[e("tr",null,[(n(!0),d(v,null,E(J.value,({column:t,label:L,sortable:ne,is_num:F,width:de})=>(n(),fe(De,{key:t,column:t,"is-numeric":F,"sort-by-asc":f(m).sortBy.asc,"sort-by-column":f(m).sortBy.column===t,sortable:ne,width:de,onSetSort:Pt=>f(m).setSort(t,F)},{default:i(()=>[a(r(L),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(n(!0),d(v,null,E($.value,t=>(n(),d("tr",{key:t.id},[e("th",Ge,r(t.id),1),e("td",Je,[o(ae,{to:{name:"Retailer.View",params:{id:t.id}}},{default:i(()=>[a(r(t.name),1)]),_:2},1032,["to"])]),e("td",Qe,[e("span",{class:K(["badge","bg-opacity-75",t.typeBgColor]),title:t.typeDescription,style:{"font-size":"0.8em"}},r(t.label),11,We)]),e("td",Xe,r(t.customer),1),e("td",et,r(t.city),1),e("td",null,[o(I,{"is-active":t.isDirect},null,8,["is-active"])]),e("td",null,[o(I,{"is-active":t.isActive},null,8,["is-active"])]),o(M,{id:t.id,intent:"view",onRunButtonHandler:X},{default:i(()=>[a("View ")]),_:2},1032,["id"]),U.value?(n(),d(v,{key:0},[o(M,{id:t.id,intent:"edit",onRunButtonHandler:W},{default:i(()=>[a("Edit ")]),_:2},1032,["id"]),o(M,{id:t.id,intent:"delete",onRunButtonHandler:oe},{default:i(()=>[a("Delete ")]),_:2},1032,["id"])],64)):ye("",!0)]))),128))])])])):(n(),d("p",tt,r(f(_).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[a("Всего записей: "),e("span",st,r($.value.length),1)])])])])]),o(j,{id:"modalPopUp","close-func":ee,"custom-classes":[""]},{title:i(()=>[s.isEditing?(n(),d("span",lt,[a("Редактирование торговой сети "),ot,e("b",null,r(s.retailer.name),1)])):(n(),d("span",it,"Добавление торговой сети"))]),body:i(()=>[o(be),e("div",at,[e("div",nt,[o(g,{for:"name",required:""},{default:i(()=>[a("Название торговой сети")]),_:1}),o(Ee,{id:"name",modelValue:s.retailer.name,"onUpdate:modelValue":l[6]||(l[6]=t=>s.retailer.name=t),placeholder:"Например: Пятёрочка",type:"text"},null,8,["modelValue"])]),e("div",dt,[o(g,{for:"customer_id",required:""},{default:i(()=>[a("Контрагент")]),_:1}),h(e("select",{id:"customer_id","onUpdate:modelValue":l[7]||(l[7]=t=>s.retailer.customerId=t),class:"form-select"},[rt,(n(!0),d(v,null,E(s.customers,t=>(n(),d("option",{key:t.id,value:t.id},r(t.name),9,ct))),128))],512),[[B,s.retailer.customerId]])]),e("div",ut,[o(g,{for:"type",required:""},{default:i(()=>[a("Тип торговой сети")]),_:1}),h(e("select",{id:"type","onUpdate:modelValue":l[8]||(l[8]=t=>s.retailer.type=t),class:"form-select"},vt,512),[[B,s.retailer.type]])]),e("div",ft,[o(g,{for:"city_id",required:""},{default:i(()=>[a("Город")]),_:1}),h(e("select",{id:"city_id","onUpdate:modelValue":l[9]||(l[9]=t=>s.retailer.cityId=t),class:"form-select"},[yt,(n(!0),d(v,null,E(s.cities,t=>(n(),d("option",{key:t.id,value:t.id},r(t.name),9,bt))),128))],512),[[B,s.retailer.cityId]])]),e("div",Et,[o(g,{for:"description"},{default:i(()=>[a("Описание для торговой сети")]),_:1}),h(e("textarea",{id:"description","onUpdate:modelValue":l[10]||(l[10]=t=>s.retailer.description=t),class:"form-control",placeholder:"Укажите произвольное описание"},null,512),[[ge,s.retailer.description]])]),e("div",gt,[e("div",wt,[h(e("input",{id:"is-direct","onUpdate:modelValue":l[11]||(l[11]=t=>s.retailer.isDirect=t),checked:s.retailer.isDirect,class:"form-check-input",type:"checkbox"},null,8,Vt),[[z,s.retailer.isDirect]]),kt])]),e("div",St,[e("div",Rt,[h(e("input",{id:"is-active","onUpdate:modelValue":l[12]||(l[12]=t=>s.retailer.isActive=t),checked:s.retailer.isActive,class:"form-check-input",type:"checkbox"},null,8,It),[[z,s.retailer.isActive]]),Dt])])])]),footer:i(()=>[o(q,{class:K([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:f(_).isButtonDisabled,loading:f(_).isButtonDisabled,type:"button",onClick:le},{default:i(()=>[s.isEditing?(n(),d("span",At,"Сохранить")):(n(),d("span",xt,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),o(j,{id:"viewModalPopUp","close-func":te,"custom-classes":["modal-lg","modal-dialog-scrollable"]},{title:i(()=>[a(" Просмотр торговой сети "),e("b",null,r(s.retailer.name),1)]),body:i(()=>[e("table",Ut,[e("tbody",null,[e("tr",null,[$t,e("td",null,r(s.retailer.id),1)]),e("tr",null,[Lt,e("td",null,r(s.retailer.name),1)]),e("tr",null,[Bt,e("td",null,r(s.retailer.customer),1)]),e("tr",null,[Tt,e("td",null,r(s.retailer.city),1)]),e("tr",null,[Mt,e("td",null,[o(I,{"is-active":s.retailer.isDirect},null,8,["is-active"])])]),e("tr",null,[Ct,e("td",null,[o(I,{"is-active":s.retailer.isActive},null,8,["is-active"])])])])])]),footer:i(()=>[Ht]),_:1})],64)}}};export{Zt as default};
