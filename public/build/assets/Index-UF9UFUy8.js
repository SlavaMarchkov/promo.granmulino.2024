import{u as oe,a as ne,b as ae,d as w,r as D,e as le,A as E,c as d,f as e,s as ie,C as de,g as a,w as o,T as L,F as g,h as k,t as c,i as h,j as i,k as re,o as l,l as ce,m as ue,n as _e,p as U,q as $,x as me,R as he,G as N,E as pe,D as ge}from"./app-CcRn7-yu.js";import{u as fe}from"./useHttpService-F7Gi0evP.js";import{u as be}from"./useArrayHandlers-HI3WadKX.js";import{_ as ve,a as C}from"./TheFilter-CSf9971F.js";import{_ as M}from"./Modal-BjgBNvva.js";import{_ as ye,a as V}from"./TdButton-BuTkbrOp.js";const we={class:"row mb-4"},Ee={class:"col-12"},Se={class:"row mb-2"},Re={class:"col-12"},Ie={class:"col-md-4 mb-2"},ke={class:"col-md-4 mb-2"},Ve={class:"row mb-4"},xe={class:"col-12"},Be={class:"card"},De={class:"card-body pb-0"},Le={key:0,class:"table-responsive"},Ue={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},$e={scope:"row"},Ne={class:"text-start"},Ce={class:"text-start"},Me={key:1,class:"mt-3 text-center lead"},Ae={class:"fw-bold"},He={key:0},Te={key:1},Fe={class:"row g-3"},Oe={class:"col-12"},Pe={class:"col-12"},Ge={key:0},Ke={key:1},qe={key:0},je={class:"bd-callout bd-callout-info"},ze={class:"table table-bordered text-center align-middle text-wrap",style:{width:"100%"}},Je=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ID"),e("th",{class:"text-start"},"Название города")])],-1),Qe={class:"text-start"},We={key:1,class:"bd-callout bd-callout-warning"},Xe=e("h5",null,"Регион пустой",-1),Ye=e("hr",null,null,-1),Ze=e("p",null,[i("Наполните регион городами во вкладке "),e("b",null,"Справочники | Города"),i(".")],-1),et=[Xe,Ye,Ze],tt=e("span",null,null,-1),ct={__name:"Index",setup(st){const f=oe(),S=ne(),A=ae(),u=be(),{get:H,post:T,update:F,destroy:O}=fe(),P=A.getUser.role,R=w(()=>P===he.SUPER_ADMIN),G=w(()=>R.value?N.concat(pe,ge):N),b=()=>({code:"",name:""}),t=D({regions:[],region:b(),isEditing:!1}),m=D({code:"",name:""});let _=null,p=null;function v(){t.isEditing=!1,t.region=b(),document.activeElement&&document.activeElement.blur()}le(async()=>{await y(),_=new bootstrap.Modal(document.getElementById("modalPopUp")),_._element.addEventListener("hide.bs.modal",v)});const y=async()=>{const{data:n}=await H(E.REGION,{params:{cities:!0}});t.regions=n.regions},x=n=>t.regions.find(r=>r.id===n),K=()=>{f.clear(),t.isEditing=!1,t.region=b(),_.show()},q=n=>{f.clear(),t.isEditing=!0,t.region=x(n),_.show()},j=n=>{p=new bootstrap.Modal(document.getElementById("viewModalPopUp")),t.region=x(n),p.show(),p._element.addEventListener("hide.bs.modal",v)},z=()=>{_.hide(),_._element.removeEventListener("hide.bs.modal",v)},J=()=>{p.hide(),p._element.removeEventListener("hide.bs.modal",v)},Q=()=>{u.resetSearchKeys(m),u.resetSortKeys()},W=async()=>{if(t.isEditing){const n=await F(`${E.REGION}/${t.region.id}`,t.region);n&&n.status==="success"&&(f.clear(),_.hide(),await y())}else{const n=await T(E.REGION,t.region);n&&n.status==="success"&&(f.clear(),t.region=b(),_.hide(),u.resetSearchKeys(m),u.resetSortKeys("id",!1),await y())}},X=async n=>{if(confirm("Точно удалить регион? Уверены?")){const r=await O(`${E.REGION}/${n}`);r&&r.status==="success"&&await y()}},Y=w(()=>u.sortArray(t.regions)),I=w(()=>u.filterArray(Y.value,m));return(n,r)=>{const Z=re("RouterLink");return l(),d(g,null,[e("div",we,[e("div",Ee,[ie(a(L,{class:"btn-primary",onClick:K},{default:o(()=>[i("Новый регион ")]),_:1},512),[[de,R.value]])])]),e("div",Se,[e("div",Re,[a(ve,{onResetFilter:Q},{default:o(()=>[e("div",Ie,[a(C,{modelValue:m.name,"onUpdate:modelValue":r[0]||(r[0]=s=>m.name=s),placeholder:"Поиск по названию региона"},{default:o(()=>[i("Название ")]),_:1},8,["modelValue"])]),e("div",ke,[a(C,{modelValue:m.code,"onUpdate:modelValue":r[1]||(r[1]=s=>m.code=s),placeholder:"Поиск по коду региона"},{default:o(()=>[i("Код ")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Ve,[e("div",xe,[e("div",Be,[e("div",De,[I.value.length>0?(l(),d("div",Le,[e("table",Ue,[e("thead",null,[e("tr",null,[(l(!0),d(g,null,k(G.value,({column:s,label:ee,sortable:te,is_num:B,width:se})=>(l(),ce(ye,{key:s,column:s,"is-numeric":B,"sort-by-asc":h(u).sortBy.asc,"sort-by-column":h(u).sortBy.column===s,sortable:te,width:se,onSetSort:ot=>h(u).setSort(s,B)},{default:o(()=>[i(c(ee),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(l(!0),d(g,null,k(I.value,s=>(l(),d("tr",{key:s.id},[e("th",$e,c(s.id),1),e("td",Ne,[a(Z,{to:{name:"Region.View",params:{id:s.id}}},{default:o(()=>[i(c(s.name),1)]),_:2},1032,["to"])]),e("td",Ce,c(s.code),1),e("td",null,c(s.citiesCount),1),a(V,{id:s.id,intent:"view",onRunButtonHandler:j},{default:o(()=>[i("View ")]),_:2},1032,["id"]),R.value?(l(),d(g,{key:0},[a(V,{id:s.id,intent:"edit",onRunButtonHandler:q},{default:o(()=>[i("Edit ")]),_:2},1032,["id"]),a(V,{id:s.id,intent:"delete",onRunButtonHandler:X},{default:o(()=>[i("Delete ")]),_:2},1032,["id"])],64)):ue("",!0)]))),128))])])])):(l(),d("p",Me,c(h(S).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[i("Всего записей: "),e("span",Ae,c(I.value.length),1)])])])])]),a(M,{id:"modalPopUp","close-func":z,"custom-classes":[""]},{title:o(()=>[t.isEditing?(l(),d("span",He,[i("Редактирование региона "),e("b",null,c(t.region.name),1)])):(l(),d("span",Te,"Добавление региона"))]),body:o(()=>[a(_e),e("div",Fe,[e("div",Oe,[a(U,{for:"name",required:""},{default:o(()=>[i("Наименование региона")]),_:1}),a($,{id:"name",modelValue:t.region.name,"onUpdate:modelValue":r[2]||(r[2]=s=>t.region.name=s),placeholder:"Например: Уральский федеральный округ",type:"text"},null,8,["modelValue"])]),e("div",Pe,[a(U,{for:"code",required:""},{default:o(()=>[i("Код региона")]),_:1}),a($,{id:"code",modelValue:t.region.code,"onUpdate:modelValue":r[3]||(r[3]=s=>t.region.code=s),placeholder:"Например: УФО",type:"text"},null,8,["modelValue"])])])]),footer:o(()=>[a(L,{class:me([t.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:h(S).isButtonDisabled,loading:h(S).isButtonDisabled,type:"button",onClick:W},{default:o(()=>[t.isEditing?(l(),d("span",Ge,"Сохранить")):(l(),d("span",Ke,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(M,{id:"viewModalPopUp","close-func":J,"custom-classes":["modal-dialog-scrollable"]},{title:o(()=>[i(" Просмотр региона "),e("b",null,c(t.region.name),1)]),body:o(()=>[t.region.citiesCount>0?(l(),d("div",qe,[e("div",je,[e("p",null,[i("Всего городов в регионе: "),e("strong",null,c(t.region.citiesCount),1)])]),e("table",ze,[Je,e("tbody",null,[(l(!0),d(g,null,k(t.region.cities,s=>(l(),d("tr",{key:s.id},[e("td",null,c(s.id),1),e("td",Qe,c(s.name),1)]))),128))])])])):(l(),d("div",We,et))]),footer:o(()=>[tt]),_:1})],64)}}};export{ct as default};
