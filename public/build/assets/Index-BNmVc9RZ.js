import{u as re,a as ue,b as _e,d as y,r as H,e as me,A as b,c,f as e,g as o,w as d,F as h,h as R,t as r,i as p,j as l,k as pe,o as n,m as g,l as he,n as fe,p as w,q as S,s as F,H as ve,v as ye,T as be,x as ge,R as N,P as x,E as O,D as we,Q as Ve}from"./app-CvDqXEOd.js";import{u as Ee}from"./useArrayHandlers-Dmi2z74m.js";import{u as ke}from"./useHttpService-Cv4QBHm9.js";import{_ as Ie}from"./TheCheckbox-D3tzlK-V.js";import{_ as Se}from"./SelectGroup-BYhVyxVb.js";import{_ as Pe,a as B}from"./TheFilter-VzPJfpVU.js";import{_ as q}from"./TheBadge-BBHb-MvK.js";import{_ as K}from"./Modal-BjKEkhVV.js";import{_ as Ue,a as P}from"./TdButton-DoOWIy6T.js";import{f as j}from"./formatters-CphxWokN.js";const De={class:"row mb-4"},Ae={class:"col-12"},Re=["disabled"],xe={class:"row mb-2"},Be={class:"col-12"},Ce={class:"col-md-4 mb-2"},$e={class:"col-md-4 mb-2"},Le={class:"col-md-4 mb-2"},Te={class:"col-md-4 mb-2"},Me={key:0,class:"col-md-4 mb-2"},He={class:"row mb-4"},Fe={class:"col-12"},Ne={class:"card"},Oe={class:"card-body pb-0"},qe={key:0,class:"table-responsive"},Ke={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},je={scope:"row"},ze={class:"text-start"},Ge={class:"text-start"},Qe={key:1,class:"mt-3 text-center lead"},Ye={class:"fw-bold"},Je={key:0},We=e("br",null,null,-1),Xe={key:1},Ze={class:"row g-3"},et={class:"col-12"},tt={class:"col-6"},st={key:0,class:"col-6"},ot={class:"col-12"},at=e("option",{disabled:"",selected:"",value:""},"-- Выберите группу товара --",-1),dt=["value"],lt={class:"col-12"},it={class:"col-12"},nt={class:"form-check"},ct=["checked"],rt=e("label",{class:"form-check-label",for:"is-active"}," Продукт в продаже? ",-1),ut={key:0},_t={key:1},mt={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},pt=e("th",{style:{width:"40%"}},"ID",-1),ht=e("th",null,"Название",-1),ft=e("th",null,"Вес, г",-1),vt={key:0},yt=e("th",null,"Себестоимость, руб.",-1),bt=e("th",null,"Группа товаров",-1),gt=e("th",null,"В продаже?",-1),wt=e("span",null,null,-1),Ct={__name:"Index",setup(Vt){const V=re(),U=ue(),z=_e(),_=Ee(),{get:C,post:G,update:Q,destroy:Y}=ke(),$=z.getUser.role,D=y(()=>$===N.SUPER_ADMIN),f=y(()=>$===N.PRICE_ADMIN),J=y(()=>D?x.concat(O,we):f?x.concat(Ve,O):x),E=()=>({name:"",weight:"",price:"",categoryId:"",isActive:!0}),s=H({products:[],categories:[],product:E(),isEditing:!1}),u=H({name:"",weight:"",price:"",categoryId:"",isActive:!1});let m=null,v=null;function k(){s.isEditing=!1,s.product=E()}me(async()=>{await I(),await W(),m=new bootstrap.Modal(document.getElementById("modalPopUp")),m._element.addEventListener("hide.bs.modal",k)});const I=async()=>{const{data:i}=await C(b.PRODUCT,{params:{is_active:!1}});s.products=i.products},L=i=>s.products.find(a=>a.id===i),W=async()=>{const{data:i}=await C(b.CATEGORY,{params:{is_active:!0}});s.categories=i.categories},X=()=>{V.clear(),s.isEditing=!1,s.product=E(),m.show()},T=i=>{V.clear(),s.isEditing=!0,s.product=L(i),m.show()},Z=i=>{v=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.product=L(i),v.show(),v._element.addEventListener("hide.bs.modal",k)},ee=()=>{m.hide(),m._element.removeEventListener("hide.bs.modal",k)},te=()=>{v.hide(),v._element.removeEventListener("hide.bs.modal",k)},se=()=>{_.resetSearchKeys(u),_.resetSortKeys()},oe=async()=>{if(s.isEditing){const i=await Q(`${b.PRODUCT}/${s.product.id}`,s.product);i&&i.status==="success"&&(V.clear(),m.hide(),await I())}else{const i=await G(b.PRODUCT,s.product);i&&i.status==="success"&&(V.clear(),s.product=E(),m.hide(),_.resetSearchKeys(u),_.resetSortKeys("id",!1),await I())}},ae=async i=>{if(confirm("Точно удалить продукт? Уверены?")){const{status:a}=await Y(`${b.PRODUCT}/${i}`);a==="success"&&await I()}},de=y(()=>_.sortArray(s.products)),A=y(()=>_.filterArray(de.value,u));return(i,a)=>{const le=pe("RouterLink");return n(),c(h,null,[e("div",De,[e("div",Ae,[e("button",{class:"btn btn-primary",type:"button",onClick:X,disabled:!D.value}," Новый продукт ",8,Re)])]),e("div",xe,[e("div",Be,[o(Pe,{onResetFilter:se},{default:d(()=>[e("div",Ce,[o(B,{modelValue:u.name,"onUpdate:modelValue":a[0]||(a[0]=t=>u.name=t),placeholder:"Поиск по названию"},{default:d(()=>[l("Продукт ")]),_:1},8,["modelValue"])]),e("div",$e,[o(Se,{modelValue:u.categoryId,"onUpdate:modelValue":a[1]||(a[1]=t=>u.categoryId=t),chooseFrom:"-- Выберите группу товара --",items:s.categories},{default:d(()=>[l("Группа товара ")]),_:1},8,["modelValue","items"])]),e("div",Le,[o(Ie,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":a[2]||(a[2]=t=>u.isActive=t)},{default:d(()=>[l(" Продукт в продаже? ")]),_:1},8,["modelValue"])]),e("div",Te,[o(B,{modelValue:u.weight,"onUpdate:modelValue":a[3]||(a[3]=t=>u.weight=t),placeholder:"Фильтр по макс. весу"},{default:d(()=>[l("Макс. вес ")]),_:1},8,["modelValue"])]),f.value?(n(),c("div",Me,[o(B,{modelValue:u.price,"onUpdate:modelValue":a[4]||(a[4]=t=>u.price=t),placeholder:"Поиск по цене"},{default:d(()=>[l("Цена ")]),_:1},8,["modelValue"])])):g("",!0)]),_:1})])]),e("div",He,[e("div",Fe,[e("div",Ne,[e("div",Oe,[A.value.length>0?(n(),c("div",qe,[e("table",Ke,[e("thead",null,[e("tr",null,[(n(!0),c(h,null,R(J.value,({column:t,label:ie,sortable:ne,is_num:M,width:ce})=>(n(),he(Ue,{key:t,column:t,"is-numeric":M,"sort-by-asc":p(_).sortBy.asc,"sort-by-column":p(_).sortBy.column===t,sortable:ne,width:ce,onSetSort:Et=>p(_).setSort(t,M)},{default:d(()=>[l(r(ie),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(n(!0),c(h,null,R(A.value,t=>(n(),c("tr",{key:t.id},[e("th",je,r(t.id),1),e("td",ze,[o(le,{to:{name:"Product.View",params:{id:t.id}}},{default:d(()=>[l(r(t.name),1)]),_:2},1032,["to"])]),e("td",null,r(p(j)(t.weight)),1),e("td",Ge,r(t.category),1),e("td",null,[o(q,{"is-active":t.isActive},null,8,["is-active"])]),o(P,{id:t.id,intent:"view",onRunButtonHandler:Z},{default:d(()=>[l("View ")]),_:2},1032,["id"]),f.value?(n(),c(h,{key:0},[e("td",null,r(t.price),1),o(P,{id:t.id,intent:"edit",onRunButtonHandler:T},{default:d(()=>[l("Edit ")]),_:2},1032,["id"])],64)):g("",!0),D.value?(n(),c(h,{key:1},[o(P,{id:t.id,intent:"edit",onRunButtonHandler:T},{default:d(()=>[l("Edit ")]),_:2},1032,["id"]),o(P,{id:t.id,intent:"delete",onRunButtonHandler:ae},{default:d(()=>[l("Delete ")]),_:2},1032,["id"])],64)):g("",!0)]))),128))])])])):(n(),c("p",Qe,r(p(U).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[l("Всего записей: "),e("span",Ye,r(A.value.length),1)])])])])]),o(K,{id:"modalPopUp","close-func":ee,"custom-classes":[""]},{title:d(()=>[s.isEditing?(n(),c("span",Je,[l("Редактирование продукта "),We,e("b",null,r(s.product.name),1)])):(n(),c("span",Xe,"Добавление продукта"))]),body:d(()=>[o(fe),e("div",Ze,[e("div",et,[o(w,{for:"name",required:""},{default:d(()=>[l("Название продукта")]),_:1}),o(S,{id:"name",modelValue:s.product.name,"onUpdate:modelValue":a[5]||(a[5]=t=>s.product.name=t),placeholder:"Например: Бантики, 400 г",type:"text"},null,8,["modelValue"])]),e("div",tt,[o(w,{for:"weight",required:""},{default:d(()=>[l("Вес пачки, г")]),_:1}),o(S,{id:"weight",modelValue:s.product.weight,"onUpdate:modelValue":a[6]||(a[6]=t=>s.product.weight=t),max:"50000",min:"0",placeholder:"Например: 400",step:"50",type:"number"},null,8,["modelValue"])]),f.value?(n(),c("div",st,[o(w,{for:"price",required:""},{default:d(()=>[l("Отпускная цена, руб.")]),_:1}),o(S,{id:"price",modelValue:s.product.price,"onUpdate:modelValue":a[7]||(a[7]=t=>s.product.price=t),max:"299.99",min:"0.00",placeholder:"Например: 36.99",step:"0.01",type:"number"},null,8,["modelValue"])])):g("",!0),e("div",ot,[o(w,{for:"category_id",required:""},{default:d(()=>[l("Группа товара")]),_:1}),F(e("select",{id:"category_id","onUpdate:modelValue":a[8]||(a[8]=t=>s.product.categoryId=t),class:"form-select"},[at,(n(!0),c(h,null,R(s.categories,t=>(n(),c("option",{key:t.id,value:t.id},r(t.name),9,dt))),128))],512),[[ve,s.product.categoryId]])]),e("div",lt,[o(w,{for:"image"},{default:d(()=>[l("Изображение продукта")]),_:1}),o(S,{id:"image",type:"file"})]),e("div",it,[e("div",nt,[F(e("input",{id:"is-active","onUpdate:modelValue":a[9]||(a[9]=t=>s.product.isActive=t),checked:s.product.isActive,class:"form-check-input",type:"checkbox"},null,8,ct),[[ye,s.product.isActive]]),rt])])])]),footer:d(()=>[o(be,{class:ge([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:p(U).isButtonDisabled,loading:p(U).isButtonDisabled,type:"button",onClick:oe},{default:d(()=>[s.isEditing?(n(),c("span",ut,"Сохранить")):(n(),c("span",_t,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),o(K,{id:"viewModalPopUp","close-func":te,"custom-classes":[""]},{title:d(()=>[l(" Просмотр продукта "),e("b",null,r(s.product.name),1)]),body:d(()=>[e("table",mt,[e("tbody",null,[e("tr",null,[pt,e("td",null,r(s.product.id),1)]),e("tr",null,[ht,e("td",null,r(s.product.name),1)]),e("tr",null,[ft,e("td",null,r(p(j)(s.product.weight)),1)]),f.value?(n(),c("tr",vt,[yt,e("td",null,r(s.product.price),1)])):g("",!0),e("tr",null,[bt,e("td",null,r(s.product.category),1)]),e("tr",null,[gt,e("td",null,[o(q,{"is-active":s.product.isActive},null,8,["is-active"])])])])])]),footer:d(()=>[wt]),_:1})],64)}}};export{Ct as default};
