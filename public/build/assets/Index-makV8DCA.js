import{u as le,a as ae,b as oe,d as E,r as R,e as de,A as N,c,f as e,g as a,w as o,F as U,h as $,t as d,i as p,j as i,k as ie,o as u,l as ne,m as re,n as ue,p as h,q as v,s as ce,v as me,T as _e,x as pe,R as fe,U as L,E as he,D as ve}from"./app-CvDqXEOd.js";import{u as be}from"./useHttpService-Cv4QBHm9.js";import{u as ye}from"./useArrayHandlers-Dmi2z74m.js";import{_ as we,a as g}from"./TheFilter-VzPJfpVU.js";import{_ as M}from"./Modal-BjKEkhVV.js";import{_ as Ve,a as A}from"./TdButton-DoOWIy6T.js";import{_ as Ee}from"./TheCheckbox-D3tzlK-V.js";import{_ as x}from"./TheBadge-BBHb-MvK.js";const Ne={class:"row mb-2"},Ue={class:"col-12"},ge={class:"col-md-4 mb-2"},Se={class:"col-md-4 mb-2"},ke={class:"col-md-4 mb-2"},Ae={class:"col-md-4 mb-2"},xe={class:"col-md-4 mb-2"},Ie={class:"row mb-4"},Be={class:"col-12"},De={class:"card"},Re={class:"card-body pb-0"},$e={key:0,class:"table-responsive"},Le={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Me={scope:"row"},He={class:"text-start"},Te={class:"text-start"},Ce={class:"text-start"},Fe={class:"text-start"},Pe={class:"text-start"},qe={key:1,class:"mt-3 text-center lead"},Ke={class:"fw-bold"},Oe={key:0},je={key:1},ze={class:"row g-3"},Ge={class:"col-12"},Je={class:"col-12"},Qe={class:"col-12"},We={class:"col-12"},Xe={class:"col-12"},Ye={class:"col-12"},Ze={class:"form-check"},es=["checked"],ss=e("label",{class:"form-check-label",for:"is-active"}," Работает? ",-1),ts={key:0},ls={key:1},as={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},os=e("th",{style:{width:"35%"}},"ID",-1),ds=e("th",null,"Фамилия",-1),is=e("th",null,"Имя",-1),ns=e("th",null,"Отчество",-1),rs=e("th",null,"Системное имя",-1),us=e("th",null,"Email",-1),cs=e("th",null,"Работает?",-1),ms=e("th",null,"Админ?",-1),_s=e("th",null,"Последний вход",-1),ps=e("span",null,null,-1),gs={__name:"Index",setup(fs){const b=le(),S=ae(),H=oe(),m=ye(),{get:T,post:C,update:F,destroy:P}=be(),q=H.getUser.role,I=E(()=>q===fe.SUPER_ADMIN),K=E(()=>I?L.concat(he,ve):L),y=()=>({firstName:"",lastName:"",middleName:"",displayName:"",email:"",password:"",isActive:!0}),s=R({users:[],user:y(),isEditing:!1}),r=R({firstName:"",lastName:"",middleName:"",email:"",isActive:!1});let _=null,f=null;function w(){s.isEditing=!1,s.user=y()}de(async()=>{await V(),_=new bootstrap.Modal(document.getElementById("modalPopUp")),_._element.addEventListener("hide.bs.modal",w)});const V=async()=>{const{data:n}=await T(N.USER);s.users=n.users},B=n=>s.users.find(l=>l.id===n),O=()=>{b.clear(),s.isEditing=!1,s.user=y(),_.show()},j=n=>{b.clear(),s.isEditing=!0,s.user=B(n),_.show()},z=n=>{f=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.user=B(n),f.show(),f._element.addEventListener("hide.bs.modal",w)},G=()=>{_.hide(),_._element.removeEventListener("hide.bs.modal",w)},J=()=>{f.hide(),f._element.removeEventListener("hide.bs.modal",w)},Q=()=>{m.resetSearchKeys(r),m.resetSortKeys()},W=async()=>{if(s.isEditing){const n=await F(`${N.USER}/${s.user.id}`,s.user);n&&n.status==="success"&&(b.clear(),_.hide(),await V())}else{const n=await C(N.USER,s.user);n&&n.status==="success"&&(b.clear(),s.user=y(),_.hide(),m.resetSearchKeys(r),m.resetSortKeys("id",!1),await V())}},X=async n=>{if(confirm("Точно удалить пользователя? Уверены?")){const l=await P(`${N.USER}/${n}`);l&&l.status==="success"&&await V()}},Y=E(()=>m.sortArray(s.users)),k=E(()=>m.filterArray(Y.value,r));return(n,l)=>{const Z=ie("RouterLink");return u(),c(U,null,[e("div",{class:"row mb-4"},[e("div",{class:"col-12"},[e("button",{class:"btn btn-primary",type:"button",onClick:O}," Новый пользователь ")])]),e("div",Ne,[e("div",Ue,[a(we,{onResetFilter:Q},{default:o(()=>[e("div",ge,[a(g,{modelValue:r.lastName,"onUpdate:modelValue":l[0]||(l[0]=t=>r.lastName=t),placeholder:"Поиск по фамилии"},{default:o(()=>[i("Фамилия")]),_:1},8,["modelValue"])]),e("div",Se,[a(g,{modelValue:r.firstName,"onUpdate:modelValue":l[1]||(l[1]=t=>r.firstName=t),placeholder:"Поиск по имени"},{default:o(()=>[i("Имя")]),_:1},8,["modelValue"])]),e("div",ke,[a(g,{modelValue:r.middleName,"onUpdate:modelValue":l[2]||(l[2]=t=>r.middleName=t),placeholder:"Поиск по отчеству"},{default:o(()=>[i("Отчество")]),_:1},8,["modelValue"])]),e("div",Ae,[a(g,{modelValue:r.email,"onUpdate:modelValue":l[3]||(l[3]=t=>r.email=t),placeholder:"Поиск по email"},{default:o(()=>[i("Email")]),_:1},8,["modelValue"])]),e("div",xe,[a(Ee,{id:"is_active",modelValue:r.isActive,"onUpdate:modelValue":l[4]||(l[4]=t=>r.isActive=t)},{default:o(()=>[i(" Работает? ")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Ie,[e("div",Be,[e("div",De,[e("div",Re,[k.value.length>0?(u(),c("div",$e,[e("table",Le,[e("thead",null,[e("tr",null,[(u(!0),c(U,null,$(K.value,({column:t,label:ee,sortable:se,is_num:D,width:te})=>(u(),ne(Ve,{key:t,column:t,"is-numeric":D,"sort-by-asc":p(m).sortBy.asc,"sort-by-column":p(m).sortBy.column===t,sortable:se,width:te,onSetSort:hs=>p(m).setSort(t,D)},{default:o(()=>[i(d(ee),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(u(!0),c(U,null,$(k.value,t=>(u(),c("tr",{key:t.id},[e("th",Me,d(t.id),1),e("td",He,[a(Z,{to:{name:"User.View",params:{id:t.id}}},{default:o(()=>[i(d(t.lastName),1)]),_:2},1032,["to"])]),e("td",Te,d(t.firstName),1),e("td",Ce,d(t.middleName),1),e("td",Fe,d(t.email),1),e("td",Pe,d(t.loggedInAt),1),e("td",null,[a(x,{"is-active":t.isActive},null,8,["is-active"])]),a(A,{id:t.id,intent:"view",onRunButtonHandler:z},{default:o(()=>[i("View ")]),_:2},1032,["id"]),I.value?(u(),c(U,{key:0},[a(A,{id:t.id,intent:"edit",onRunButtonHandler:j},{default:o(()=>[i("Edit ")]),_:2},1032,["id"]),a(A,{id:t.id,intent:"delete",onRunButtonHandler:X},{default:o(()=>[i("Delete ")]),_:2},1032,["id"])],64)):re("",!0)]))),128))])])])):(u(),c("p",qe,d(p(S).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[i("Всего записей: "),e("span",Ke,d(k.value.length),1)])])])])]),a(M,{id:"modalPopUp","close-func":G,"custom-classes":[""]},{title:o(()=>[s.isEditing?(u(),c("span",Oe,[i("Редактирование пользователя "),e("b",null,d(s.user.fullName),1)])):(u(),c("span",je,"Добавление пользователя"))]),body:o(()=>[a(ue),e("div",ze,[e("div",Ge,[a(h,{for:"last-name",required:""},{default:o(()=>[i("Фамилия")]),_:1}),a(v,{id:"last-name",modelValue:s.user.lastName,"onUpdate:modelValue":l[5]||(l[5]=t=>s.user.lastName=t),placeholder:"Например: Овчинникова",type:"text"},null,8,["modelValue"])]),e("div",Je,[a(h,{for:"first-name",required:""},{default:o(()=>[i("Имя")]),_:1}),a(v,{id:"first-name",modelValue:s.user.firstName,"onUpdate:modelValue":l[6]||(l[6]=t=>s.user.firstName=t),placeholder:"Например: Екатерина",type:"text"},null,8,["modelValue"])]),e("div",Qe,[a(h,{for:"middle-name"},{default:o(()=>[i("Отчество")]),_:1}),a(v,{id:"middle-name",modelValue:s.user.middleName,"onUpdate:modelValue":l[7]||(l[7]=t=>s.user.middleName=t),placeholder:"Например: Александровна",type:"text"},null,8,["modelValue"])]),e("div",We,[a(h,{for:"email",required:""},{default:o(()=>[i("Email")]),_:1}),a(v,{id:"email",modelValue:s.user.email,"onUpdate:modelValue":l[8]||(l[8]=t=>s.user.email=t),placeholder:"Например: 508@altan.ru",type:"email"},null,8,["modelValue"])]),e("div",Xe,[a(h,{for:"password",required:!s.isEditing},{default:o(()=>[i(d(s.isEditing?"Пароль (оставьте пустым, если не изменяете пароль)":"Пароль"),1)]),_:1},8,["required"]),a(v,{id:"password",modelValue:s.user.password,"onUpdate:modelValue":l[9]||(l[9]=t=>s.user.password=t),type:"password"},null,8,["modelValue"])]),e("div",Ye,[e("div",Ze,[ce(e("input",{id:"is-active","onUpdate:modelValue":l[10]||(l[10]=t=>s.user.isActive=t),checked:s.user.isActive,class:"form-check-input",type:"checkbox"},null,8,es),[[me,s.user.isActive]]),ss])])])]),footer:o(()=>[a(_e,{class:pe([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:p(S).isButtonDisabled,loading:p(S).isButtonDisabled,type:"button",onClick:W},{default:o(()=>[s.isEditing?(u(),c("span",ts,"Сохранить")):(u(),c("span",ls,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(M,{id:"viewModalPopUp","close-func":J,"custom-classes":[""]},{title:o(()=>[i(" Просмотр пользователя "),e("b",null,d(s.user.fullName),1)]),body:o(()=>[e("table",as,[e("tbody",null,[e("tr",null,[os,e("td",null,d(s.user.id),1)]),e("tr",null,[ds,e("td",null,d(s.user.lastName),1)]),e("tr",null,[is,e("td",null,d(s.user.firstName),1)]),e("tr",null,[ns,e("td",null,d(s.user.middleName),1)]),e("tr",null,[rs,e("td",null,d(s.user.fullName),1)]),e("tr",null,[us,e("td",null,d(s.user.email),1)]),e("tr",null,[cs,e("td",null,[a(x,{"is-active":s.user.isActive},null,8,["is-active"])])]),e("tr",null,[ms,e("td",null,[a(x,{"is-active":s.user.isAdmin},null,8,["is-active"])])]),e("tr",null,[_s,e("td",null,d(s.user.loggedInAt),1)])])])]),footer:o(()=>[ps]),_:1})],64)}}};export{gs as default};
