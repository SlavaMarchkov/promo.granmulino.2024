import{u as ue,a as me,b as _e,d as V,r as D,e as pe,A as v,c as r,f as e,s as f,C as ve,g as i,w as l,T as x,F as p,h as g,t as c,i as h,j as n,k as fe,o as d,l as he,m as L,n as be,p as b,q as ye,I as M,x as T,M as ge,v as we,R as Ie,N as F,E as Ee,D as Se}from"./app-CcRn7-yu.js";import{u as Ve}from"./useHttpService-F7Gi0evP.js";import{u as ke}from"./useArrayHandlers-HI3WadKX.js";import{_ as Ue,a as R}from"./TdButton-BuTkbrOp.js";import{_ as H}from"./TheBadge-BlMSyGe5.js";import{_ as Ce,a as O}from"./TheFilter-CSf9971F.js";import{_ as P}from"./SelectGroup-BIJL2IJV.js";import{_ as Ne}from"./TheCheckbox-B4dmdo2T.js";import{_ as q}from"./Modal-BjgBNvva.js";const xe={class:"row mb-4"},Me={class:"col-12"},Re={class:"row mb-2"},Ae={class:"col-12"},$e={class:"col-md-4 mb-2"},Be={class:"col-md-4 mb-2"},De={class:"col-md-4 mb-2"},Le={class:"col-md-4 mb-2"},Te={class:"col-md-4 mb-2"},Fe={class:"row mb-4"},He={class:"col-12"},Oe={class:"card"},Pe={class:"card-body pb-0"},qe={key:0,class:"table-responsive"},Ke={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},je={scope:"row"},ze={class:"text-start"},Ge={class:"text-start"},Je={class:"text-start"},Qe={class:"text-start"},We={key:1,class:"mt-3 text-center lead"},Xe={class:"fw-bold"},Ye={key:0},Ze=e("br",null,null,-1),et={key:1},tt={class:"row g-3"},st={class:"col-12"},ot={class:"col-12"},lt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите регион --",-1),it=["value"],at={key:0,class:"col-12"},nt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите город --",-1),dt=["value"],rt={class:"col-6"},ct=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите ФИО --",-1),ut=["value"],mt={class:"col-6"},_t={class:"col-12"},pt={class:"col-12"},vt={class:"form-check"},ft=["checked"],ht=e("label",{class:"form-check-label",for:"is-active"}," Активный? ",-1),bt={key:0},yt={key:1},gt={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},wt=e("th",{style:{width:"20%"}},"ID",-1),It=e("th",null,"Название",-1),Et=e("th",null,"Регион",-1),St=e("th",null,"Город",-1),Vt=e("th",null,"Менеджер",-1),kt=e("th",null,"Активен?",-1),Ut=e("span",null,null,-1),Ft={__name:"Index",setup(Ct){const w=ue(),k=me(),K=_e(),m=ke(),{get:U,post:j,update:z,destroy:G}=Ve(),J=K.getUser.role,C=V(()=>J===Ie.SUPER_ADMIN),Q=V(()=>C.value?F.concat(Ee,Se):F),I=()=>({name:"",description:"",isActive:!0,regionId:null,cityId:null,userId:null}),t=D({customers:[],users:[],regions:[],cities:[],customer:I(),isEditing:!1}),u=D({name:"",userId:"",regionId:"",cityName:"",isActive:!1});let _=null,y=null;function E(){t.isEditing=!1,t.customer=I(),document.activeElement&&document.activeElement.blur()}pe(async()=>{await S(),await X(),await W(),_=new bootstrap.Modal(document.getElementById("modalPopUp")),_._element.addEventListener("hide.bs.modal",E)});const S=async()=>{const{data:a}=await U(v.CUSTOMER,{params:{user:!0,region:!0,city:!0}});t.customers=a.customers},A=a=>t.customers.find(o=>o.id===a),W=async()=>{const{data:a}=await U(v.REGION,{params:{cities:!1}});t.regions=a.regions},X=async()=>{const{data:a}=await U(v.USER,{params:{is_active:!0}});t.users=a.users},$=()=>{t.regions.map(a=>{+a.id==+t.customer.regionId&&(t.cities=a.cities)})},Y=()=>{w.clear(),t.isEditing=!1,t.cities=[],t.customer=I(),_.show()},Z=a=>{w.clear(),t.isEditing=!0,t.customer=A(a),$(t.customer.regionId),_.show()},ee=a=>{y=new bootstrap.Modal(document.getElementById("viewModalPopUp")),t.customer=A(a),y.show(),y._element.addEventListener("hide.bs.modal",E)},te=()=>{_.hide(),_._element.removeEventListener("hide.bs.modal",E)},se=()=>{y.hide(),y._element.removeEventListener("hide.bs.modal",E)},oe=()=>{m.resetSearchKeys(u),m.resetSortKeys()},le=async()=>{if(t.isEditing){const a=await z(`${v.CUSTOMER}/${t.customer.id}`,t.customer);a&&a.status==="success"&&(w.clear(),_.hide(),await S())}else{const a=await j(v.CUSTOMER,t.customer);a&&a.status==="success"&&(w.clear(),t.customer=I(),_.hide(),m.resetSearchKeys(u),m.resetSortKeys("id",!1),await S())}},ie=async a=>{if(confirm("Точно удалить контрагента? Уверены?")){const o=await G(`${v.CUSTOMER}/${a}`);o&&o.status==="success"&&await S()}},ae=V(()=>m.sortArray(t.customers)),N=V(()=>m.filterArray(ae.value,u));return(a,o)=>{const ne=fe("RouterLink");return d(),r(p,null,[e("div",xe,[e("div",Me,[f(i(x,{onClick:Y,class:"btn-primary"},{default:l(()=>[n("Новый контрагент ")]),_:1},512),[[ve,C.value]])])]),e("div",Re,[e("div",Ae,[i(Ce,{onResetFilter:oe},{default:l(()=>[e("div",$e,[i(O,{modelValue:u.name,"onUpdate:modelValue":o[0]||(o[0]=s=>u.name=s),placeholder:"Поиск по названию"},{default:l(()=>[n(" Клиент ")]),_:1},8,["modelValue"])]),e("div",Be,[i(P,{modelValue:u.userId,"onUpdate:modelValue":o[1]||(o[1]=s=>u.userId=s),chooseFrom:"-- Выберите менеджера --",items:t.users.concat({id:"null",fullName:"без менеджера"}),selectedOption:"fullName"},{default:l(()=>[n("Менеджер ")]),_:1},8,["modelValue","items"])]),e("div",De,[i(P,{modelValue:u.regionId,"onUpdate:modelValue":o[2]||(o[2]=s=>u.regionId=s),chooseFrom:"-- Выберите регион --",items:t.regions},{default:l(()=>[n("Регион ")]),_:1},8,["modelValue","items"])]),e("div",Le,[i(O,{modelValue:u.cityName,"onUpdate:modelValue":o[3]||(o[3]=s=>u.cityName=s),placeholder:"Поиск по городу"},{default:l(()=>[n(" Город ")]),_:1},8,["modelValue"])]),e("div",Te,[i(Ne,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":o[4]||(o[4]=s=>u.isActive=s)},{default:l(()=>[n(" Показать только активных ")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Fe,[e("div",He,[e("div",Oe,[e("div",Pe,[N.value.length>0?(d(),r("div",qe,[e("table",Ke,[e("thead",null,[e("tr",null,[(d(!0),r(p,null,g(Q.value,({column:s,label:de,sortable:re,is_num:B,width:ce})=>(d(),he(Ue,{key:s,column:s,"is-numeric":B,"sort-by-asc":h(m).sortBy.asc,"sort-by-column":h(m).sortBy.column===s,sortable:re,width:ce,onSetSort:Nt=>h(m).setSort(s,B)},{default:l(()=>[n(c(de),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(d(!0),r(p,null,g(N.value,s=>(d(),r("tr",{key:s.id},[e("th",je,c(s.id),1),e("td",ze,[i(ne,{to:{name:"Customer.View",params:{id:s.id}}},{default:l(()=>[n(c(s.name),1)]),_:2},1032,["to"])]),e("td",Ge,c(s.userName),1),e("td",Je,c(s.regionName),1),e("td",Qe,c(s.cityName),1),e("td",null,[i(H,{"is-active":s.isActive},null,8,["is-active"])]),i(R,{id:s.id,intent:"view",onRunButtonHandler:ee},{default:l(()=>[n("View ")]),_:2},1032,["id"]),C.value?(d(),r(p,{key:0},[i(R,{id:s.id,intent:"edit",onRunButtonHandler:Z},{default:l(()=>[n("Edit ")]),_:2},1032,["id"]),i(R,{id:s.id,intent:"delete",onRunButtonHandler:ie},{default:l(()=>[n("Delete ")]),_:2},1032,["id"])],64)):L("",!0)]))),128))])])])):(d(),r("p",We,c(h(k).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[n("Всего записей: "),e("span",Xe,c(N.value.length),1)])])])])]),i(q,{id:"modalPopUp","close-func":te,"custom-classes":[""]},{title:l(()=>[t.isEditing?(d(),r("span",Ye,[n("Редактирование контрагента "),Ze,e("b",null,c(t.customer.name),1)])):(d(),r("span",et,"Добавление контрагента"))]),body:l(()=>[i(be),e("div",tt,[e("div",st,[i(b,{for:"name",required:""},{default:l(()=>[n("Название контрагента")]),_:1}),i(ye,{modelValue:t.customer.name,"onUpdate:modelValue":o[5]||(o[5]=s=>t.customer.name=s),type:"text",id:"name",placeholder:"Например: Уральская Бакалея, ООО"},null,8,["modelValue"])]),e("div",ot,[i(b,{for:"region_id",required:""},{default:l(()=>[n("Регион")]),_:1}),f(e("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>t.customer.regionId=s),onChange:o[7]||(o[7]=s=>{$(),t.customer.cityId=null}),id:"region_id",class:"form-select"},[lt,(d(!0),r(p,null,g(t.regions,s=>(d(),r("option",{value:s.id,key:s.id},c(s.name),9,it))),128))],544),[[M,t.customer.regionId]])]),t.customer.regionId?(d(),r("div",at,[i(b,{for:"city_id",required:""},{default:l(()=>[n("Город")]),_:1}),f(e("select",{"onUpdate:modelValue":o[8]||(o[8]=s=>t.customer.cityId=s),id:"city_id",class:"form-select"},[nt,(d(!0),r(p,null,g(t.cities,s=>(d(),r("option",{value:s.id,key:s.id},c(s.name),9,dt))),128))],512),[[M,t.customer.cityId]])])):L("",!0),e("div",rt,[i(b,{for:"user_id"},{default:l(()=>[n("Менеджер для контрагента")]),_:1}),f(e("select",{id:"user_id","onUpdate:modelValue":o[9]||(o[9]=s=>t.customer.userId=s),class:"form-select"},[ct,(d(!0),r(p,null,g(t.users,s=>(d(),r("option",{key:s.id,value:s.id},c(s.fullName),9,ut))),128))],512),[[M,t.customer.userId]])]),e("div",mt,[i(b,null,{default:l(()=>[n("Сброс привязки менеджера")]),_:1}),i(x,{onClick:o[10]||(o[10]=s=>t.customer.userId=null),type:"button",class:T(["btn-light",{"btn-disabled":t.customer.userId===null}]),disabled:t.customer.userId===null},{default:l(()=>[n(" Сбросить ")]),_:1},8,["class","disabled"])]),e("div",_t,[i(b,{for:"description"},{default:l(()=>[n("Описание для контрагента")]),_:1}),f(e("textarea",{id:"description","onUpdate:modelValue":o[11]||(o[11]=s=>t.customer.description=s),class:"form-control",placeholder:"Укажите произвольное описание"},null,512),[[ge,t.customer.description]])]),e("div",pt,[e("div",vt,[f(e("input",{id:"is-active","onUpdate:modelValue":o[12]||(o[12]=s=>t.customer.isActive=s),checked:t.customer.isActive,class:"form-check-input",type:"checkbox"},null,8,ft),[[we,t.customer.isActive]]),ht])])])]),footer:l(()=>[i(x,{onClick:le,type:"button",loading:h(k).isButtonDisabled,disabled:h(k).isButtonDisabled,class:T(["w-25",t.isEditing?"btn-warning":"btn-primary"])},{default:l(()=>[t.isEditing?(d(),r("span",bt,"Сохранить")):(d(),r("span",yt,"Создать"))]),_:1},8,["loading","disabled","class"])]),_:1}),i(q,{id:"viewModalPopUp","close-func":se,"custom-classes":["modal-lg","modal-dialog-scrollable"]},{title:l(()=>[n(" Просмотр контрагента "),e("b",null,c(t.customer.name),1)]),body:l(()=>[e("table",gt,[e("tbody",null,[e("tr",null,[wt,e("td",null,c(t.customer.id),1)]),e("tr",null,[It,e("td",null,c(t.customer.name),1)]),e("tr",null,[Et,e("td",null,c(t.customer.regionName),1)]),e("tr",null,[St,e("td",null,c(t.customer.cityName),1)]),e("tr",null,[Vt,e("td",null,c(t.customer.userName),1)]),e("tr",null,[kt,e("td",null,[i(H,{"is-active":t.customer.isActive},null,8,["is-active"])])])])])]),footer:l(()=>[Ut]),_:1})],64)}}};export{Ft as default};
