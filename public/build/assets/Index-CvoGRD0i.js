import{u as ae,a as ne,b as ie,d as w,r as $,e as le,A as E,c as a,f as e,s as U,C as ce,g as n,w as i,T as I,F as p,h as x,t as d,i as _,j as c,k as de,o,l as re,m as D,n as _e,p as ue,q as me,v as he,x as ye,R,L as M,E as pe,D as ve}from"./app-BPdZrYo3.js";import{u as ge}from"./useHttpService-BNZ4gPHT.js";import{u as fe}from"./useArrayHandlers-D3DGTb70.js";import{_ as be}from"./TheCheckbox-CGFEuL4J.js";import{_ as we,a as Ee}from"./TheFilter-BiC8Pmxx.js";import{_ as T}from"./TheBadge-DfL1MJO3.js";import{_ as H}from"./Modal-BJimFcRn.js";import{_ as ke,a as V}from"./TdButton-DMXdDj8-.js";import{f as Se}from"./formatters-hPmLyB9N.js";const Ce={class:"row mb-4"},Ae={class:"col-12"},Ie={class:"row mb-2"},xe={class:"col-12"},De={class:"col-md-4 mb-2"},Re={class:"col-md-4 mb-2"},Ve={class:"row mb-4"},Be={class:"col-12"},Le={class:"card"},$e={class:"card-body pb-0"},Ue={key:0,class:"table-responsive"},Me={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Te={scope:"row"},He={class:"text-start"},Ne={key:1,class:"mt-3 text-center lead"},Pe={class:"fw-bold"},Fe={key:0},Oe={key:1},Ge={class:"row g-3"},Ke={class:"col-12"},Ye={class:"col-12"},qe={class:"form-check"},je=["checked"],ze=e("label",{class:"form-check-label",for:"is-active"}," Группа товаров в продаже? ",-1),Je={key:0},Qe={key:1},We={key:0},Xe={class:"bd-callout bd-callout-info"},Ze={class:"table table-bordered text-center align-middle text-nowrap",style:{width:"100%"}},et={class:"table-light"},tt=e("th",null,"ID",-1),st=e("th",{class:"text-start"},"Формат",-1),ot=e("th",null,"Вес, г",-1),at={key:0},nt=e("th",null,"В продаже?",-1),it={class:"text-start"},lt={key:0},ct={key:1,class:"bd-callout bd-callout-warning"},dt=e("h5",null,"В группе нет продукции",-1),rt=e("hr",null,null,-1),_t=e("p",null,[c("Наполните группу товаров ассортиментом во вкладке "),e("b",null,"Справочники | Ассортимент"),c(".")],-1),ut=[dt,rt,_t],St={__name:"Index",setup(mt){const v=ae(),k=ne(),N=ie(),u=fe(),{get:P,post:F,update:O,destroy:G}=ge(),S=N.getUser.role,C=w(()=>S===R.SUPER_ADMIN),K=w(()=>C.value?M.concat(pe,ve):M),g=()=>({name:"",isActive:!0}),s=$({categories:[],category:g(),isEditing:!1}),h=$({name:"",isActive:!1});let m=null,y=null;function f(){s.isEditing=!1,s.category=g(),document.activeElement&&document.activeElement.blur()}le(async()=>{await b(),m=new bootstrap.Modal(document.getElementById("modalPopUp")),m._element.addEventListener("hide.bs.modal",f)});const b=async()=>{const{data:l}=await P(E.CATEGORY,{params:{category_is_active:!1,product_is_active:!0,products:!0}});s.categories=l.categories},B=l=>s.categories.find(r=>r.id===l),Y=()=>{v.clear(),s.isEditing=!1,s.category=g(),m.show()},q=l=>{v.clear(),s.isEditing=!0,s.category=B(l),m.show()},j=l=>{y=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.category=B(l),y.show(),y._element.addEventListener("hide.bs.modal",f)},z=()=>{m.hide(),m._element.removeEventListener("hide.bs.modal",f)},J=()=>{y.hide(),y._element.removeEventListener("hide.bs.modal",f)},Q=()=>{u.resetSearchKeys(h),u.resetSortKeys()},W=async()=>{if(s.isEditing){const l=await O(`${E.CATEGORY}/${s.category.id}`,s.category);l&&l.status==="success"&&(v.clear(),m.hide(),await b())}else{const l=await F(E.CATEGORY,s.category);l&&l.status==="success"&&(v.clear(),s.category=g(),m.hide(),u.resetSearchKeys(h),u.resetSortKeys("id",!1),await b())}},X=async l=>{if(confirm("Точно удалить группу товаров? Уверены?")){const{status:r}=await G(`${E.CATEGORY}/${l}`);r==="success"&&await b()}},Z=w(()=>u.sortArray(s.categories)),A=w(()=>u.filterArray(Z.value,h));return(l,r)=>{const ee=de("RouterLink");return o(),a(p,null,[e("div",Ce,[e("div",Ae,[U(n(I,{class:"btn-primary",onClick:Y},{default:i(()=>[c("Новая группа товаров ")]),_:1},512),[[ce,C.value]])])]),e("div",Ie,[e("div",xe,[n(we,{onResetFilter:Q},{default:i(()=>[e("div",De,[n(Ee,{modelValue:h.name,"onUpdate:modelValue":r[0]||(r[0]=t=>h.name=t),placeholder:"Поиск по названию группы товаров"},{default:i(()=>[c("Группа товаров ")]),_:1},8,["modelValue"])]),e("div",Re,[n(be,{id:"is_active",modelValue:h.isActive,"onUpdate:modelValue":r[1]||(r[1]=t=>h.isActive=t)},{default:i(()=>[c("В продаже? ")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Ve,[e("div",Be,[e("div",Le,[e("div",$e,[A.value.length>0?(o(),a("div",Ue,[e("table",Me,[e("thead",null,[e("tr",null,[(o(!0),a(p,null,x(K.value,({column:t,label:te,sortable:se,is_num:L,width:oe})=>(o(),re(ke,{key:t,column:t,"is-numeric":L,"sort-by-asc":_(u).sortBy.asc,"sort-by-column":_(u).sortBy.column===t,sortable:se,width:oe,onSetSort:ht=>_(u).setSort(t,L)},{default:i(()=>[c(d(te),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(o(!0),a(p,null,x(A.value,t=>(o(),a("tr",{key:t.id},[e("th",Te,d(t.id),1),e("td",He,[n(ee,{to:{name:"Category.View",params:{id:t.id}}},{default:i(()=>[c(d(t.name),1)]),_:2},1032,["to"])]),e("td",null,d(t.productsCount),1),e("td",null,[n(T,{"is-active":t.isActive},null,8,["is-active"])]),n(V,{id:t.id,intent:"view",onRunButtonHandler:j},{default:i(()=>[c("View ")]),_:2},1032,["id"]),C.value?(o(),a(p,{key:0},[n(V,{id:t.id,intent:"edit",onRunButtonHandler:q},{default:i(()=>[c("Edit ")]),_:2},1032,["id"]),n(V,{id:t.id,intent:"delete",onRunButtonHandler:X},{default:i(()=>[c("Delete ")]),_:2},1032,["id"])],64)):D("",!0)]))),128))])])])):(o(),a("p",Ne,d(_(k).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[c("Всего записей: "),e("span",Pe,d(A.value.length),1)])])])])]),n(H,{id:"modalPopUp","close-func":z,"custom-classes":[""]},{title:i(()=>[s.isEditing?(o(),a("span",Fe,[c("Редактирование группы товаров "),e("b",null,d(s.category.name),1)])):(o(),a("span",Oe,"Добавление группы товаров"))]),body:i(()=>[n(_e),e("div",Ge,[e("div",Ke,[n(ue,{for:"name",required:""},{default:i(()=>[c("Название группы товаров")]),_:1}),n(me,{id:"name",modelValue:s.category.name,"onUpdate:modelValue":r[2]||(r[2]=t=>s.category.name=t),placeholder:"Например: Granmulino Премиум",type:"text"},null,8,["modelValue"])]),e("div",Ye,[e("div",qe,[U(e("input",{id:"is-active","onUpdate:modelValue":r[3]||(r[3]=t=>s.category.isActive=t),checked:s.category.isActive,class:"form-check-input",type:"checkbox"},null,8,je),[[he,s.category.isActive]]),ze])])])]),footer:i(()=>[n(I,{class:ye([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:_(k).isButtonDisabled,loading:_(k).isButtonDisabled,type:"button",onClick:W},{default:i(()=>[s.isEditing?(o(),a("span",Je,"Сохранить")):(o(),a("span",Qe,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),n(H,{id:"viewModalPopUp","close-func":J,"custom-classes":["modal-dialog-scrollable"]},{title:i(()=>[c(" Просмотр группы товаров "),e("b",null,d(s.category.name),1)]),body:i(()=>[s.category.productsCount>0?(o(),a("div",We,[e("div",Xe,[e("p",null,[c("Кол-во SKU в группе: "),e("strong",null,d(s.category.productsCount),1)])]),e("table",Ze,[e("thead",et,[e("tr",null,[tt,st,ot,_(S)===_(R).PRICE_ADMIN?(o(),a("th",at,"Цена, руб.")):D("",!0),nt])]),e("tbody",null,[(o(!0),a(p,null,x(s.category.products,t=>(o(),a("tr",{key:t.id},[e("td",null,d(t.id),1),e("td",it,d(t.name),1),e("td",null,d(_(Se)(t.weight)),1),_(S)===_(R).PRICE_ADMIN?(o(),a("td",lt,d(t.price),1)):D("",!0),e("td",null,[n(T,{"is-active":t.isActive},null,8,["is-active"])])]))),128))])])])):(o(),a("div",ct,ut))]),footer:i(()=>[n(I,{class:"btn-light"})]),_:1})],64)}}};export{St as default};
