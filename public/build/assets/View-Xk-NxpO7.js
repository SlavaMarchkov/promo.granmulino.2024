import{o as a,c as _,f as e,t as R,s as j,M as F,a0 as $,g as c,w as d,x as T,T as x,l as U,F as E,h as N,m as P,a as H,r as Q,j as B,p as W,q as X,i as I,u as Y,a2 as O,n as z,a1 as C,y as V,e as Z,d as ee,H as se,z as le,B as te,k as re}from"./app-CcRn7-yu.js";import{u as J}from"./useHttpService-F7Gi0evP.js";import{u as ie}from"./useArrayHandlers-HI3WadKX.js";import{_ as oe}from"./TheCheckbox-B4dmdo2T.js";import{_ as ae}from"./TheBadge-BlMSyGe5.js";import{T as ne}from"./TheSpinner-DbgObbVj.js";import{a as q,_ as M}from"./TwoColumnRow-DboPzJPi.js";const ce={class:"input-group mb-2"},ue={class:"input-group-text"},de=["disabled"],pe=e("i",{class:"bi-arrow-up"},null,-1),ve=e("i",{class:"bi-arrow-down"},null,-1),_e=e("i",{class:"bi-trash"},null,-1),G={__name:"SellerItem",props:{seller:{type:Object,required:!0},index:{type:Number,default:1}},emits:["updateSeller","destroySeller"],setup(S,{emit:y}){const s=S,o=y,h=()=>{s.seller.isActive=!s.seller.isActive,o("updateSeller",s.seller)},b=()=>{o("updateSeller",s.seller)},n=()=>{s.seller.isSupervisor=!0,o("updateSeller",s.seller)},r=()=>{s.seller.supervisorId=null,o("updateSeller",s.seller)},p=()=>{o("destroySeller",s.seller)};return(m,v)=>(a(),_("div",null,[e("div",ce,[e("span",ue,R(S.index+1),1),j(e("input",{type:"text",class:"form-control","onUpdate:modelValue":v[0]||(v[0]=D=>s.seller.name=D),disabled:!s.seller.isActive,style:$(s.seller.isActive?"":"cursor: not-allowed;")},null,12,de),[[F,s.seller.name]]),c(x,{onClick:b,class:"btn-outline-primary fs-5 pt-1 pb-0",disabled:!s.seller.isActive,style:$(s.seller.isActive?"":"cursor: not-allowed;"),title:"Сохранить изменения"},{default:d(()=>[e("i",{class:T(s.seller.isActive!==!1?"bi-check-lg":"bi-dash")},null,2)]),_:1},8,["disabled","style"]),s.seller.supervisorId===null?(a(),U(x,{key:0,onClick:n,class:"btn-outline-secondary fs-5 pt-1 pb-0",disabled:!s.seller.isActive,style:$(s.seller.isActive?"":"cursor: not-allowed;"),title:"Сделать супервайзером"},{default:d(()=>[pe]),_:1},8,["disabled","style"])):(a(),U(x,{key:1,onClick:r,class:"btn-outline-secondary fs-5 pt-1 pb-0",disabled:!s.seller.isActive,style:$(s.seller.isActive?"":"cursor: not-allowed;"),title:"Переместить в ТП"},{default:d(()=>[ve]),_:1},8,["disabled","style"])),c(x,{onClick:h,class:T(["fs-5 pt-1 pb-0",s.seller.isActive===!1?"btn-outline-success":"btn-outline-danger"]),title:s.seller.isActive!==!1?"Деактивировать":"Активировать"},{default:d(()=>[e("i",{class:T(s.seller.isActive!==!1?"bi-x-lg":"bi-arrow-counterclockwise")},null,2)]),_:1},8,["class","title"]),c(x,{onClick:p,class:"btn-outline-danger fs-5 pt-1 pb-0",disabled:s.seller.isActive||s.seller.supervisorId!==null,style:$(s.seller.isActive||s.seller.supervisorId!==null?"cursor: not-allowed;":""),title:"Удалить"},{default:d(()=>[_e]),_:1},8,["disabled","style"])])]))}},fe={class:"input-group mb-2"},be={class:"input-group-text"},me=["disabled"],ye=e("i",{class:"bi-arrow-down"},null,-1),he=e("i",{class:"bi-trash"},null,-1),Se={key:0,class:"ps-5"},ge={__name:"SupervisorItem",props:{supervisor:{type:Object,required:!0},index:{type:[Number,String]}},emits:["updateSeller","destroySeller","updateSupervisor","destroySupervisor"],setup(S,{emit:y}){const s=S,o=y,h=v=>{v.isSupervisor===!0&&(v.supervisorId=null),o("updateSeller",v)},b=v=>{o("destroySeller",v)},n=()=>{s.supervisor.isActive=!s.supervisor.isActive,o("updateSupervisor",s.supervisor)},r=()=>{o("updateSupervisor",s.supervisor)},p=()=>{s.supervisor.isSupervisor=!1,o("updateSupervisor",s.supervisor)},m=()=>{o("destroySupervisor",s.supervisor)};return(v,D)=>(a(),_("div",null,[e("div",fe,[e("span",be,R(S.index+1),1),j(e("input",{type:"text",class:"form-control fw-bold","onUpdate:modelValue":D[0]||(D[0]=g=>s.supervisor.name=g),disabled:!s.supervisor.isActive,style:$(s.supervisor.isActive?"":"cursor: not-allowed;")},null,12,me),[[F,s.supervisor.name]]),c(x,{onClick:r,class:"btn-outline-primary fs-5 pt-1 pb-0",disabled:!s.supervisor.isActive,style:$(s.supervisor.isActive?"":"cursor: not-allowed;"),title:"Сохранить изменения"},{default:d(()=>[e("i",{class:T(s.supervisor.isActive!==!1?"bi-check-lg":"bi-dash")},null,2)]),_:1},8,["disabled","style"]),c(x,{onClick:p,class:"btn-outline-secondary fs-5 pt-1 pb-0",disabled:s.supervisor.sellers.length>0,style:$(s.supervisor.sellers.length>0?"cursor: not-allowed;":""),title:"Разжаловать в ТП"},{default:d(()=>[ye]),_:1},8,["disabled","style"]),c(x,{onClick:n,class:T(["fs-5 pt-1 pb-0",s.supervisor.isActive===!1?"btn-outline-success":"btn-outline-danger"]),disabled:s.supervisor.sellers.length>0,style:$(s.supervisor.sellers.length>0?"cursor: not-allowed;":""),title:s.supervisor.isActive!==!1?"Деактивировать":"Активировать"},{default:d(()=>[e("i",{class:T(s.supervisor.isActive!==!1?"bi-x-lg":"bi-arrow-counterclockwise")},null,2)]),_:1},8,["class","disabled","style","title"]),c(x,{onClick:m,class:"btn-outline-danger fs-5 pt-1 pb-0",disabled:s.supervisor.sellers.length>0||s.supervisor.isActive,style:$(s.supervisor.sellers.length>0||s.supervisor.isActive?"cursor: not-allowed;":""),title:"Удалить"},{default:d(()=>[he]),_:1},8,["disabled","style"])]),s.supervisor.sellers.length>0?(a(),_("div",Se,[(a(!0),_(E,null,N(s.supervisor.sellers,(g,l)=>(a(),U(G,{key:g.id,seller:g,index:l,onUpdateSeller:i=>h(g),onDestroySeller:i=>b(g)},null,8,["seller","index","onUpdateSeller","onDestroySeller"]))),128))])):P("",!0)]))}},Ae={class:"row g-2"},$e={class:"col-md-5"},xe={class:"col-md-5"},we={class:"col-md-2"},ke={__name:"AddSellerItem",props:{customerId:{type:Number,required:!0}},emits:["saveSeller"],setup(S,{emit:y}){const s=H(),o=S,h=()=>({customerId:o.customerId,supervisorId:"",name:"",isActive:!0,isSupervisor:!1}),b=Q({seller:h()}),n=y,r=()=>{n("saveSeller",b.seller),b.seller=h()};return(p,m)=>(a(),_(E,null,[c(W,{for:"sellerName",required:""},{default:d(()=>[B("Новый торговый представитель или супервайзер")]),_:1}),e("div",Ae,[e("div",$e,[c(X,{id:"sellerName",modelValue:b.seller.name,"onUpdate:modelValue":m[0]||(m[0]=v=>b.seller.name=v),placeholder:"ФИО торгового представителя"},null,8,["modelValue"])]),e("div",xe,[c(oe,{id:"isSupervisor",modelValue:b.seller.isSupervisor,"onUpdate:modelValue":m[1]||(m[1]=v=>b.seller.isSupervisor=v)},{default:d(()=>[B("Отметить, если ТП - это супервайзер")]),_:1},8,["modelValue"])]),e("div",we,[c(x,{onClick:r,class:"btn-success w-100",loading:I(s).isLoading,disabled:I(s).isLoading},{default:d(()=>[B("Добавить")]),_:1},8,["loading","disabled"])])])],64))}},Ce=e("h4",{class:"mb-3"},"Супервайзеры с привязанными ТП",-1),Be={key:0,class:"row"},De={key:1,class:"row"},Ee=e("div",{class:"col-12"},[e("div",{class:"bd-callout bd-callout-warning mb-0"},[e("p",{class:"mb-0"},[e("span",{class:"fw-bold text-danger"},"Не добавлено ни одного супервайзера!"),e("br"),B("Введите поочерёдно ФИО супервайзеров, отметив при этом галочку.")])])],-1),Re=[Ee],Te=e("hr",null,null,-1),Ue=e("h4",{class:"mb-3"},"Торговые представители без привязки к супервайзерам",-1),Le={key:2,class:"row"},Ne={key:3,class:"row"},Ve=e("div",{class:"col-12"},[e("div",{class:"bd-callout bd-callout-warning mb-0"},[e("p",{class:"mb-0"},[B("Наполните команду:"),e("br"),B("Шаг 1. Введите поочерёдно ФИО торговых представителей."),e("br"),B("Шаг 2. Привяжите их к супервайзерам перетаскиванием мышкой.")])])],-1),Me=[Ve],Ie=e("hr",null,null,-1),Oe={__name:"TheSellers",props:{customerId:{type:Number,required:!0},supervisors:{type:Array,required:!0,default:[]},sellers:{type:Array,required:!0,default:[]}},emits:["updateSellers"],setup(S,{emit:y}){const{post:s,update:o,destroy:h}=J(),b=Y(),n=S,r=y,p=async l=>{const{status:i,data:t}=await s(`${C.CUSTOMER}/${n.customerId}${C.SELLER}`,l);i==="success"&&(b.clear(),r("updateSellers",t))},m=async l=>{const{status:i,data:t}=await o(`${C.CUSTOMER}/${n.customerId}${C.SELLER}/${l.id}`,l);i==="success"&&(b.clear(),r("updateSellers",t))},v=async l=>{if(confirm("Точно удалить сотрудника? Уверены?")){const{status:i,data:t}=await h(`${C.CUSTOMER}/${n.customerId}${C.SELLER}/${l.id}`,l);i==="success"&&(console.log(t),r("updateSellers",t))}};function D(l,i){const t=JSON.parse(l.dataTransfer.getData("item"));t.supervisorId=i,m(t)}function g(l,i){l.dataTransfer.dropEffect="move",l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("item",JSON.stringify(i))}return(l,i)=>(a(),_(E,null,[Ce,n.supervisors.length>0?(a(),_("div",Be,[(a(!0),_(E,null,N(n.supervisors,(t,A)=>(a(),U(ge,{key:t.id,supervisor:t,index:A,onDrop:w=>D(w,t.id),onDragover:i[0]||(i[0]=O(()=>{},["prevent"])),onDragenter:i[1]||(i[1]=O(()=>{},["prevent"])),onUpdateSupervisor:m,onDestroySupervisor:v,onUpdateSeller:m,onDestroySeller:v},null,8,["supervisor","index","onDrop"]))),128))])):(a(),_("div",De,Re)),Te,Ue,n.sellers.length>0?(a(),_("div",Le,[(a(!0),_(E,null,N(n.sellers,(t,A)=>(a(),U(G,{key:t.id,seller:t,index:A,onDragstart:w=>g(w,t),draggable:!!t.isActive,onUpdateSeller:m,onDestroySeller:v},null,8,["seller","index","onDragstart","draggable"]))),128))])):(a(),_("div",Ne,Me)),Ie,c(z),c(ke,{"customer-id":n.customerId,onSaveSeller:p},null,8,["customer-id"])],64))}},qe={key:0,class:"row"},je={class:"col-12"},Fe={class:"my-4"},He={key:0,class:"row profile"},ze={class:"col-xl-4"},Je={class:"mb-0"},Ge=e("h4",{class:"mb-0"},"Торговые сети",-1),Ke={key:0,class:"list-group"},Pe={class:"fw-bold"},Qe=e("span",{class:"text-primary"},"Подробнее",-1),We={key:1,class:"mb-0"},Xe={class:"col-xl-8"},Ye={class:"card"},Ze={class:"card-body pt-3"},es=e("ul",{class:"nav nav-tabs nav-tabs-bordered",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active","data-bs-toggle":"tab","data-bs-target":"#profile-overview","aria-selected":"true",role:"tab"},"Профиль")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link","data-bs-toggle":"tab","data-bs-target":"#profile-edit","aria-selected":"false",tabindex:"-1",role:"tab"},"Прайс-лист")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link","data-bs-toggle":"tab","data-bs-target":"#profile-settings","aria-selected":"false",tabindex:"-1",role:"tab"},"Настройки")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link","data-bs-toggle":"tab","data-bs-target":"#the-sellers","aria-selected":"false",tabindex:"-1",role:"tab"},"Команда ТП")])],-1),ss={class:"tab-content pt-2"},ls=e("div",{class:"tab-pane fade show active profile-overview",id:"profile-overview",role:"tabpanel"},[e("h5",{class:"card-title"},"В разработке")],-1),ts=e("div",{class:"tab-pane fade profile-edit pt-3",id:"profile-edit",role:"tabpanel"},[e("h5",{class:"card-title"},"В разработке")],-1),rs=e("div",{class:"tab-pane fade pt-3",id:"profile-settings",role:"tabpanel"},[e("h5",{class:"card-title"},"В разработке")],-1),is={class:"tab-pane fade pt-1",id:"the-sellers",role:"tabpanel"},os=e("hr",null,null,-1),_s={__name:"View",setup(S){const y=le();te();const s=H(),o=ie(),{get:h}=J(),b=+y.params.id,n=V({}),r=V([]),p=V([]);Z(async()=>{await v(b)});const m=ee(()=>Object.keys(n.value).length!==0),v=async l=>{await h(`${C.CUSTOMER}/${l}`,{params:{city:!0,region:!0,retailers:!0,customer_supervisors:!1,customer_sellers:!1}}).then(({status:i,data:t})=>{i==="success"&&(n.value=t)}).then(()=>D(l))},D=async l=>{const{status:i,data:t}=await h(`${C.CUSTOMER}/${l}${C.SELLER}`);if(i==="success"){r.value=t.sellers.filter(f=>f.isSupervisor===!0),t.sellers.filter(f=>!r.value.includes(f)).forEach(f=>{if(f.isSupervisor!==!0&&f.supervisorId===null)p.value.push(f);else{const k=r.value.findIndex(K=>K.id===f.supervisorId);r.value[k].sellers.push(f);const L=o.sortArrayByStringColumn(r.value[k].sellers,"name");r.value[k].sellers=o.sortArrayByBoolean(L,"isActive")}});const w=o.sortArrayByStringColumn(p.value,"name");p.value=o.sortArrayByBoolean(w,"isActive");const u=o.sortArrayByStringColumn(r.value,"name");r.value=o.sortArrayByBoolean(u,"isActive")}};se(()=>y.params.id,()=>v(y.params.id));const g=l=>{const i=p.value.findIndex(u=>u.id===l.id),t=r.value.findIndex(u=>u.id===l.id);if(i===-1&&t===-1&&l.isSupervisor===!1&&l.supervisorId!==null){const u=r.value.findIndex(L=>L.id===l.supervisorId),f=r.value[u].sellers.findIndex(L=>L.id===l.id);r.value[u].sellers[f]=l;const k=o.sortArrayByStringColumn(r.value[u].sellers,"name");r.value[u].sellers=o.sortArrayByBoolean(k,"isActive")}if(i===-1&&t===-1&&l.isSupervisor===!0&&l.supervisorId===null&&(l.sellers.length===0?r.value.push(l):r.value.forEach(({sellers:u})=>{const f=u.findIndex(k=>k.id===l.id);u.splice(f,1)})),i===-1&&t===-1&&l.isSupervisor===!1&&l.supervisorId===null&&(p.value.push(l),r.value.forEach(({sellers:u})=>{const f=u.findIndex(k=>k.id===l.id);f!==-1&&(u.splice(f,1),o.sortArrayByStringColumn(u,"name"))})),i===-1&&t!==-1&&l.isSupervisor===!1&&l.supervisorId===null&&(p.value.push(l),r.value.splice(t,1)),i!==-1&&t===-1&&l.isSupervisor===!0&&(r.value.push(l),p.value.splice(i,1)),i!==-1&&t===-1&&l.isSupervisor===!1&&l.supervisorId!==null){p.value.splice(i,1);const u=r.value.findIndex(f=>f.id===l.supervisorId);r.value[u].sellers.push(l),o.sortArrayByStringColumn(r.value[u].sellers,"name")}if(i!==-1&&t===-1&&l.isSupervisor===!1&&l.supervisorId===null&&(l.deletedAt!==null?p.value.splice(i,1):p.value[i]=l),t!==-1&&l.isSupervisor===!0)if(l.deletedAt!==null)r.value.splice(t,1);else{const u=r.value[t].sellers;r.value[t]=l,r.value[t].sellers=u}const A=o.sortArrayByStringColumn(p.value,"name");p.value=o.sortArrayByBoolean(A,"isActive");const w=o.sortArrayByStringColumn(r.value,"name");r.value=o.sortArrayByBoolean(w,"isActive")};return(l,i)=>{const t=re("RouterLink");return a(),_(E,null,[I(s).isLoading?(a(),_("div",qe,[e("div",je,[e("h4",Fe,[c(ne)])])])):(a(),_(E,{key:1},[m.value?(a(),_("div",He,[e("div",ze,[c(q,{"body-classes":["profile-card pt-2 d-flex flex-column"],"header-classes":["bg-light"],class:"mb-4"},{header:d(()=>[e("h2",Je,R(n.value.name),1)]),body:d(()=>[c(M,{cols:"3",title:"<h3>Регион</h3>"},{default:d(()=>[e("h3",null,R(n.value.region.name),1)]),_:1}),c(M,{title:"<h3>Город</h3>"},{default:d(()=>[e("h3",null,R(n.value.city.name),1)]),_:1}),c(M,{title:"<h3>Работает</h3>"},{default:d(()=>[c(ae,{"is-active":n.value.isActive},null,8,["is-active"])]),_:1})]),_:1}),c(q,{"header-classes":["bg-light"]},{header:d(()=>[Ge]),body:d(()=>[n.value.retailers.length>0?(a(),_("div",Ke,[(a(!0),_(E,null,N(n.value.retailers,(A,w)=>(a(),_("button",{key:A.id,class:"list-group-item list-group-item-action",type:"button"},[c(t,{to:{name:"Manager.Retailer.View",params:{id:A.id}},class:"d-flex justify-content-between text-black"},{default:d(()=>[e("span",null,[B(R(w+1)+". ",1),e("span",Pe,R(A.name),1)]),Qe]),_:2},1032,["to"])]))),128))])):(a(),_("p",We,"Дистрибутор не имеет торговых сетей."))]),_:1})]),e("div",Xe,[e("div",Ye,[e("div",Ze,[es,e("div",ss,[ls,ts,rs,e("div",is,[c(Oe,{"customer-id":b,supervisors:r.value,sellers:p.value,onUpdateSellers:g},null,8,["supervisors","sellers"])])])])])])])):(a(),U(z,{key:1,class:"mt-3"}))],64)),os,c(t,{to:{name:"Manager.Customer.Index"},class:"btn btn-secondary my-2",role:"button"},{default:d(()=>[B("Обратно на Мои Контрагенты ")]),_:1})],64)}}};export{_s as default};
