import{B as q,o as f,c as g,f as t,g as _,x as C,q as y,i as F,al as R,w as V,T as Q,r as D,d as I,t as w,F as E,h as j,l as O,m as M,Z as z,k as G,j as x,p as U,N as W}from"./app-LDVDDXIB.js";import{u as Z}from"./useHttpService-H3Bhthf8.js";import{u as J}from"./useArrayHandlers-JXOu8LuP.js";import{c as P,f as k,b as T}from"./formatters-k0Na949k.js";import{u as K,_ as L}from"./InputRange-Cp8YmIPk.js";const X={class:"list-group-item m-0 px-2"},Y={class:"row g-2"},ee={class:"col-md-5 col-sm-12"},se={class:"col-md-2 col-sm-6"},le={class:"col-md-2 col-sm-6"},te={class:"col-md-2 col-sm-6"},oe={class:"col-md-1 col-sm-6 text-center"},ae=t("i",{class:"bi-x-lg"},null,-1),H={__name:"SalesPeopleSellerItem",props:{seller:{type:Object,required:!0},index:{type:Number,default:0}},emits:["addSeller"],setup(b,{emit:N}){const{calcSalesSurplus:m}=K(),c=b,v=N;q(()=>c.seller.compensationPlan,a=>B(a,c.index));const A=(a,o)=>{const l=c.seller,e=document.getElementById(`${o}_salesBefore`),s=document.getElementById(`${o}_surplusPlan`),r=document.getElementById(`${o}_salesPlan`);let d=P(a.target.value),i,p,S;isNaN(d)?(i=0,p=0,S=0,e.value="",s.value="",r.value="",s.setAttribute("readonly","readonly"),s.setAttribute("tabindex","-1"),r.setAttribute("readonly","readonly"),r.setAttribute("tabindex","-1")):d===0?(i=0,p=0,S=0,s.value=i,r.value=p,s.setAttribute("readonly","readonly"),s.setAttribute("tabindex","-1"),r.removeAttribute("readonly"),r.removeAttribute("tabindex")):(i=s.value===""?R:P(s.value),p=m(d,i),S=h(p,c.seller.compensationPlan),e.value=k(d),r.value=T(p),r.setAttribute("tabindex","-1"),r.setAttribute("readonly","readonly"),s.removeAttribute("readonly"),s.value=i),l.sellerId=l.id,l.salesBefore=d,l.surplusPlan=i,l.salesPlan=p,l.budgetPlan=S,v("addSeller",l)},n=(a,o)=>{let l=c.seller;const e=document.getElementById(`${o}_salesBefore`),s=document.getElementById(`${o}_surplusPlan`),r=document.getElementById(`${o}_salesPlan`);let d=P(e.value),i=P(a.target.value),p,S;isNaN(i)&&(i=0,s.value=i),p=+(d+d*i/100).toFixed(2),S=h(p,c.seller.compensationPlan),s.value=k(i),r.value=T(p),l.sellerId=l.id,l.salesBefore=d,l.surplusPlan=i,l.salesPlan=p,l.budgetPlan=S,v("addSeller",l)},$=(a,o)=>{const l=c.seller,e=document.getElementById(`${o}_salesPlan`);let s=P(a.target.value),r=0,d=0,i=0;isNaN(s)?(s=0,e.value=s):(i=h(s,c.seller.compensationPlan),s=+s.toFixed(2),e.value=k(s)),l.salesBefore=r,l.surplusPlan=d,l.salesPlan=s,l.budgetPlan=i,v("addSeller",l)},B=(a,o)=>{const l=c.seller,e=document.getElementById(`${o}_salesBefore`),s=document.getElementById(`${o}_surplusPlan`),r=document.getElementById(`${o}_salesPlan`),d=P(e.value),i=P(s.value),p=r.value===""?0:P(r.value),S=h(p,a);l.sellerId=l.id,l.salesBefore=d,l.surplusPlan=i,l.salesPlan=p,l.budgetPlan=S,v("addSeller",l)},h=(a,o)=>{const l=P(o.toString());return+(a*l/100).toFixed(2)},u=a=>{const o=c.seller,l=document.getElementById(`${a}_salesBefore`),e=document.getElementById(`${a}_surplusPlan`),s=document.getElementById(`${a}_salesPlan`);l.value="",e.value="",s.value="",e.setAttribute("readonly","readonly"),s.setAttribute("readonly","readonly"),o.salesBefore=0,o.surplusPlan=0,o.salesPlan=0,o.budgetPlan=0,v("addSeller",o)};return(a,o)=>(f(),g("li",X,[t("div",Y,[t("div",ee,[_(y,{value:c.seller.shortName,class:C({"border-danger":!c.seller.supervisorId}),readonly:"",tabindex:-1},null,8,["value","class"])]),t("div",se,[_(y,{id:`${b.index}_salesBefore`,class:C(["text-end",{"border-danger":!c.seller.supervisorId}]),onInput:o[0]||(o[0]=l=>A(l,b.index))},null,8,["id","class"])]),t("div",le,[_(y,{id:`${b.index}_surplusPlan`,class:C(["text-end",{"border-danger":!c.seller.supervisorId}]),"model-value":F(R),onInput:o[1]||(o[1]=l=>n(l,b.index)),maxlength:"3",readonly:"readonly"},null,8,["id","class","model-value"])]),t("div",te,[_(y,{id:`${b.index}_salesPlan`,class:C(["text-end",{"border-danger":!c.seller.supervisorId}]),onInput:o[2]||(o[2]=l=>$(l,b.index)),readonly:"readonly",tabindex:-1},null,8,["id","class"])]),t("div",oe,[_(Q,{class:"btn-outline-danger",onClick:o[3]||(o[3]=l=>u(b.index))},{default:V(()=>[ae]),_:1})])])]))}},ne={class:"list-group-item m-0 px-2"},re={class:"row g-2"},de={class:"col-md-5 col-sm-12"},ie={class:"input-group"},ce={class:"input-group-text"},ue=["value"],me={class:"col-md-2 col-sm-6"},ve={class:"col-md-2 col-sm-6"},_e={class:"col-md-2 col-sm-6"},pe=t("div",{class:"col-md-1 col-sm-6 text-center"},null,-1),fe={__name:"SalesPeopleSupervisorItem",props:{supervisor:{type:Object,required:!0},index:{type:Number,default:0},sellers:{type:Array,required:!0,default:()=>[]}},emits:["addToCheckedSellers"],setup(b,{emit:N}){const m=b,c=N,v=D({sellers:[]});q(()=>m.supervisor.compensationPlan,u=>n(u));const A=u=>{c("addToCheckedSellers",u);const a=v.sellers.findIndex(s=>s.id===u.id);a===-1?v.sellers.push(u):v.sellers[a]={...u};const o=document.getElementById(`${m.index}_SV_salesBefore`),l=document.getElementById(`${m.index}_SV_salesPlan`);o.value=$.value===0?"":k($.value),l.value=B.value===0?"":T(B.value);const e=m.supervisor;e.sellerId=e.id,e.salesBefore=$.value,e.salesPlan=B.value,e.budgetPlan=h(B.value,m.supervisor.compensationPlan),c("addToCheckedSellers",e)},n=u=>{const a=document.getElementById(`${m.index}_SV_salesBefore`),o=document.getElementById(`${m.index}_SV_salesPlan`),l=P(a.value),e=o.value===""?0:P(o.value),s=h(e,u),r=m.supervisor;r.sellerId=r.id,r.salesBefore=l,r.salesPlan=e,r.budgetPlan=s,c("addToCheckedSellers",r)},$=I(()=>v.sellers.reduce((u,a)=>(isNaN(a.salesBefore)&&(a.salesBefore=0),+(u+a.salesBefore).toFixed(0)),0)),B=I(()=>v.sellers.reduce((u,a)=>+(u+a.salesPlan).toFixed(0),0)),h=(u,a)=>{const o=P(a.toString());return+(u*o/100).toFixed(2)};return(u,a)=>(f(),g(E,null,[t("li",ne,[t("div",re,[t("div",de,[t("div",ie,[t("span",ce,w(b.index+1),1),t("input",{value:m.supervisor.shortName,class:"form-control fw-bold",readonly:"",type:"text",tabindex:-1},null,8,ue)])]),t("div",me,[_(y,{id:`${m.index}_SV_salesBefore`,class:"fw-bold border-primary text-end",readonly:"",tabindex:-1},null,8,["id"])]),t("div",ve,[_(y,{disabled:"disabled"})]),t("div",_e,[_(y,{id:`${m.index}_SV_salesPlan`,class:"fw-bold border-success text-end",readonly:"",tabindex:-1},null,8,["id"])]),pe])]),(f(!0),g(E,null,j(m.sellers,(o,l)=>(f(),g(E,{key:o.id},[o.supervisorId===m.supervisor.id?(f(),O(H,{key:0,seller:o,index:l,onAddSeller:A},null,8,["seller","index"])):M("",!0)],64))),128))],64))}},be={class:"card"},Pe={class:"card-header bg-secondary text-white"},ge={class:"card-body mt-3"},he={class:"d-flex justify-content-between align-items-center"},ye=t("h4",{class:"mb-0"},"Планируемый бюджет на промо-акцию:",-1),Se={class:"text-primary fw-bold mb-0"},xe=t("hr",null,null,-1),Be={key:0,class:"mt-5 alert alert-warning alert-dismissible fade show",role:"alert"},$e=t("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),Ie={class:"mt-3 alert border-primary fade show",role:"alert"},Ee={class:"mb-0"},we={class:"fw-bold text-primary"},ke={key:0,class:"mt-4 alert alert-warning alert-dismissible fade show",role:"alert"},Ne=t("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),Ae={key:1},Ce={class:"row mb-3"},Fe=t("hr",null,null,-1),Ve=t("p",null,[t("span",{class:"fw-bold text-primary"},"Шаг 1."),x(" Настройте процент мотивации для супервайзеров и торговых представителей:")],-1),Te={class:"col-md-6 col-sm-12"},je={class:"fw-bold text-primary fs-5"},Oe={class:"col-md-6 col-sm-12"},qe={class:"fw-bold text-primary fs-5"},Re=t("hr",null,null,-1),Ue=t("p",null,[t("span",{class:"fw-bold text-primary"},"Шаг 2."),x(" Введите факт и план продаж (в рублях) для торговых представителей, участвующих в акции.")],-1),Le={class:"list-group"},De=W('<li class="list-group-item m-0 px-2"><div class="row g-2 text-center align-items-center p-0"><div class="col-md-5 col-sm-12">ФИО</div><div class="col-md-2 col-sm-6">Продажи, факт</div><div class="col-md-2 col-sm-6">План, %</div><div class="col-md-2 col-sm-6">Продажи, план</div><div class="col-md-1 col-sm-6">Del</div></div></li>',1),Me={class:"list-group-item m-0 px-2 bg-warning-light"},He={class:"row g-2 text-center align-items-center p-0"},Qe=t("div",{class:"col-md-5 col-sm-12"},[t("span",{class:"fw-bold"},"ИТОГО")],-1),ze={class:"col-md-2 col-sm-6"},Ge={class:"col-md-2 col-sm-6"},We={class:"col-md-2 col-sm-6"},Ze=t("div",{class:"col-md-1 col-sm-6"},null,-1),ss={__name:"SalesPeopleBoost",props:{title:{type:String,required:!0,default:"Title is required"},customerId:{type:[Number,String],required:!0},customerName:{type:String,default:""}},emits:["addSellersToPromo"],setup(b,{emit:N}){const{get:m}=Z();J();const c=()=>({sellerId:"",salesBefore:0,salesPlan:0,surplusPlan:0,budgetPlan:0,budgetActual:0,compensationPlan:0}),v=b,A=N,n=D({motivationForSupervisors:5,motivationForSellers:10,sellers:[],checkedSellers:[],form:c()});q(()=>v.customerId,async e=>{n.motivationForSupervisors=5,n.motivationForSellers=10,n.sellers=[],n.checkedSellers=[],n.form=c(),e!==""&&await $(e)});const $=async e=>{const{status:s,data:r}=await m(`${z.CUSTOMER}/${e}`,{params:{customer_sellers:!0}});s==="success"&&(n.sellers=r.sellers)},B=I(()=>n.sellers.filter(e=>e.isActive).filter(e=>e.isSupervisor).map(e=>({...e,...n.form,compensationPlan:n.motivationForSupervisors}))),h=I(()=>n.sellers.filter(e=>e.isActive).filter(e=>!e.isSupervisor).map(e=>({...e,...n.form,compensationPlan:n.motivationForSellers}))),u=e=>{const s=n.checkedSellers.findIndex(r=>r.id===e.id);s===-1?n.checkedSellers.push(e):n.checkedSellers[s]={...e},A("addSellersToPromo",n.checkedSellers,a.value,o.value,l.value)},a=I(()=>n.checkedSellers.reduce((e,s)=>((s.isSupervisor||s.supervisorId===null)&&!isNaN(s.salesBefore)&&(e+=parseInt(s.salesBefore)),e),0)),o=I(()=>n.checkedSellers.reduce((e,s)=>((s.isSupervisor||s.supervisorId===null)&&(e+=s.salesPlan),e),0)),l=I(()=>n.checkedSellers.reduce((e,s)=>e+parseInt(s.budgetPlan),0));return(e,s)=>{const r=G("RouterLink");return f(),g("div",null,[t("div",be,[t("div",Pe,w(v.title),1),t("div",ge,[t("div",he,[ye,t("h4",Se,w(isNaN(l.value)?"0":F(k)(l.value))+" руб.",1)]),xe,v.customerId?(f(),g(E,{key:1},[t("div",Ie,[t("h5",Ee,[x("Дистрибутор: "),t("span",we,w(v.customerName),1)])]),n.sellers.length===0?(f(),g("div",ke,[Ne,x(" В команду дистрибутора не добавлено ни одного торгового представителя. "),_(r,{to:{name:"Manager.Customer.View",params:{id:v.customerId}},class:"fw-bold"},{default:V(()=>[x("Перейдите в карточку контрагента ")]),_:1},8,["to"]),x(' на вкладку "Команда ТП" и добавьте торговых представителей. ')])):(f(),g("div",Ae,[t("div",Ce,[Fe,Ve,t("div",Te,[_(U,{for:"motivation_for_supervisors"},{default:V(()=>[x("Мотивация СВ: "),t("span",je,w(n.motivationForSupervisors)+" %",1)]),_:1}),_(L,{id:"motivation_for_supervisors",modelValue:n.motivationForSupervisors,"onUpdate:modelValue":s[0]||(s[0]=d=>n.motivationForSupervisors=d),max:10,min:0,step:1},null,8,["modelValue"])]),t("div",Oe,[_(U,{for:"motivation_for_sellers"},{default:V(()=>[x("Мотивация ТП: "),t("span",qe,w(n.motivationForSellers)+" %",1)]),_:1}),_(L,{id:"motivation_for_sellers",modelValue:n.motivationForSellers,"onUpdate:modelValue":s[1]||(s[1]=d=>n.motivationForSellers=d),max:30,min:0,step:1},null,8,["modelValue"])])]),Re,Ue,t("ul",Le,[De,(f(!0),g(E,null,j(B.value,(d,i)=>(f(),O(fe,{key:d.id,index:i,sellers:h.value,supervisor:d,onAddToCheckedSellers:u},null,8,["index","sellers","supervisor"]))),128)),(f(!0),g(E,null,j(h.value,(d,i)=>(f(),g(E,{key:d.id},[d.supervisorId===null?(f(),O(H,{key:0,seller:d,index:i,onAddSeller:u},null,8,["seller","index"])):M("",!0)],64))),128)),t("li",Me,[t("div",He,[Qe,t("div",ze,[_(y,{value:F(k)(a.value),class:"fw-bold border-secondary text-end",readonly:"",tabindex:-1},null,8,["value"])]),t("div",Ge,[_(y,{class:"bg-warning-light",readonly:"",tabindex:-1})]),t("div",We,[_(y,{value:F(T)(o.value),class:"fw-bold border-secondary text-end",readonly:"",tabindex:-1},null,8,["value"])]),Ze])])])]))],64)):(f(),g("div",Be,[$e,x(" Выберите дистрибутора в общих настройках промо-акции для подгрузки его торгового персонала. ")]))])])])}}};export{ss as default};
