const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TheDiscount-Bjwwhr_0.js","assets/app-CvDqXEOd.js","assets/app-ClSdrvIZ.css","assets/useHttpService-Cv4QBHm9.js","assets/formatters-CphxWokN.js","assets/Modal-BjKEkhVV.js","assets/SalesPeopleBoost-DTJcyhpd.js","assets/useArrayHandlers-Dmi2z74m.js","assets/GiftForPurchase-Ce5FpasE.js","assets/RetailersBoost-Dl4YaNS2.js"])))=>i.map(i=>d[i]);
import{o as i,c,f as e,t as h,g as n,w as r,j as u,T as D,u as re,b as ae,$,r as B,e as ie,Y as x,G as M,d as F,p,s as v,H as g,F as y,h as S,i as o,q as O,m,L as ne,l as P,a0 as k,a1 as N,B as ce,a2 as ue,a3 as _e,n as pe,a4 as H,a5 as T,a6 as R}from"./app-CvDqXEOd.js";import{u as me}from"./useHttpService-Cv4QBHm9.js";import{a as j}from"./formatters-CphxWokN.js";import{u as he}from"./useArrayHandlers-Dmi2z74m.js";import{_ as G}from"./Modal-BjKEkhVV.js";var U={};Object.defineProperty(U,"__esModule",{value:!0});var q=U.default=void 0,ye={days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],daysShort:["Вос","Пон","Вто","Сре","Чет","Пят","Суб"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Очистить",dateFormat:"dd.MM.yyyy",timeFormat:"HH:mm",firstDay:1};q=U.default=ye;const fe={class:"card"},ve={class:"card-header bg-dark text-white"},be={class:"card-body mt-3"},ge={class:"d-flex justify-content-between align-items-center"},Se=e("span",null,"Инфо по покрытию",-1),Pe=e("hr",null,null,-1),Ie=e("div",{class:"row g-3"},null,-1),Ee={__name:"CoverageIncrease",props:{title:{type:String,required:!0,default:"Title is required"}},setup(E){const b=E;return(_,f)=>(i(),c("div",null,[e("div",fe,[e("div",ve,h(b.title),1),e("div",be,[e("div",ge,[Se,e("button",{onClick:f[0]||(f[0]=(...I)=>_.addProductModalInit&&_.addProductModalInit(...I)),class:"btn btn-success",type:"button"}," Добавить ")]),Pe])]),n(G,{id:"modalPopUp","close-func":_.closeModal,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[Ie]),footer:r(()=>[n(D,{onClick:_.addProduct,type:"button",class:"btn-success w-25",disabled:!_.isFormValid},{default:r(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},Oe={class:"card"},ke={class:"card-header bg-danger text-white"},Te={class:"card-body mt-3"},Re={class:"d-flex justify-content-between align-items-center"},we=e("span",null,"Ассортимент для промо-акции",-1),Ae=e("hr",null,null,-1),Ce=e("div",{class:"row g-3"},null,-1),xe={__name:"TheInOut",props:{title:{type:String,required:!0,default:"Title is required"}},setup(E){const b=E;return(_,f)=>(i(),c("div",null,[e("div",Oe,[e("div",ke,h(b.title),1),e("div",Te,[e("div",Re,[we,e("button",{onClick:f[0]||(f[0]=(...I)=>_.addProductModalInit&&_.addProductModalInit(...I)),class:"btn btn-success",type:"button"}," Добавить ")]),Ae])]),n(G,{id:"modalPopUp","close-func":_.closeModal,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[Ce]),footer:r(()=>[n(D,{onClick:_.addProduct,type:"button",class:"btn-success w-25",disabled:!_.isFormValid},{default:r(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},Fe={class:"row"},qe={class:"col-lg-5"},De={class:"card"},Ue=e("div",{class:"card-header bg-primary text-white"},"Укажите общие данные промо-акции",-1),Le={class:"card-body mt-3"},Ve={class:"row g-3"},$e={class:"col-md-6"},Be=e("option",{disabled:"",selected:"",value:""},"- Выберите вид промо-акции -",-1),Me=["value"],Ne={class:"col-md-6"},He={class:"input-group"},je=e("span",{class:"input-group-text"},"%",-1),Ge={class:"col-md-6"},We={class:"col-md-6"},Ke=["disabled"],Ye=e("option",{disabled:"",selected:"",value:""},"- Выберите канал продаж -",-1),ze=["value"],Je={class:"col-md-6"},Qe=["disabled"],Xe=e("option",{disabled:"",selected:"",value:""},"- Выберите дистрибутора -",-1),Ze=["value"],et={class:"col-md-6"},tt=["disabled"],st=e("option",{disabled:"",selected:"",value:""},"- Выберите торговую сеть -",-1),ot=["value"],dt={class:"col-md-6"},lt=e("option",{disabled:"",selected:"",value:""},"- Выберите регион -",-1),rt=["value","selected"],at={class:"col-md-6"},it=e("option",{disabled:"",selected:"",value:""},"- Выберите город -",-1),nt=["value","selected"],ct={class:"col-md-6"},ut=e("div",{id:"start_date_help",class:"form-text"},"укажите дату начала акции",-1),_t={class:"col-md-6"},pt=e("div",{id:"end_date_help",class:"form-text"},"укажите дату окончания акции",-1),mt={class:"col-md-6"},ht={class:"input-group"},yt=["disabled"],ft={key:0,class:"input-group-text border-success bg-success text-white px-4"},vt={key:1,class:"input-group-text border-warning bg-warning px-4"},bt=e("div",{id:"products_help",class:"form-text"},"только для скидочных акций",-1),gt={class:"col-md-6"},St={class:"input-group"},Pt=["disabled"],It={key:0,class:"input-group-text border-success bg-success text-white px-4"},Et={key:1,class:"input-group-text border-warning bg-warning px-4"},Ot=e("div",{id:"sellers_help",class:"form-text"},"только для мотивации ТП",-1),kt={class:"col-12"},Tt={class:"card-footer"},Rt={class:"col-lg-7"},wt=e("p",null,"Loading...",-1),At=e("p",null,"Loading...",-1),Ct=e("p",null,"Loading...",-1),xt=e("p",null,"Loading...",-1),Ft={key:6,class:"alert alert-warning alert-dismissible fade show",role:"alert"},qt=e("h4",{class:"alert-heading"},"Детали промо-акции",-1),Dt=e("p",null,"Здесь будут выведены поля для ввода ассортимента, команды торговых представителей и др. в зависимости от выбранного вида промо-акции.",-1),Ut=e("hr",null,null,-1),Lt=e("p",null,"Выберите вид промо-акции в выпадающем списке в панели общих настроек промо-акции.",-1),Vt=[qt,Dt,Ut,Lt],jt={__name:"Create",setup(E){const{get:b,post:_}=me(),f=re(),I=ce(),L=ae().getUser,w=he();$("#start_date",{locale:q,startDate:ue,onSelect:({date:a,datepicker:l})=>{t.promo.startDate=j(a),l.hide()}}),$("#end_date",{locale:q,startDate:_e,onSelect:({date:a,datepicker:l})=>{t.promo.endDate=j(a),l.hide()}});const W=T({loader:()=>R(()=>import("./TheDiscount-Bjwwhr_0.js"),__vite__mapDeps([0,1,2,3,4,5]))}),K=T({loader:()=>R(()=>import("./SalesPeopleBoost-DTJcyhpd.js"),__vite__mapDeps([6,1,2,3,7,4]))}),Y=T(()=>R(()=>import("./GiftForPurchase-Ce5FpasE.js"),__vite__mapDeps([8,1,2,5]))),z=T({loader:()=>R(()=>import("./RetailersBoost-Dl4YaNS2.js"),__vite__mapDeps([9,1,2,5])),delay:1e3,timeout:3e3}),V=()=>({promoType:"",promoForRetail:!1,discount:null,userId:L.id,regionId:"",cityId:"",channelId:"",customerId:"",retailerId:"",startDate:"",endDate:"",comments:"",totalSalesBefore:0,totalSalesPlan:0,totalBudgetPlan:0,products:[],sellers:[]}),t=B({customers:[],retailers:[],cities:[],channels:[],customerName:"",promo:V()});let d=B({isForRetail:!1,type:"",title:"",code:""});ie(async()=>{await Q()});const J=async a=>{const{data:l}=await b(x.CHANNEL);t.channels=l.channels.filter(s=>s.isForRetail===a.isForRetail)},Q=async()=>{const{data:a}=await b(x.CUSTOMER,{params:{region:!0,city:!0,user:!0,retailers:!0}});t.customers=a.customers};M(()=>t.promo.promoType,async a=>{const l=a;d=H.find(s=>s.type===l),t.promo.products=[],t.promo.sellers=[],t.promo.discount=null,t.promo.promoForRetail=d.isForRetail,await J(d)}),M(()=>t.promo.customerId,a=>{X(a)});const X=a=>{const l=t.customers.find(s=>+s.id==+a);t.promo.regionId=l.region.id,t.promo.cityId=l.city.id,t.promo.products=[],t.promo.sellers=[],t.customerName=l.name,t.promo.retailerId="",t.customers.map(s=>{+s.id==+a&&(t.retailers=s.retailers)})},Z=a=>{t.promo.products.push(a)},ee=a=>{t.promo.products.splice(a,1)},te=(a,l,s,le)=>{t.promo.sellers=a.filter(C=>(C.salesBefore!==0||C.salesBefore!==null)&&C.salesPlan!==0),t.promo.totalSalesBefore=l,t.promo.totalSalesPlan=s,t.promo.totalBudgetPlan=le},se=async()=>{const a=await _(x.PROMO,t.promo);a&&a.status==="success"&&(f.clear(),t.promo=V(),await I.push({name:"Manager.Promo.Index"}))},A=F(()=>w.sortArrayByStringColumn(t.customers,"name")),oe=F(()=>w.getUniqueObjectsFromArray(A.value.map(a=>a.region))),de=F(()=>w.getUniqueObjectsFromArray(A.value.map(a=>a.city)));return(a,l)=>(i(),c("div",Fe,[e("div",qe,[e("div",De,[Ue,e("div",Le,[n(pe),e("div",Ve,[e("div",$e,[n(p,{for:"promo_type",required:""},{default:r(()=>[u("Вид промо-акции")]),_:1}),v(e("select",{"onUpdate:modelValue":l[0]||(l[0]=s=>t.promo.promoType=s),id:"promo_type",class:"form-select"},[Be,(i(!0),c(y,null,S(o(H),s=>(i(),c("option",{key:s.id,value:s.type},h(s.title),9,Me))),128))],512),[[g,t.promo.promoType]])]),e("div",Ne,[n(p,{for:"discount",required:o(d).type==="DISCOUNT"},{default:r(()=>[u("Величина скидки")]),_:1},8,["required"]),e("div",He,[n(O,{id:"discount",modelValue:t.promo.discount,"onUpdate:modelValue":l[1]||(l[1]=s=>t.promo.discount=s),type:"number",min:"5",step:"1",max:"50",disabled:o(d).type!=="DISCOUNT"},null,8,["modelValue","disabled"]),je])]),e("div",Ge,[n(p,{for:"user_id"},{default:r(()=>[u("Менеджер")]),_:1}),n(O,{id:"user_id",type:"text",value:o(L).fullName,disabled:"disabled"},null,8,["value"])]),e("div",We,[n(p,{for:"channel_id",required:o(d).type!==""},{default:r(()=>[u("Канал продаж")]),_:1},8,["required"]),v(e("select",{"onUpdate:modelValue":l[2]||(l[2]=s=>t.promo.channelId=s),id:"channel_id",class:"form-select",disabled:o(d).type===""},[Ye,(i(!0),c(y,null,S(t.channels,s=>(i(),c("option",{key:s.id,value:s.id},h(s.name),9,ze))),128))],8,Ke),[[g,t.promo.channelId]])]),e("div",Je,[n(p,{for:"customer_id",required:o(d).type!==""},{default:r(()=>[u("Дистрибутор")]),_:1},8,["required"]),v(e("select",{"onUpdate:modelValue":l[3]||(l[3]=s=>t.promo.customerId=s),id:"customer_id",class:"form-select",disabled:o(d).type===""},[Xe,(i(!0),c(y,null,S(A.value,s=>(i(),c("option",{key:s.id,value:s.id},h(s.name),9,Ze))),128))],8,Qe),[[g,t.promo.customerId]])]),e("div",et,[n(p,{for:"retailer_id",required:t.retailers.length>0&&o(d).isForRetail===!0},{default:r(()=>[u("Торговая сеть")]),_:1},8,["required"]),v(e("select",{"onUpdate:modelValue":l[4]||(l[4]=s=>t.promo.retailerId=s),id:"retailer_id",class:"form-select",disabled:t.retailers.length===0||!o(d).isForRetail},[st,(i(!0),c(y,null,S(t.retailers,s=>(i(),c("option",{key:s.id,value:s.id},h(s.name),9,ot))),128))],8,tt),[[g,t.promo.retailerId]])]),e("div",dt,[n(p,{for:"region_id",required:""},{default:r(()=>[u("Регион")]),_:1}),v(e("select",{"onUpdate:modelValue":l[5]||(l[5]=s=>t.promo.regionId=s),id:"region_id",class:"form-select",disabled:"disabled"},[lt,(i(!0),c(y,null,S(oe.value,s=>(i(),c("option",{key:s.id,value:s.id,selected:t.promo.regionId},h(s.name),9,rt))),128))],512),[[g,t.promo.regionId]])]),e("div",at,[n(p,{for:"city_id",required:""},{default:r(()=>[u("Город")]),_:1}),v(e("select",{"onUpdate:modelValue":l[6]||(l[6]=s=>t.promo.cityId=s),id:"city_id",class:"form-select",disabled:"disabled"},[it,(i(!0),c(y,null,S(de.value,s=>(i(),c("option",{key:s.id,value:s.id,selected:t.promo.cityId},h(s.name),9,nt))),128))],512),[[g,t.promo.cityId]])]),e("div",ct,[n(p,{for:"start_date",required:""},{default:r(()=>[u("Начало промо-акции")]),_:1}),n(O,{id:"start_date",type:"text",readonly:"readonly","aria-describedby":"start_date_help"}),ut]),e("div",_t,[n(p,{for:"end_date",required:""},{default:r(()=>[u("Окончание промо-акции")]),_:1}),n(O,{id:"end_date",type:"text",readonly:"readonly","aria-describedby":"end_date_help"}),pt]),e("div",mt,[n(p,{for:"products",required:o(d).isForRetail===!0},{default:r(()=>[u("Ассортимент для акции")]),_:1},8,["required"]),e("div",ht,[e("input",{id:"products",type:"text",class:"form-control",value:"Ассортимент добавлен?","aria-describedby":"products_help",disabled:!o(d).isForRetail,readonly:""},null,8,yt),o(d).isForRetail===!0?(i(),c(y,{key:0},[t.promo.products.length>0?(i(),c("span",ft,"Да")):(i(),c("span",vt,"Нет"))],64)):m("",!0)]),bt]),e("div",gt,[n(p,{for:"sellers",required:o(d).type==="SALES_PEOPLE_BOOST"},{default:r(()=>[u("Команда ТП")]),_:1},8,["required"]),e("div",St,[e("input",{id:"sellers",type:"text",class:"form-control",value:"Команда добавлена?","aria-describedby":"sellers_help",disabled:o(d).type!=="SALES_PEOPLE_BOOST",readonly:""},null,8,Pt),o(d).type==="SALES_PEOPLE_BOOST"?(i(),c(y,{key:0},[t.promo.sellers.length>0?(i(),c("span",It,"Да")):(i(),c("span",Et,"Нет"))],64)):m("",!0)]),Ot]),e("div",kt,[n(p,{for:"comments"},{default:r(()=>[u("Механика промо-акции")]),_:1}),v(e("textarea",{id:"comments","onUpdate:modelValue":l[7]||(l[7]=s=>t.promo.comments=s),class:"form-control",style:{height:"100px"}},null,512),[[ne,t.promo.comments]])]),e("pre",null,h(t.promo),1)])]),e("div",Tt,[n(D,{onClick:se,class:"btn-primary"},{default:r(()=>[u("Сохранить ")]),_:1})])])]),e("div",Rt,[o(d).type==="DISCOUNT"?(i(),P(k,{key:0},{default:r(()=>[n(o(W),{title:o(d).title,onAddProductToPromo:Z,onRemoveProductFromPromo:ee},null,8,["title"])]),fallback:r(()=>[wt]),_:1})):m("",!0),o(d).type==="SALES_PEOPLE_BOOST"?(i(),P(k,{key:1},{default:r(()=>[n(o(K),{title:o(d).title,"customer-id":+t.promo.customerId,"customer-name":t.customerName,onAddSellersToPromo:te},null,8,["title","customer-id","customer-name"])]),fallback:r(()=>[At]),_:1})):m("",!0),o(d).type==="GIFT_FOR_PURCHASE"?(i(),P(k,{key:2},{default:r(()=>[n(o(Y),{title:o(d).title},null,8,["title"])]),fallback:r(()=>[Ct]),_:1})):m("",!0),o(d).type==="RETAILERS_BOOST"?(i(),P(k,{key:3},{default:r(()=>[n(o(z),{title:o(d).title},null,8,["title"])]),fallback:r(()=>[xt]),_:1})):m("",!0),o(d).type==="COVERAGE_INCREASE"?(i(),P(N(Ee),{key:4,title:o(d).title},null,8,["title"])):m("",!0),o(d).type==="IN_OUT"?(i(),P(N(xe),{key:5,title:o(d).title},null,8,["title"])):m("",!0),o(d).type===""?(i(),c("div",Ft,Vt)):m("",!0)])]))}};export{jt as default};
