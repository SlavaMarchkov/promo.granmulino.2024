import{u as fe,a as ve,b as ge,d as f,r as G,z as ye,e as be,A as E,c,f as e,t as r,s as T,y as we,g as a,w as l,T as W,F as v,h as x,i as h,j as i,k as Ee,o as n,m as I,l as Ie,n as Ve,p as V,q as R,I as Pe,v as Se,x as ke,R as z,P as B,E as Y,D as Ue,Q as De,S as Re,V as Ae,W as Ce}from"./app-LDVDDXIB.js";import{u as Le}from"./useArrayHandlers-JXOu8LuP.js";import{u as $e}from"./useHttpService-H3Bhthf8.js";import{_ as Te}from"./TheCheckbox--M688_LN.js";import{_ as xe}from"./SelectGroup-WhYPEgCY.js";import{_ as M}from"./InputGroup-DFOwqnPq.js";import{_ as Be}from"./TheFilter-Bt1ein-f.js";import{_ as j}from"./TheBadge-BK2ZTkEW.js";import{_ as Q}from"./Modal-Buqgi5Td.js";import{_ as Me,a as A}from"./TdButton-Cll3J42i.js";import{f as J}from"./formatters-k0Na949k.js";const Fe={class:"row mb-4"},Ne={class:"col-6"},Oe={class:"mb-0"},He={class:"col-6 text-end"},qe={class:"row mb-4"},Ke={class:"col-12"},Ge={class:"col-md-4 mb-2"},We={class:"col-md-4 mb-2"},ze={class:"col-md-4 mb-2"},Ye={class:"col-md-4 mb-2"},je={key:0,class:"col-md-4 mb-2"},Qe={class:"row mb-4"},Je={class:"col-12"},Xe={class:"card"},Ze={class:"card-body pb-0"},et={key:0,class:"table-responsive"},tt={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},st={scope:"row"},ot={class:"text-start"},at={class:"text-start"},lt={key:1,class:"mt-3 text-center lead"},dt={class:"fw-bold"},it={key:0},nt=e("br",null,null,-1),ct={key:1},rt={class:"row g-3"},ut={class:"col-12"},mt={class:"col-6"},_t={key:0,class:"col-6"},pt={class:"col-12"},ht=e("option",{disabled:"",selected:"",value:""},"-- Выберите группу товара --",-1),ft=["value"],vt={class:"col-12"},gt={class:"form-check"},yt=["checked"],bt=e("label",{class:"form-check-label",for:"is-active"}," Продукт в продаже? ",-1),wt={class:"col-12"},Et=["src"],It={key:0},Vt={key:1},Pt={class:"table table-bordered mt-3 align-top text-wrap",style:{width:"100%"}},St=e("th",{style:{width:"40%"}},"ID",-1),kt=e("th",null,"Название",-1),Ut=e("th",null,"Вес, г",-1),Dt={key:0},Rt=e("th",null,"Себестоимость, руб.",-1),At=e("th",null,"Группа товаров",-1),Ct=e("th",null,"В продаже?",-1),Lt=e("th",null,"Картинка",-1),$t=["src","alt"],Tt=e("span",null,null,-1),jt={__name:"Index",setup(xt){const P=fe(),C=ve(),X=ge(),m=Le(),{get:F,post:Z,update:ee,destroy:te}=$e(),N=X.getUser.role,L=f(()=>N===z.SUPER_ADMIN),g=f(()=>N===z.PRICE_ADMIN),se=f(()=>L.value?B.concat(Y,Ue):g.value?B.concat(De,Y):B),y=()=>({name:"",weight:"",price:"",categoryId:"",categoryName:"",image:"",isActive:!0}),s=G({products:[],categories:[],product:y(),isEditing:!1}),S=ye(null),u=G({name:"",weight:"",price:"",categoryId:"",isActive:!1});let p=null,b=null;function k(){s.isEditing=!1,s.product=y(),document.activeElement&&document.activeElement.blur()}be(async()=>{await U(),await oe(),p=new bootstrap.Modal(document.getElementById("modalPopUp")),p._element.addEventListener("hide.bs.modal",k)});const U=async()=>{const{data:d}=await F(E.PRODUCT);s.products=d.products},O=d=>s.products.find(o=>o.id===d),oe=async()=>{const{data:d}=await F(E.CATEGORY,{params:{products:!1,product_is_active:!0}});s.categories=d.categories},ae=()=>{P.clear(),s.isEditing=!1,s.product=y(),p.show()},H=d=>{P.clear(),s.isEditing=!0,s.product=O(d),p.show()},le=d=>{b=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.product=O(d),b.show(),b._element.addEventListener("hide.bs.modal",k)},de=()=>{p.hide(),p._element.removeEventListener("hide.bs.modal",k)},ie=()=>{b.hide(),b._element.removeEventListener("hide.bs.modal",k)},ne=()=>{m.resetSearchKeys(u),m.resetSortKeys()},q=f(()=>s.product.image?`${Re}${s.product.image}`:[Ae]),ce=d=>{const o=d.target.files;if(!o.length){alert("Не выбран файл!");return}const t=o[0],D=t.name.toLowerCase();if(Ce.some(_=>D.endsWith(_))){const _=new FileReader;_.onerror=()=>alert(`Произошла ошибка при чтении файла: ${D}`),_.onloadend=()=>S.value.src=_.result,_.readAsDataURL(t)}else alert("Загружать можно только изображения")},re=()=>{s.isEditing?me():ue()},ue=async()=>{const d={...s.product,image:S.value.src},o=await Z(E.PRODUCT,d);o&&o.status==="success"&&(P.clear(),s.product=y(),p.hide(),m.resetSearchKeys(u),m.resetSortKeys("id",!1),await U())},me=async()=>{const d={...s.product},o=S.value.src;o.indexOf("base64")!==-1&&(d.image=d.image!==null&&o.includes(d.image.toString())?d.image.toString():o);const w=await ee(`${E.PRODUCT}/${d.id}`,d);w&&w.status==="success"&&(P.clear(),s.product=y(),p.hide(),await U())},_e=async d=>{if(confirm("Точно удалить продукт? Уверены?")){const{status:o}=await te(`${E.PRODUCT}/${d}`);o==="success"&&await U()}},pe=f(()=>m.sortArray(s.products)),$=f(()=>m.filterArray(pe.value,u));return(d,o)=>{const w=Ee("RouterLink");return n(),c(v,null,[e("div",Fe,[e("div",Ne,[e("h3",Oe,r(d.$route.meta.title),1)]),T(e("div",He,[a(W,{class:"btn-primary",onClick:ae},{default:l(()=>[i("Новый продукт ")]),_:1})],512),[[we,L.value]])]),e("div",qe,[e("div",Ke,[a(Be,{onResetFilter:ne},{default:l(()=>[e("div",Ge,[a(M,{modelValue:u.name,"onUpdate:modelValue":o[0]||(o[0]=t=>u.name=t),placeholder:"Поиск по названию"},{default:l(()=>[i("Продукт ")]),_:1},8,["modelValue"])]),e("div",We,[a(xe,{modelValue:u.categoryId,"onUpdate:modelValue":o[1]||(o[1]=t=>u.categoryId=t),chooseFrom:"-- Выберите группу товара --",items:s.categories},{default:l(()=>[i("Группа товара ")]),_:1},8,["modelValue","items"])]),e("div",ze,[a(Te,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":o[2]||(o[2]=t=>u.isActive=t)},{default:l(()=>[i(" Продукт в продаже? ")]),_:1},8,["modelValue"])]),e("div",Ye,[a(M,{modelValue:u.weight,"onUpdate:modelValue":o[3]||(o[3]=t=>u.weight=t),placeholder:"Фильтр по макс. весу"},{default:l(()=>[i("Макс. вес ")]),_:1},8,["modelValue"])]),g.value?(n(),c("div",je,[a(M,{modelValue:u.price,"onUpdate:modelValue":o[4]||(o[4]=t=>u.price=t),placeholder:"Поиск по цене"},{default:l(()=>[i("Цена ")]),_:1},8,["modelValue"])])):I("",!0)]),_:1})])]),e("div",Qe,[e("div",Je,[e("div",Xe,[e("div",Ze,[$.value.length>0?(n(),c("div",et,[e("table",tt,[e("thead",null,[e("tr",null,[(n(!0),c(v,null,x(se.value,({column:t,label:D,sortable:K,is_num:_,width:he})=>(n(),Ie(Me,{key:t,column:t,"is-numeric":_,"sort-by-asc":h(m).sortBy.asc,"sort-by-column":h(m).sortBy.column===t,sortable:K,width:he,onSetSort:Bt=>h(m).setSort(t,_)},{default:l(()=>[i(r(D),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(n(!0),c(v,null,x($.value,t=>(n(),c("tr",{key:t.id},[e("th",st,r(t.id),1),e("td",ot,[a(w,{to:{name:"Product.View",params:{id:t.id}}},{default:l(()=>[i(r(t.name),1)]),_:2},1032,["to"])]),e("td",null,r(h(J)(t.weight)),1),e("td",at,r(t.categoryName),1),e("td",null,[a(j,{"is-active":t.isActive},null,8,["is-active"])]),a(A,{id:t.id,intent:"view",onRunButtonHandler:le},{default:l(()=>[i("View ")]),_:2},1032,["id"]),g.value?(n(),c(v,{key:0},[e("td",null,r(t.price),1),a(A,{id:t.id,intent:"edit",onRunButtonHandler:H},{default:l(()=>[i("Edit ")]),_:2},1032,["id"])],64)):I("",!0),L.value?(n(),c(v,{key:1},[a(A,{id:t.id,intent:"edit",onRunButtonHandler:H},{default:l(()=>[i("Edit ")]),_:2},1032,["id"]),a(A,{id:t.id,intent:"delete",onRunButtonHandler:_e},{default:l(()=>[i("Delete ")]),_:2},1032,["id"])],64)):I("",!0)]))),128))])])])):(n(),c("p",lt,r(h(C).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[i("Всего записей: "),e("span",dt,r($.value.length),1)])])])])]),a(Q,{id:"modalPopUp","close-func":de,"custom-classes":[""]},{title:l(()=>[s.isEditing?(n(),c("span",it,[i("Редактирование продукта "),nt,e("b",null,r(s.product.name),1)])):(n(),c("span",ct,"Добавление продукта"))]),body:l(()=>[a(Ve),e("div",rt,[e("div",ut,[a(V,{for:"name",required:""},{default:l(()=>[i("Название продукта")]),_:1}),a(R,{id:"name",modelValue:s.product.name,"onUpdate:modelValue":o[5]||(o[5]=t=>s.product.name=t),placeholder:"Например: Бантики, 400 г",type:"text"},null,8,["modelValue"])]),e("div",mt,[a(V,{for:"weight",required:""},{default:l(()=>[i("Вес пачки, г")]),_:1}),a(R,{id:"weight",modelValue:s.product.weight,"onUpdate:modelValue":o[6]||(o[6]=t=>s.product.weight=t),max:"50000",min:"0",placeholder:"Например: 400",step:"50",type:"number"},null,8,["modelValue"])]),g.value?(n(),c("div",_t,[a(V,{for:"price",required:""},{default:l(()=>[i("Отпускная цена, руб.")]),_:1}),a(R,{id:"price",modelValue:s.product.price,"onUpdate:modelValue":o[7]||(o[7]=t=>s.product.price=t),max:"299.99",min:"0.00",placeholder:"Например: 36.99",step:"0.01",type:"number"},null,8,["modelValue"])])):I("",!0),e("div",pt,[a(V,{for:"category_id",required:""},{default:l(()=>[i("Группа товара")]),_:1}),T(e("select",{id:"category_id","onUpdate:modelValue":o[8]||(o[8]=t=>s.product.categoryId=t),class:"form-select"},[ht,(n(!0),c(v,null,x(s.categories,t=>(n(),c("option",{key:t.id,value:t.id},r(t.name),9,ft))),128))],512),[[Pe,s.product.categoryId]])]),e("div",vt,[e("div",gt,[T(e("input",{id:"is-active","onUpdate:modelValue":o[9]||(o[9]=t=>s.product.isActive=t),checked:s.product.isActive,class:"form-check-input",type:"checkbox"},null,8,yt),[[Se,s.product.isActive]]),bt])]),e("div",wt,[a(V,{for:"image"},{default:l(()=>[i("Изображение продукта")]),_:1}),a(R,{id:"image",type:"file",onChange:ce,accept:"image/*"}),e("img",{ref_key:"uploadedProductImageRef",ref:S,src:q.value,alt:"Изображение продукта",class:"img-thumbnail mt-3",width:"150"},null,8,Et)])])]),footer:l(()=>[a(W,{class:ke([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:h(C).isButtonDisabled,loading:h(C).isButtonDisabled,type:"button",onClick:re},{default:l(()=>[s.isEditing?(n(),c("span",It,"Сохранить")):(n(),c("span",Vt,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(Q,{id:"viewModalPopUp","close-func":ie,"custom-classes":["modal-dialog-scrollable"]},{title:l(()=>[i(" Просмотр продукта "),e("b",null,r(s.product.name),1)]),body:l(()=>[e("table",Pt,[e("tbody",null,[e("tr",null,[St,e("td",null,r(s.product.id),1)]),e("tr",null,[kt,e("td",null,r(s.product.name),1)]),e("tr",null,[Ut,e("td",null,r(h(J)(s.product.weight)),1)]),g.value?(n(),c("tr",Dt,[Rt,e("td",null,r(s.product.price),1)])):I("",!0),e("tr",null,[At,e("td",null,r(s.product.categoryName),1)]),e("tr",null,[Ct,e("td",null,[a(j,{"is-active":s.product.isActive},null,8,["is-active"])])]),e("tr",null,[Lt,e("td",null,[e("img",{src:q.value,alt:s.product.name,class:"img-thumbnail"},null,8,$t)])])])])]),footer:l(()=>[Tt]),_:1})],64)}}};export{jt as default};
