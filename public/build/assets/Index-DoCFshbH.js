import{u as ot,a as at,b as nt,d as w,r as $,e as it,A as E,c as a,f as t,g as i,w as l,F as p,h as I,t as d,i as _,j as c,k as lt,o,l as ct,m as x,n as dt,p as rt,q as _t,s as ut,v as mt,T as L,x as ht,R as D,K as U,E as yt,D as pt}from"./app-CvDqXEOd.js";import{u as gt}from"./useHttpService-Cv4QBHm9.js";import{u as vt}from"./useArrayHandlers-Dmi2z74m.js";import{_ as bt}from"./TheCheckbox-D3tzlK-V.js";import{_ as ft,a as wt}from"./TheFilter-VzPJfpVU.js";import{_ as M}from"./TheBadge-BBHb-MvK.js";import{_ as T}from"./Modal-BjKEkhVV.js";import{_ as Et,a as R}from"./TdButton-DoOWIy6T.js";import{f as kt}from"./formatters-CphxWokN.js";const St={class:"row mb-4"},At={class:"col-12"},Ct=["disabled"],It={class:"row mb-2"},xt={class:"col-12"},Dt={class:"col-md-4 mb-2"},Rt={class:"col-md-4 mb-2"},Vt={class:"row mb-4"},Bt={class:"col-12"},$t={class:"card"},Lt={class:"card-body pb-0"},Ut={key:0,class:"table-responsive"},Mt={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Tt={scope:"row"},Ht={class:"text-start"},Nt={key:1,class:"mt-3 text-center lead"},Pt={class:"fw-bold"},Ft={key:0},Ot={key:1},Gt={class:"row g-3"},Kt={class:"col-12"},Yt={class:"col-12"},qt={class:"form-check"},jt=["checked"],zt=t("label",{class:"form-check-label",for:"is-active"}," Группа товаров в продаже? ",-1),Jt={key:0},Qt={key:1},Wt={key:0},Xt={class:"bd-callout bd-callout-info"},Zt={class:"table table-bordered text-center align-middle text-nowrap",style:{width:"100%"}},te={class:"table-light"},ee=t("th",null,"ID",-1),se=t("th",{class:"text-start"},"Формат",-1),oe=t("th",null,"Вес, г",-1),ae={key:0},ne=t("th",null,"В продаже?",-1),ie={class:"text-start"},le={key:0},ce={key:1,class:"bd-callout bd-callout-warning"},de=t("h5",null,"В группе нет продукции",-1),re=t("hr",null,null,-1),_e=t("p",null,[c("Наполните группу товаров ассортиментом во вкладке "),t("b",null,"Справочники | Ассортимент"),c(".")],-1),ue=[de,re,_e],Se={__name:"Index",setup(me){const g=ot(),k=at(),H=nt(),u=vt(),{get:N,post:P,update:F,destroy:O}=gt(),S=H.getUser.role,A=w(()=>S===D.SUPER_ADMIN),G=w(()=>A?U.concat(yt,pt):U),v=()=>({name:"",isActive:!0}),s=$({categories:[],category:v(),isEditing:!1}),h=$({name:"",isActive:!1});let m=null,y=null;function b(){s.isEditing=!1,s.category=v()}it(async()=>{await f(),m=new bootstrap.Modal(document.getElementById("modalPopUp")),m._element.addEventListener("hide.bs.modal",b)});const f=async()=>{const{data:n}=await N(E.CATEGORY,{params:{category_is_active:!1,product_is_active:!0,products:!0}});s.categories=n.categories},V=n=>s.categories.find(r=>r.id===n),K=()=>{g.clear(),s.isEditing=!1,s.category=v(),m.show()},Y=n=>{g.clear(),s.isEditing=!0,s.category=V(n),m.show()},q=n=>{y=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.category=V(n),y.show(),y._element.addEventListener("hide.bs.modal",b)},j=()=>{m.hide(),m._element.removeEventListener("hide.bs.modal",b)},z=()=>{y.hide(),y._element.removeEventListener("hide.bs.modal",b)},J=()=>{u.resetSearchKeys(h),u.resetSortKeys()},Q=async()=>{if(s.isEditing){const n=await F(`${E.CATEGORY}/${s.category.id}`,s.category);n&&n.status==="success"&&(g.clear(),m.hide(),await f())}else{const n=await P(E.CATEGORY,s.category);n&&n.status==="success"&&(g.clear(),s.category=v(),m.hide(),u.resetSearchKeys(h),u.resetSortKeys("id",!1),await f())}},W=async n=>{if(confirm("Точно удалить группу товаров? Уверены?")){const{status:r}=await O(`${E.CATEGORY}/${n}`);r==="success"&&await f()}},X=w(()=>u.sortArray(s.categories)),C=w(()=>u.filterArray(X.value,h));return(n,r)=>{const Z=lt("RouterLink");return o(),a(p,null,[t("div",St,[t("div",At,[t("button",{class:"btn btn-primary",type:"button",onClick:K,disabled:!A.value}," Новая группа товаров ",8,Ct)])]),t("div",It,[t("div",xt,[i(ft,{onResetFilter:J},{default:l(()=>[t("div",Dt,[i(wt,{modelValue:h.name,"onUpdate:modelValue":r[0]||(r[0]=e=>h.name=e),placeholder:"Поиск по названию группы товаров"},{default:l(()=>[c("Группа товаров ")]),_:1},8,["modelValue"])]),t("div",Rt,[i(bt,{id:"is_active",modelValue:h.isActive,"onUpdate:modelValue":r[1]||(r[1]=e=>h.isActive=e)},{default:l(()=>[c("В продаже? ")]),_:1},8,["modelValue"])])]),_:1})])]),t("div",Vt,[t("div",Bt,[t("div",$t,[t("div",Lt,[C.value.length>0?(o(),a("div",Ut,[t("table",Mt,[t("thead",null,[t("tr",null,[(o(!0),a(p,null,I(G.value,({column:e,label:tt,sortable:et,is_num:B,width:st})=>(o(),ct(Et,{key:e,column:e,"is-numeric":B,"sort-by-asc":_(u).sortBy.asc,"sort-by-column":_(u).sortBy.column===e,sortable:et,width:st,onSetSort:he=>_(u).setSort(e,B)},{default:l(()=>[c(d(tt),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),t("tbody",null,[(o(!0),a(p,null,I(C.value,e=>(o(),a("tr",{key:e.id},[t("th",Tt,d(e.id),1),t("td",Ht,[i(Z,{to:{name:"Category.View",params:{id:e.id}}},{default:l(()=>[c(d(e.name),1)]),_:2},1032,["to"])]),t("td",null,d(e.productsCount),1),t("td",null,[i(M,{"is-active":e.isActive},null,8,["is-active"])]),i(R,{id:e.id,intent:"view",onRunButtonHandler:q},{default:l(()=>[c("View ")]),_:2},1032,["id"]),A.value?(o(),a(p,{key:0},[i(R,{id:e.id,intent:"edit",onRunButtonHandler:Y},{default:l(()=>[c("Edit ")]),_:2},1032,["id"]),i(R,{id:e.id,intent:"delete",onRunButtonHandler:W},{default:l(()=>[c("Delete ")]),_:2},1032,["id"])],64)):x("",!0)]))),128))])])])):(o(),a("p",Nt,d(_(k).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),t("p",null,[c("Всего записей: "),t("span",Pt,d(C.value.length),1)])])])])]),i(T,{id:"modalPopUp","close-func":j,"custom-classes":[""]},{title:l(()=>[s.isEditing?(o(),a("span",Ft,[c("Редактирование группы товаров "),t("b",null,d(s.category.name),1)])):(o(),a("span",Ot,"Добавление группы товаров"))]),body:l(()=>[i(dt),t("div",Gt,[t("div",Kt,[i(rt,{for:"name",required:""},{default:l(()=>[c("Название группы товаров")]),_:1}),i(_t,{id:"name",modelValue:s.category.name,"onUpdate:modelValue":r[2]||(r[2]=e=>s.category.name=e),placeholder:"Например: Granmulino Премиум",type:"text"},null,8,["modelValue"])]),t("div",Yt,[t("div",qt,[ut(t("input",{id:"is-active","onUpdate:modelValue":r[3]||(r[3]=e=>s.category.isActive=e),checked:s.category.isActive,class:"form-check-input",type:"checkbox"},null,8,jt),[[mt,s.category.isActive]]),zt])])])]),footer:l(()=>[i(L,{class:ht([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:_(k).isButtonDisabled,loading:_(k).isButtonDisabled,type:"button",onClick:Q},{default:l(()=>[s.isEditing?(o(),a("span",Jt,"Сохранить")):(o(),a("span",Qt,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),i(T,{id:"viewModalPopUp","close-func":z,"custom-classes":["modal-dialog-scrollable"]},{title:l(()=>[c(" Просмотр группы товаров "),t("b",null,d(s.category.name),1)]),body:l(()=>[s.category.productsCount>0?(o(),a("div",Wt,[t("div",Xt,[t("p",null,[c("Кол-во SKU в группе: "),t("strong",null,d(s.category.productsCount),1)])]),t("table",Zt,[t("thead",te,[t("tr",null,[ee,se,oe,_(S)===_(D).PRICE_ADMIN?(o(),a("th",ae,"Цена, руб.")):x("",!0),ne])]),t("tbody",null,[(o(!0),a(p,null,I(s.category.products,e=>(o(),a("tr",{key:e.id},[t("td",null,d(e.id),1),t("td",ie,d(e.name),1),t("td",null,d(_(kt)(e.weight)),1),_(S)===_(D).PRICE_ADMIN?(o(),a("td",le,d(e.price),1)):x("",!0),t("td",null,[i(M,{"is-active":e.isActive},null,8,["is-active"])])]))),128))])])])):(o(),a("div",ce,ue))]),footer:l(()=>[i(L,{class:"btn-light"})]),_:1})],64)}}};export{Se as default};
