import{u as nt,a as it,b as dt,d as C,r as $,e as rt,A as v,c,f as t,s as A,C as ct,g as a,w as l,T as P,F as b,h as B,t as i,i as p,j as d,k as ut,o as r,l as _t,m as mt,n as yt,p as h,q as w,I as pt,x as ht,R as ft,J as H,E as gt,D as vt,O as bt,K as wt}from"./app-CcRn7-yu.js";import{u as Et}from"./useHttpService-F7Gi0evP.js";import{u as Vt}from"./useArrayHandlers-HI3WadKX.js";import{_ as St,a as R}from"./TheFilter-CSf9971F.js";import{_ as M}from"./Modal-BjgBNvva.js";import{_ as It,a as L}from"./TdButton-BuTkbrOp.js";const Ct={class:"row mb-4"},xt={class:"col-12"},Ut={class:"row mb-2"},kt={class:"col-12"},Bt={class:"col-md-4 mb-2"},Rt={class:"col-md-4 mb-2"},Lt={class:"col-md-4 mb-2"},Dt={class:"row mb-4"},Nt={class:"col-12"},Tt={class:"card"},$t={class:"card-body pb-0"},At={key:0,class:"table-responsive"},Pt={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Ht={scope:"row"},Mt={class:"text-start"},Ft={class:"text-start"},Kt={class:"text-start"},Ot={class:"text-start"},Yt={class:"text-start"},qt={key:1,class:"mt-3 text-center lead"},jt={class:"fw-bold"},Wt={key:0},zt={key:1},Gt={class:"row g-3"},Jt={class:"col-12"},Qt={class:"col-6"},Xt={class:"col-6"},Zt={class:"col-6"},te={class:"col-6"},ee={class:"col-12"},se=t("option",{disabled:"",selected:"",value:""},"-- Выберите регион --",-1),oe=["value"],ae={key:0},le={key:1},ne={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},ie=t("th",{style:{width:"30%"}},"ID",-1),de=t("th",null,"Название",-1),re=t("th",null,"Регион",-1),ce=t("th",null,"Широта",-1),ue=t("th",null,"Долгота",-1),_e=t("th",null,"Страна",-1),me=t("th",null,"Локация",-1),ye=t("span",null,null,-1),Ve={__name:"Index",setup(pe){const E=nt(),x=it(),F=dt(),u=Vt(),{get:D,post:K,update:O,destroy:Y}=Et(),q=F.getUser.role,U=C(()=>q===ft.SUPER_ADMIN),j=C(()=>U.value?H.concat(gt,vt):H),V=()=>({name:"",regionId:"",longitude:"",latitude:"",country:"",state:""}),e=$({cities:[],regions:[],city:V(),isEditing:!1}),_=$({name:"",state:"",regionName:""});let m=null,f=null;function S(){e.isEditing=!1,e.city=V(),document.activeElement&&document.activeElement.blur()}rt(async()=>{await I(),await W(),m=new bootstrap.Modal(document.getElementById("modalPopUp")),m._element.addEventListener("hide.bs.modal",S)});const I=async()=>{const{data:n}=await D(v.CITY);e.cities=n.cities},N=n=>e.cities.find(o=>o.id===n),W=async()=>{const{data:n}=await D(v.REGION);e.regions=n.regions},z=()=>{E.clear(),e.isEditing=!1,e.city=V(),m.show()},G=n=>{E.clear(),e.isEditing=!0,e.city=N(n),m.show()},J=n=>{f=new bootstrap.Modal(document.getElementById("viewModalPopUp")),e.city=N(n),f.show(),f._element.addEventListener("hide.bs.modal",S)},Q=()=>{m.hide(),m._element.removeEventListener("hide.bs.modal",S)},X=()=>{f.hide(),f._element.removeEventListener("hide.bs.modal",S)},Z=()=>{u.resetSearchKeys(_),u.resetSortKeys()},tt=async()=>{if(e.isEditing){const n=await O(`${v.CITY}/${e.city.id}`,e.city);n&&n.status==="success"&&(E.clear(),m.hide(),await I())}else{const n=await K(v.CITY,e.city);n&&n.status==="success"&&(E.clear(),e.city=V(),m.hide(),u.resetSearchKeys(_),u.resetSortKeys("id",!1),await I())}},et=async n=>{if(confirm("Точно удалить город? Уверены?")){const o=await Y(`${v.CITY}/${n}`);o&&o.status==="success"&&await I()}},st=C(()=>u.sortArray(e.cities)),k=C(()=>u.filterArray(st.value,_)),ot=async n=>{const o=new URL(bt);o.searchParams.set("q",n),o.searchParams.set("appid",wt);try{const y=(await(await fetch(o.toString())).json())[0];e.city.latitude=y.lat,e.city.longitude=y.lon,e.city.country=y.country,e.city.state=y.state}catch(g){alert("Error: "+g.message)}};return(n,o)=>{const g=ut("RouterLink");return r(),c(b,null,[t("div",Ct,[t("div",xt,[A(a(P,{class:"btn-primary",onClick:z},{default:l(()=>[d("Новый город ")]),_:1},512),[[ct,U.value]])])]),t("div",Ut,[t("div",kt,[a(St,{onResetFilter:Z},{default:l(()=>[t("div",Bt,[a(R,{modelValue:_.name,"onUpdate:modelValue":o[0]||(o[0]=s=>_.name=s),placeholder:"Поиск по названию города"},{default:l(()=>[d("Город ")]),_:1},8,["modelValue"])]),t("div",Rt,[a(R,{modelValue:_.state,"onUpdate:modelValue":o[1]||(o[1]=s=>_.state=s),placeholder:"Поиск по локации (EN)"},{default:l(()=>[d("Локация ")]),_:1},8,["modelValue"])]),t("div",Lt,[a(R,{modelValue:_.regionName,"onUpdate:modelValue":o[2]||(o[2]=s=>_.regionName=s),placeholder:"Поиск по названию региона"},{default:l(()=>[d("Регион ")]),_:1},8,["modelValue"])])]),_:1})])]),t("div",Dt,[t("div",Nt,[t("div",Tt,[t("div",$t,[k.value.length>0?(r(),c("div",At,[t("table",Pt,[t("thead",null,[t("tr",null,[(r(!0),c(b,null,B(j.value,({column:s,label:y,sortable:at,is_num:T,width:lt})=>(r(),_t(It,{key:s,column:s,"is-numeric":T,"sort-by-asc":p(u).sortBy.asc,"sort-by-column":p(u).sortBy.column===s,sortable:at,width:lt,onSetSort:he=>p(u).setSort(s,T)},{default:l(()=>[d(i(y),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),t("tbody",null,[(r(!0),c(b,null,B(k.value,s=>(r(),c("tr",{key:s.id},[t("th",Ht,i(s.id),1),t("td",Mt,[a(g,{to:{name:"City.View",params:{id:s.id}}},{default:l(()=>[d(i(s.name),1)]),_:2},1032,["to"])]),t("td",Ft,i(s.latitude),1),t("td",Kt,i(s.longitude),1),t("td",Ot,i(s.state),1),t("td",Yt,[a(g,{to:{name:"Region.View",params:{id:s.regionId}}},{default:l(()=>[d(i(s.regionName),1)]),_:2},1032,["to"])]),a(L,{id:s.id,intent:"view",onRunButtonHandler:J},{default:l(()=>[d("View ")]),_:2},1032,["id"]),U.value?(r(),c(b,{key:0},[a(L,{id:s.id,intent:"edit",onRunButtonHandler:G},{default:l(()=>[d("Edit ")]),_:2},1032,["id"]),a(L,{id:s.id,intent:"delete",onRunButtonHandler:et},{default:l(()=>[d("Delete ")]),_:2},1032,["id"])],64)):mt("",!0)]))),128))])])])):(r(),c("p",qt,i(p(x).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),t("p",null,[d("Всего записей: "),t("span",jt,i(k.value.length),1)])])])])]),a(M,{id:"modalPopUp","close-func":Q,"custom-classes":[""]},{title:l(()=>[e.isEditing?(r(),c("span",Wt,[d("Редактирование города "),t("b",null,i(e.city.name),1)])):(r(),c("span",zt,"Добавление города"))]),body:l(()=>[a(yt),t("div",Gt,[t("div",Jt,[a(h,{for:"name",required:""},{default:l(()=>[d("Наименование города")]),_:1}),a(w,{id:"name",modelValue:e.city.name,"onUpdate:modelValue":o[3]||(o[3]=s=>e.city.name=s),onBlur:o[4]||(o[4]=s=>ot(e.city.name)),placeholder:"Например: Новосибирск",type:"text"},null,8,["modelValue"])]),t("div",Qt,[a(h,{for:"latitude"},{default:l(()=>[d("Геокоординаты. Широта")]),_:1}),a(w,{id:"latitude",modelValue:e.city.latitude,"onUpdate:modelValue":o[5]||(o[5]=s=>e.city.latitude=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",Xt,[a(h,{for:"longitude"},{default:l(()=>[d("Геокоординаты. Долгота")]),_:1}),a(w,{id:"longitude",modelValue:e.city.longitude,"onUpdate:modelValue":o[6]||(o[6]=s=>e.city.longitude=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",Zt,[a(h,{for:"country"},{default:l(()=>[d("Страна")]),_:1}),a(w,{id:"country",modelValue:e.city.country,"onUpdate:modelValue":o[7]||(o[7]=s=>e.city.country=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",te,[a(h,{for:"state"},{default:l(()=>[d("Локация")]),_:1}),a(w,{id:"state",modelValue:e.city.state,"onUpdate:modelValue":o[8]||(o[8]=s=>e.city.state=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",ee,[a(h,{for:"region_id",required:""},{default:l(()=>[d("Регион")]),_:1}),A(t("select",{id:"region_id","onUpdate:modelValue":o[9]||(o[9]=s=>e.city.regionId=s),class:"form-select"},[se,(r(!0),c(b,null,B(e.regions,s=>(r(),c("option",{key:s.id,value:s.id},i(s.name),9,oe))),128))],512),[[pt,e.city.regionId]])])])]),footer:l(()=>[a(P,{class:ht([e.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:p(x).isButtonDisabled,loading:p(x).isButtonDisabled,onClick:tt},{default:l(()=>[e.isEditing?(r(),c("span",ae,"Сохранить")):(r(),c("span",le,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(M,{id:"viewModalPopUp","close-func":X,"custom-classes":["modal-dialog-scrollable"]},{title:l(()=>[d(" Просмотр города "),t("b",null,i(e.city.name),1)]),body:l(()=>[t("table",ne,[t("tbody",null,[t("tr",null,[ie,t("td",null,i(e.city.id),1)]),t("tr",null,[de,t("td",null,i(e.city.name),1)]),t("tr",null,[re,t("td",null,i(e.city.regionName),1)]),t("tr",null,[ce,t("td",null,i(e.city.latitude),1)]),t("tr",null,[ue,t("td",null,i(e.city.longitude),1)]),t("tr",null,[_e,t("td",null,i(e.city.country),1)]),t("tr",null,[me,t("td",null,i(e.city.state),1)])])])]),footer:l(()=>[ye]),_:1})],64)}}};export{Ve as default};
