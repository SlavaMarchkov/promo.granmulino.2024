import{u as ue,a as me,b as _e,d as V,r as D,e as pe,A as v,c,f as e,t as d,s as f,y as ve,g as i,w as l,T as M,F as p,h as g,i as h,j as n,k as fe,o as r,l as he,m as L,n as be,p as b,q as ye,I as N,x as T,L as ge,v as we,R as Ie,M as F,E as Ee,D as Se}from"./app-LDVDDXIB.js";import{u as Ve}from"./useHttpService-H3Bhthf8.js";import{u as ke}from"./useArrayHandlers-JXOu8LuP.js";import{_ as Ue,a as R}from"./TdButton-Cll3J42i.js";import{_ as H}from"./TheBadge-BK2ZTkEW.js";import{_ as O}from"./InputGroup-DFOwqnPq.js";import{_ as P}from"./SelectGroup-WhYPEgCY.js";import{_ as Ce}from"./TheCheckbox--M688_LN.js";import{_ as q}from"./Modal-Buqgi5Td.js";import{_ as xe}from"./TheFilter-Bt1ein-f.js";const Me={class:"row mb-4"},Ne={class:"col-6"},Re={class:"mb-0"},$e={class:"col-6 text-end"},Ae={class:"row mb-4"},Be={class:"col-12"},De={class:"col-md-4 mb-2"},Le={class:"col-md-4 mb-2"},Te={class:"col-md-4 mb-2"},Fe={class:"col-md-4 mb-2"},He={class:"col-md-4 mb-2"},Oe={class:"row mb-4"},Pe={class:"col-12"},qe={class:"card"},Ke={class:"card-body pb-0"},je={key:0,class:"table-responsive"},ze={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Ge={scope:"row"},Je={class:"text-start"},Qe={class:"text-start"},We={class:"text-start"},Xe={class:"text-start"},Ye={key:1,class:"mt-3 text-center lead"},Ze={class:"fw-bold"},et={key:0},tt=e("br",null,null,-1),st={key:1},ot={class:"row g-3"},lt={class:"col-12"},it={class:"col-12"},at=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите регион --",-1),nt=["value"],dt={key:0,class:"col-12"},rt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите город --",-1),ct=["value"],ut={class:"col-6"},mt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите ФИО --",-1),_t=["value"],pt={class:"col-6"},vt={class:"col-12"},ft={class:"col-12"},ht={class:"form-check"},bt=["checked"],yt=e("label",{class:"form-check-label",for:"is-active"}," Активный? ",-1),gt={key:0},wt={key:1},It={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},Et=e("th",{style:{width:"20%"}},"ID",-1),St=e("th",null,"Название",-1),Vt=e("th",null,"Регион",-1),kt=e("th",null,"Город",-1),Ut=e("th",null,"Менеджер",-1),Ct=e("th",null,"Активен?",-1),xt=e("span",null,null,-1),Pt={__name:"Index",setup(Mt){const w=ue(),k=me(),K=_e(),m=ke(),{get:U,post:j,update:z,destroy:G}=Ve(),J=K.getUser.role,C=V(()=>J===Ie.SUPER_ADMIN),Q=V(()=>C.value?F.concat(Ee,Se):F),I=()=>({name:"",description:"",isActive:!0,regionId:null,cityId:null,userId:null}),t=D({customers:[],users:[],regions:[],cities:[],customer:I(),isEditing:!1}),u=D({name:"",userId:"",regionId:"",cityName:"",isActive:!1});let _=null,y=null;function E(){t.isEditing=!1,t.customer=I(),document.activeElement&&document.activeElement.blur()}pe(async()=>{await S(),await X(),await W(),_=new bootstrap.Modal(document.getElementById("modalPopUp")),_._element.addEventListener("hide.bs.modal",E)});const S=async()=>{const{data:a}=await U(v.CUSTOMER,{params:{user:!0,region:!0,city:!0}});t.customers=a.customers},$=a=>t.customers.find(o=>o.id===a),W=async()=>{const{data:a}=await U(v.REGION,{params:{cities:!1}});t.regions=a.regions},X=async()=>{const{data:a}=await U(v.USER,{params:{is_active:!0}});t.users=a.users},A=()=>{t.regions.map(a=>{+a.id==+t.customer.regionId&&(t.cities=a.cities)})},Y=()=>{w.clear(),t.isEditing=!1,t.cities=[],t.customer=I(),_.show()},Z=a=>{w.clear(),t.isEditing=!0,t.customer=$(a),A(t.customer.regionId),_.show()},ee=a=>{y=new bootstrap.Modal(document.getElementById("viewModalPopUp")),t.customer=$(a),y.show(),y._element.addEventListener("hide.bs.modal",E)},te=()=>{_.hide(),_._element.removeEventListener("hide.bs.modal",E)},se=()=>{y.hide(),y._element.removeEventListener("hide.bs.modal",E)},oe=()=>{m.resetSearchKeys(u),m.resetSortKeys()},le=async()=>{if(t.isEditing){const a=await z(`${v.CUSTOMER}/${t.customer.id}`,t.customer);a&&a.status==="success"&&(w.clear(),_.hide(),await S())}else{const a=await j(v.CUSTOMER,t.customer);a&&a.status==="success"&&(w.clear(),t.customer=I(),_.hide(),m.resetSearchKeys(u),m.resetSortKeys("id",!1),await S())}},ie=async a=>{if(confirm("Точно удалить контрагента? Уверены?")){const o=await G(`${v.CUSTOMER}/${a}`);o&&o.status==="success"&&await S()}},ae=V(()=>m.sortArray(t.customers)),x=V(()=>m.filterArray(ae.value,u));return(a,o)=>{const ne=fe("RouterLink");return r(),c(p,null,[e("div",Me,[e("div",Ne,[e("h3",Re,d(a.$route.meta.title),1)]),f(e("div",$e,[i(M,{class:"btn-primary",onClick:Y},{default:l(()=>[n("Новый контрагент ")]),_:1})],512),[[ve,C.value]])]),e("div",Ae,[e("div",Be,[i(xe,{onResetFilter:oe},{default:l(()=>[e("div",De,[i(O,{modelValue:u.name,"onUpdate:modelValue":o[0]||(o[0]=s=>u.name=s),placeholder:"Поиск по названию"},{default:l(()=>[n(" Клиент ")]),_:1},8,["modelValue"])]),e("div",Le,[i(P,{modelValue:u.userId,"onUpdate:modelValue":o[1]||(o[1]=s=>u.userId=s),chooseFrom:"-- Выберите менеджера --",items:t.users.concat({id:"null",fullName:"без менеджера"}),selectedOption:"fullName"},{default:l(()=>[n("Менеджер ")]),_:1},8,["modelValue","items"])]),e("div",Te,[i(P,{modelValue:u.regionId,"onUpdate:modelValue":o[2]||(o[2]=s=>u.regionId=s),chooseFrom:"-- Выберите регион --",items:t.regions},{default:l(()=>[n("Регион ")]),_:1},8,["modelValue","items"])]),e("div",Fe,[i(O,{modelValue:u.cityName,"onUpdate:modelValue":o[3]||(o[3]=s=>u.cityName=s),placeholder:"Поиск по городу"},{default:l(()=>[n(" Город ")]),_:1},8,["modelValue"])]),e("div",He,[i(Ce,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":o[4]||(o[4]=s=>u.isActive=s)},{default:l(()=>[n(" Показать только активных ")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",Oe,[e("div",Pe,[e("div",qe,[e("div",Ke,[x.value.length>0?(r(),c("div",je,[e("table",ze,[e("thead",null,[e("tr",null,[(r(!0),c(p,null,g(Q.value,({column:s,label:de,sortable:re,is_num:B,width:ce})=>(r(),he(Ue,{key:s,column:s,"is-numeric":B,"sort-by-asc":h(m).sortBy.asc,"sort-by-column":h(m).sortBy.column===s,sortable:re,width:ce,onSetSort:Nt=>h(m).setSort(s,B)},{default:l(()=>[n(d(de),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(r(!0),c(p,null,g(x.value,s=>(r(),c("tr",{key:s.id},[e("th",Ge,d(s.id),1),e("td",Je,[i(ne,{to:{name:"Customer.View",params:{id:s.id}}},{default:l(()=>[n(d(s.name),1)]),_:2},1032,["to"])]),e("td",Qe,d(s.userName),1),e("td",We,d(s.regionName),1),e("td",Xe,d(s.cityName),1),e("td",null,[i(H,{"is-active":s.isActive},null,8,["is-active"])]),i(R,{id:s.id,intent:"view",onRunButtonHandler:ee},{default:l(()=>[n("View ")]),_:2},1032,["id"]),C.value?(r(),c(p,{key:0},[i(R,{id:s.id,intent:"edit",onRunButtonHandler:Z},{default:l(()=>[n("Edit ")]),_:2},1032,["id"]),i(R,{id:s.id,intent:"delete",onRunButtonHandler:ie},{default:l(()=>[n("Delete ")]),_:2},1032,["id"])],64)):L("",!0)]))),128))])])])):(r(),c("p",Ye,d(h(k).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[n("Всего записей: "),e("span",Ze,d(x.value.length),1)])])])])]),i(q,{id:"modalPopUp","close-func":te,"custom-classes":[""]},{title:l(()=>[t.isEditing?(r(),c("span",et,[n("Редактирование контрагента "),tt,e("b",null,d(t.customer.name),1)])):(r(),c("span",st,"Добавление контрагента"))]),body:l(()=>[i(be),e("div",ot,[e("div",lt,[i(b,{for:"name",required:""},{default:l(()=>[n("Название контрагента")]),_:1}),i(ye,{modelValue:t.customer.name,"onUpdate:modelValue":o[5]||(o[5]=s=>t.customer.name=s),type:"text",id:"name",placeholder:"Например: Уральская Бакалея, ООО"},null,8,["modelValue"])]),e("div",it,[i(b,{for:"region_id",required:""},{default:l(()=>[n("Регион")]),_:1}),f(e("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>t.customer.regionId=s),onChange:o[7]||(o[7]=s=>{A(),t.customer.cityId=null}),id:"region_id",class:"form-select"},[at,(r(!0),c(p,null,g(t.regions,s=>(r(),c("option",{value:s.id,key:s.id},d(s.name),9,nt))),128))],544),[[N,t.customer.regionId]])]),t.customer.regionId?(r(),c("div",dt,[i(b,{for:"city_id",required:""},{default:l(()=>[n("Город")]),_:1}),f(e("select",{"onUpdate:modelValue":o[8]||(o[8]=s=>t.customer.cityId=s),id:"city_id",class:"form-select"},[rt,(r(!0),c(p,null,g(t.cities,s=>(r(),c("option",{value:s.id,key:s.id},d(s.name),9,ct))),128))],512),[[N,t.customer.cityId]])])):L("",!0),e("div",ut,[i(b,{for:"user_id"},{default:l(()=>[n("Менеджер для контрагента")]),_:1}),f(e("select",{id:"user_id","onUpdate:modelValue":o[9]||(o[9]=s=>t.customer.userId=s),class:"form-select"},[mt,(r(!0),c(p,null,g(t.users,s=>(r(),c("option",{key:s.id,value:s.id},d(s.fullName),9,_t))),128))],512),[[N,t.customer.userId]])]),e("div",pt,[i(b,null,{default:l(()=>[n("Сброс привязки менеджера")]),_:1}),i(M,{onClick:o[10]||(o[10]=s=>t.customer.userId=null),type:"button",class:T(["btn-light",{"btn-disabled":t.customer.userId===null}]),disabled:t.customer.userId===null},{default:l(()=>[n(" Сбросить ")]),_:1},8,["class","disabled"])]),e("div",vt,[i(b,{for:"description"},{default:l(()=>[n("Описание для контрагента")]),_:1}),f(e("textarea",{id:"description","onUpdate:modelValue":o[11]||(o[11]=s=>t.customer.description=s),class:"form-control",placeholder:"Укажите произвольное описание"},null,512),[[ge,t.customer.description]])]),e("div",ft,[e("div",ht,[f(e("input",{id:"is-active","onUpdate:modelValue":o[12]||(o[12]=s=>t.customer.isActive=s),checked:t.customer.isActive,class:"form-check-input",type:"checkbox"},null,8,bt),[[we,t.customer.isActive]]),yt])])])]),footer:l(()=>[i(M,{onClick:le,type:"button",loading:h(k).isButtonDisabled,disabled:h(k).isButtonDisabled,class:T(["w-25",t.isEditing?"btn-warning":"btn-primary"])},{default:l(()=>[t.isEditing?(r(),c("span",gt,"Сохранить")):(r(),c("span",wt,"Создать"))]),_:1},8,["loading","disabled","class"])]),_:1}),i(q,{id:"viewModalPopUp","close-func":se,"custom-classes":["modal-lg","modal-dialog-scrollable"]},{title:l(()=>[n(" Просмотр контрагента "),e("b",null,d(t.customer.name),1)]),body:l(()=>[e("table",It,[e("tbody",null,[e("tr",null,[Et,e("td",null,d(t.customer.id),1)]),e("tr",null,[St,e("td",null,d(t.customer.name),1)]),e("tr",null,[Vt,e("td",null,d(t.customer.regionName),1)]),e("tr",null,[kt,e("td",null,d(t.customer.cityName),1)]),e("tr",null,[Ut,e("td",null,d(t.customer.userName),1)]),e("tr",null,[Ct,e("td",null,[i(H,{"is-active":t.customer.isActive},null,8,["is-active"])])])])])]),footer:l(()=>[xt]),_:1})],64)}}};export{Pt as default};
