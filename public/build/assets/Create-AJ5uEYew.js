import{d as W,r as z,C as ee,e as le,M as K,f as M,D as Q,o as n,c as m,g as e,t as b,l as u,k as f,H as O,F as T,j as V,I as U,h as a,w as r,y as P,s as F,J as N,z as q,T as j,K as Y,b as de,m as ae,L as re,N as ne,O as G,P as ie,u as ce,Q as ue,R as te,v as _e,B as D,G as pe,S as se,A as me,U as oe}from"./app-BiIGfiXh.js";var X={};Object.defineProperty(X,"__esModule",{value:!0});var J=X.default=void 0,fe={days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],daysShort:["Вос","Пон","Вто","Сре","Чет","Пят","Суб"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Очистить",dateFormat:"dd.MM.yyyy",timeFormat:"HH:mm",firstDay:1};J=X.default=fe;const he={class:"card"},ve={class:"card-header bg-success text-white"},ye={class:"card-body mt-3"},be=e("span",null,"Ассортимент для промо-акции",-1),ge=e("hr",null,null,-1),Pe={class:"mb-3"},$e={class:"fw-bold text-primary"},Ie={key:0,class:"row row-cols-xl-3 row-cols-lg-3 row-cols-md-2 row-cols-sm-2 row-cols-1 g-3"},Se={class:"card mb-0"},we={class:"card-header bg-secondary-subtle py-2 fw-bold text-black"},ke={class:"card-header py-2 fw-bold text-primary"},xe={class:"card-body mt-2 pb-2"},Ee={class:"row"},Be=e("div",{class:"col-7"},'Продажи "До"',-1),Ce={class:"col-5 fw-bold text-end"},Te={class:"row"},Oe=e("div",{class:"col-6"},"План",-1),Ve={class:"col-6 fw-bold text-end"},qe={class:"row"},Ue=e("div",{class:"col-7"},"Прирост",-1),Fe={class:"col-5 fw-bold text-end"},Ae={class:"row"},Re=e("div",{class:"col-6"},"Бюджет",-1),Ne={class:"col-6 fw-bold text-end"},Me={class:"card-footer py-2"},Le=["onClick"],De={class:"row g-3"},je={class:"col-md-6"},He=e("option",{disabled:"",selected:"",value:""},"-- Выберите группу товара --",-1),Ge=["value"],Ke={class:"col-md-6"},Qe=e("option",{disabled:"",selected:"",value:""},"-- Выберите SKU для промо-акции --",-1),Ye=["value"],ze={class:"col-md-4"},Je={class:"input-group"},We=e("span",{class:"input-group-text"},"шт.",-1),Xe=e("div",{id:"sales_before_help",class:"form-text"},"если продаж не было, укажите 0",-1),Ze={class:"col-md-4"},et={class:"input-group"},tt=e("span",{class:"input-group-text"},"шт.",-1),st={class:"col-md-4"},ot={class:"input-group"},lt=e("span",{class:"input-group-text"},"%",-1),dt=e("div",{id:"surplus_plan_help",class:"form-text"},"рассчитывается автоматически",-1),at={class:"col-md-4"},rt={class:"input-group"},nt=e("span",{class:"input-group-text"},"руб.",-1),it=e("div",{id:"profit_plan_help",class:"form-text"},"берётся из P&L",-1),ct={class:"col-md-4"},ut={class:"input-group"},_t=e("span",{class:"input-group-text"},"руб.",-1),pt={class:"col-md-4"},mt={class:"input-group"},ft=e("span",{class:"input-group-text"},"руб.",-1),ht={__name:"TheDiscount",props:{title:{type:String,required:!0,default:"Title is required"}},emits:["addProductToPromo","removeProductFromPromo"],setup(C,{emit:x}){const{get:h}=W(),S=C,k=x,A=()=>({categoryId:"",productId:"",salesBefore:0,salesPlan:0,surplusPlan:0,profitPlan:0,compensation:0,budgetPlan:0}),s=z({categories:[],products:[],form:A()}),E=ee([]),o=ee([]);let _=null;function R(){s.products=[],s.form=A()}le(async()=>{await H(),_=new bootstrap.Modal(document.getElementById("modalPopUp")),_._element.addEventListener("hide.bs.modal",R)});const H=async()=>{const{data:t}=await h(K.CATEGORY,{params:{category_is_active:!0,product_is_active:!0,products:!0}});s.categories=t.categories},L=()=>{R(),_.show()},w=()=>{R(),_.hide(),_._element.removeEventListener("hide.bs.modal",R)},v=()=>{s.categories.map(t=>{+t.id==+s.form.categoryId&&(s.products=t.products)}),s.products=s.products.filter(t=>!o.value.includes(t.id))},c=()=>{E.value.push({categoryId:s.form.categoryId,productId:s.form.productId,categoryName:g(),productName:y(),salesBefore:s.form.salesBefore,salesPlan:s.form.salesPlan,surplusPlan:s.form.surplusPlan,budgetPlan:s.form.budgetPlan}),o.value.push(+s.form.productId),k("addProductToPromo",s.form),w()},$=t=>{E.value.splice(t,1),o.value.splice(t,1),k("removeProductFromPromo",t)},g=()=>{const t=s.categories.findIndex(p=>p.id===+s.form.categoryId);return s.categories[t].name},y=()=>{const t=s.categories.findIndex(i=>i.id===+s.form.categoryId),p=s.categories[t].products.findIndex(i=>i.id===+s.form.productId);return s.categories[t].products[p].name},I=M(()=>{let t=!0;for(let[p,i]of Object.entries(s.form))if(!(p==="salesBefore"||p==="surplusPlan")&&!i){t=!1;break}return t}),B=M(()=>E.value.reduce((t,p)=>t+parseInt(p.budgetPlan),0));Q(()=>s.form.salesBefore,()=>d()),Q(()=>s.form.salesPlan,()=>{d(),l()}),Q(()=>s.form.compensation,()=>{l()});function d(){const t=+s.form.salesBefore,p=+s.form.salesPlan;s.form.surplusPlan=t===0?0:((p-t)/t*100).toFixed()}function l(){const t=+s.form.salesPlan,p=+s.form.compensation;s.form.budgetPlan=parseInt((p*t).toFixed(0))}return(t,p)=>(n(),m("div",null,[e("div",he,[e("div",ve,b(S.title),1),e("div",ye,[e("div",{class:"d-flex justify-content-between align-items-center"},[be,e("button",{onClick:L,class:"btn btn-success",type:"button"}," Добавить ")]),ge,e("h5",Pe,[u("Итоговый бюджет на промо-акцию: "),e("span",$e,b(f(O)(B.value))+" руб.",1)]),E.value.length>0?(n(),m("div",Ie,[(n(!0),m(T,null,V(E.value,(i,Z)=>(n(),m("div",{class:"col",key:Z},[e("div",Se,[e("h6",we,b(i.categoryName),1),e("h6",ke,b(i.productName),1),e("div",xe,[e("div",Ee,[Be,e("div",Ce,b(f(O)(i.salesBefore))+" шт.",1)]),e("div",Te,[Oe,e("div",Ve,b(f(O)(i.salesPlan))+" шт.",1)]),e("div",qe,[Ue,e("div",Fe,b(f(O)(i.surplusPlan))+" %",1)]),e("div",Ae,[Re,e("div",Ne,b(f(O)(i.budgetPlan))+" руб.",1)])]),e("div",Me,[e("button",{class:"btn btn-danger w-100",onClick:$o=>$(Z)},"Удалить",8,Le)])])]))),128))])):U("",!0)])]),a(Y,{id:"modalPopUp","close-func":w,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[e("div",De,[e("div",je,[a(P,{for:"category_id",required:""},{default:r(()=>[u("Группа товара")]),_:1}),F(e("select",{"onUpdate:modelValue":p[0]||(p[0]=i=>s.form.categoryId=i),onChange:v,id:"category_id",class:"form-select"},[He,(n(!0),m(T,null,V(s.categories,i=>(n(),m("option",{key:i.id,value:i.id},b(i.name),9,Ge))),128))],544),[[N,s.form.categoryId]])]),e("div",Ke,[a(P,{for:"product_id",required:""},{default:r(()=>[u("Ассортимент")]),_:1}),F(e("select",{"onUpdate:modelValue":p[1]||(p[1]=i=>s.form.productId=i),id:"product_id",class:"form-select"},[Qe,(n(!0),m(T,null,V(s.products,i=>(n(),m("option",{key:i.id,value:i.id},b(i.name),9,Ye))),128))],512),[[N,s.form.productId]])]),e("div",ze,[a(P,{for:"sales_before",required:""},{default:r(()=>[u('Продажи "До акции"')]),_:1}),e("div",Je,[a(q,{id:"sales_before",modelValue:s.form.salesBefore,"onUpdate:modelValue":p[2]||(p[2]=i=>s.form.salesBefore=i),type:"number",min:"0","aria-describedby":"sales_before_help"},null,8,["modelValue"]),We]),Xe]),e("div",Ze,[a(P,{for:"sales_plan",required:""},{default:r(()=>[u('План продаж "Во время"')]),_:1}),e("div",et,[a(q,{id:"sales_plan",modelValue:s.form.salesPlan,"onUpdate:modelValue":p[3]||(p[3]=i=>s.form.salesPlan=i),type:"number",min:"0"},null,8,["modelValue"]),tt])]),e("div",st,[a(P,{for:"surplus_plan",required:""},{default:r(()=>[u("План прироста")]),_:1}),e("div",ot,[a(q,{id:"surplus_plan",modelValue:s.form.surplusPlan,"onUpdate:modelValue":p[4]||(p[4]=i=>s.form.surplusPlan=i),type:"number",disabled:"disabled","aria-describedby":"surplus_plan_help"},null,8,["modelValue"]),lt]),dt]),e("div",at,[a(P,{for:"profit_plan",required:""},{default:r(()=>[u("Прибыль на 1 шт.")]),_:1}),e("div",rt,[a(q,{id:"profit_plan",modelValue:s.form.profitPlan,"onUpdate:modelValue":p[5]||(p[5]=i=>s.form.profitPlan=i),type:"number",min:"0",step:"0.01","aria-describedby":"profit_plan_help"},null,8,["modelValue"]),nt]),it]),e("div",ct,[a(P,{for:"compensation",required:""},{default:r(()=>[u("Компенсация на 1 шт.")]),_:1}),e("div",ut,[a(q,{id:"compensation",modelValue:s.form.compensation,"onUpdate:modelValue":p[6]||(p[6]=i=>s.form.compensation=i),type:"number",min:"0",step:"0.01","aria-describedby":"compensation_help"},null,8,["modelValue"]),_t])]),e("div",pt,[a(P,{for:"budget_plan",required:""},{default:r(()=>[u("Бюджет")]),_:1}),e("div",mt,[a(q,{id:"budget_plan",modelValue:s.form.budgetPlan,"onUpdate:modelValue":p[7]||(p[7]=i=>s.form.budgetPlan=i),type:"number",disabled:"disabled","aria-describedby":"budget_plan_help"},null,8,["modelValue"]),ft])])])]),footer:r(()=>[a(j,{onClick:c,type:"button",class:"btn-success w-25",disabled:!I.value},{default:r(()=>[u(" Добавить ")]),_:1},8,["disabled"])]),_:1})]))}},vt={class:"card"},yt={class:"card-header bg-secondary text-white"},bt={class:"card-body mt-3"},gt=e("div",{class:"d-flex justify-content-between align-items-center"},[e("span",null,"Участники из команды ТП")],-1),Pt=e("hr",null,null,-1),$t={class:"fw-bold text-primary"},It={class:"mb-3"},St={class:"fw-bold text-primary"},wt=e("p",null,"Выберите торговых представителей, участвующих в акции:",-1),kt={key:0},xt={key:1},Et={class:"list-group"},Bt=re('<li class="list-group-item m-0"><div class="row text-center"><div class="col-5">ФИО</div><div class="col-2">Продажи, факт</div><div class="col-2">План, %</div><div class="col-2">Продажи, план</div><div class="col-1">Del</div></div></li>',1),Ct={class:"list-group-item m-0"},Tt={class:"row g-2"},Ot={class:"col-5"},Vt={class:"input-group"},qt={class:"input-group-text"},Ut=["value"],Ft={class:"col-2"},At=["id","onInput"],Rt={class:"col-2"},Nt=["id","onInput"],Mt={class:"col-2"},Lt=["id","onInput"],Dt={class:"col-1 text-center"},jt=["onClick"],Ht=e("i",{class:"bi-x-lg"},null,-1),Gt=[Ht],Kt={__name:"SalesPeopleBoost",props:{title:{type:String,required:!0,default:"Title is required"},customerId:{type:Number,required:!0},sellers:{type:Array,required:!0,default:[]}},emits:["addSellersToPromo"],setup(C,{emit:x}){W();const h=de(),S=()=>({sellerId:"",salesBefore:0,salesPlan:0,surplusPlan:0,salesAfter:0,compensation:ne,budgetPlan:0,budgetActual:0}),k=C,A=x,s=z({checkedSellers:[],form:S()}),E=M(()=>{const w=k.sellers.filter(v=>v.isActive).map(v=>({...v,...s.form}));return h.sortArrayByStringColumn(w,"name")}),o=(w,v)=>{let c=E.value[v];const $=s.checkedSellers.findIndex(i=>i.id===c.id);$===-1?(s.checkedSellers.push(c),A("addSellersToPromo",s.checkedSellers)):c=s.checkedSellers[$];const g=w.target.value,y=document.getElementById(`${v}_salesBefore`),I=document.getElementById(`${v}_surplusPlan`),B=document.getElementById(`${v}_salesPlan`);let d=G(g),l,t,p;g===""?(l=0,t=0,p=0,I.value="",B.value="",I.setAttribute("readonly","readonly"),B.setAttribute("readonly","readonly"),s.checkedSellers.splice($,1)):d===0?(d=0,l=0,t=0,p=0,I.value=l,I.setAttribute("readonly","readonly"),B.removeAttribute("readonly")):(l=I.value===""?ie:G(I.value),t=+(d+d*l/100).toFixed(2),p=+(t/c.compensation).toFixed(2),y.value=O(d),B.value=O(t),B.setAttribute("readonly","readonly"),I.removeAttribute("readonly"),I.value=l),c.sellerId=c.id,c.salesBefore=d,c.surplusPlan=l,c.salesPlan=t,c.budgetPlan=p},_=(w,v)=>{let c=E.value[v];const $=s.checkedSellers.findIndex(i=>i.id===c.id);$===-1?(s.checkedSellers.push(c),A("addSellersToPromo",s.checkedSellers)):c=s.checkedSellers[$];const g=w.target.value,y=document.getElementById(`${v}_salesBefore`),I=document.getElementById(`${v}_surplusPlan`),B=document.getElementById(`${v}_salesPlan`);let d=G(y.value),l=G(g),t,p;(g===""||isNaN(l))&&(l=0,I.value=l),t=+(d+d*l/100).toFixed(2),p=+(t/c.compensation).toFixed(2),I.value=O(l),B.value=O(t),c.sellerId=c.id,c.salesBefore=d,c.surplusPlan=l,c.salesPlan=t,c.budgetPlan=p},R=(w,v)=>{let c=E.value[v];const $=s.checkedSellers.findIndex(t=>t.id===c.id);c=s.checkedSellers[$];const g=w.target.value;let y=G(g);const I=document.getElementById(`${v}_salesPlan`);let B=0,d=0,l;g===""||isNaN(y)?(y=0,I.value=y):(l=+(y/c.compensation).toFixed(2),y=+y.toFixed(2),I.value=O(y)),c.salesBefore=B,c.surplusPlan=d,c.salesPlan=y,c.budgetPlan=l},H=M(()=>s.checkedSellers.reduce((w,v)=>w+parseInt(v.budgetPlan),0)),L=(w,v)=>{const c=s.checkedSellers.findIndex($=>$.id===w);if(c!==-1){const $=document.getElementById(`${v}_salesBefore`),g=document.getElementById(`${v}_surplusPlan`),y=document.getElementById(`${v}_salesPlan`);$.value="",g.value="",y.value="",s.checkedSellers.splice(c,1)}};return(w,v)=>{const c=ae("RouterLink");return n(),m("div",null,[e("div",vt,[e("div",yt,b(k.title),1),e("div",bt,[gt,Pt,e("pre",null,"                    "+b(s.checkedSellers)+`
                `,1),e("h5",null,[u("Мотивация для расчёта бюджета: "),e("span",$t,b(s.form.compensation)+" %",1)]),e("h5",It,[u("Планируемый бюджет на промо-акцию: "),e("span",St,b(f(O)(H.value))+" руб.",1)]),wt,E.value.length===0?(n(),m("div",kt,[e("p",null,[u("В команду дистрибьютора не добавлено ни одного торгового представителя. "),a(c,{to:{name:"Manager.Customer.View",params:{id:k.customerId}},class:"fw-bold"},{default:r(()=>[u("Перейдите в карточку контрагента")]),_:1},8,["to"]),u(' на вкладку "Команда ТП" и добавьте торговых представителей.')])])):(n(),m("div",xt,[e("ul",Et,[Bt,(n(!0),m(T,null,V(E.value,($,g)=>(n(),m("li",Ct,[e("div",Tt,[e("div",Ot,[e("div",Vt,[e("span",qt,b(g+1),1),e("input",{type:"text",class:"form-control",value:$.shortName,readonly:""},null,8,Ut)])]),e("div",Ft,[e("input",{id:`${g}_salesBefore`,onInput:y=>o(y,g),class:"form-control text-end",type:"text"},null,40,At)]),e("div",Rt,[e("input",{id:`${g}_surplusPlan`,onInput:y=>_(y,g),class:"form-control text-end",type:"text",readonly:""},null,40,Nt)]),e("div",Mt,[e("input",{id:`${g}_salesPlan`,onInput:y=>R(y,g),class:"form-control text-end",type:"text",readonly:""},null,40,Lt)]),e("div",Dt,[e("button",{onClick:y=>L($.id,g),class:"btn btn-outline-danger"},Gt,8,jt)])])]))),256))])]))])])])}}},Qt={class:"card"},Yt={class:"card-header bg-warning text-white"},zt={class:"card-body mt-3"},Jt={class:"d-flex justify-content-between align-items-center"},Wt=e("span",null,"Ассортимент для подарков за покупку",-1),Xt=e("hr",null,null,-1),Zt=e("div",{class:"row g-3"},null,-1),es={__name:"GiftForPurchase",props:{title:{type:String,required:!0,default:"Title is required"}},setup(C){const x=C;return(h,S)=>(n(),m("div",null,[e("div",Qt,[e("div",Yt,b(x.title),1),e("div",zt,[e("div",Jt,[Wt,e("button",{onClick:S[0]||(S[0]=(...k)=>h.addProductModalInit&&h.addProductModalInit(...k)),class:"btn btn-success",type:"button"}," Добавить ")]),Xt])]),a(Y,{id:"modalPopUp","close-func":h.closeModal,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[Zt]),footer:r(()=>[a(j,{onClick:h.addProduct,type:"button",class:"btn-success w-25",disabled:!h.isFormValid},{default:r(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},ts={class:"card"},ss={class:"card-header bg-info text-white"},os={class:"card-body mt-3"},ls={class:"d-flex justify-content-between align-items-center"},ds=e("span",null,"Список торговых точек",-1),as=e("hr",null,null,-1),rs=e("div",{class:"row g-3"},null,-1),ns={__name:"RetailersBoost",props:{title:{type:String,required:!0,default:"Title is required"}},setup(C){const x=C;return(h,S)=>(n(),m("div",null,[e("div",ts,[e("div",ss,b(x.title),1),e("div",os,[e("div",ls,[ds,e("button",{onClick:S[0]||(S[0]=(...k)=>h.addProductModalInit&&h.addProductModalInit(...k)),class:"btn btn-success",type:"button"}," Добавить ")]),as])]),a(Y,{id:"modalPopUp","close-func":h.closeModal,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[rs]),footer:r(()=>[a(j,{onClick:h.addProduct,type:"button",class:"btn-success w-25",disabled:!h.isFormValid},{default:r(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},is={class:"card"},cs={class:"card-header bg-dark text-white"},us={class:"card-body mt-3"},_s={class:"d-flex justify-content-between align-items-center"},ps=e("span",null,"Инфо по покрытию",-1),ms=e("hr",null,null,-1),fs=e("div",{class:"row g-3"},null,-1),hs={__name:"CoverageIncrease",props:{title:{type:String,required:!0,default:"Title is required"}},setup(C){const x=C;return(h,S)=>(n(),m("div",null,[e("div",is,[e("div",cs,b(x.title),1),e("div",us,[e("div",_s,[ps,e("button",{onClick:S[0]||(S[0]=(...k)=>h.addProductModalInit&&h.addProductModalInit(...k)),class:"btn btn-success",type:"button"}," Добавить ")]),ms])]),a(Y,{id:"modalPopUp","close-func":h.closeModal,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[fs]),footer:r(()=>[a(j,{onClick:h.addProduct,type:"button",class:"btn-success w-25",disabled:!h.isFormValid},{default:r(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},vs={class:"card"},ys={class:"card-header bg-danger text-white"},bs={class:"card-body mt-3"},gs={class:"d-flex justify-content-between align-items-center"},Ps=e("span",null,"Ассортимент для промо-акции",-1),$s=e("hr",null,null,-1),Is=e("div",{class:"row g-3"},null,-1),Ss={__name:"TheInOut",props:{title:{type:String,required:!0,default:"Title is required"}},setup(C){const x=C;return(h,S)=>(n(),m("div",null,[e("div",vs,[e("div",ys,b(x.title),1),e("div",bs,[e("div",gs,[Ps,e("button",{onClick:S[0]||(S[0]=(...k)=>h.addProductModalInit&&h.addProductModalInit(...k)),class:"btn btn-success",type:"button"}," Добавить ")]),$s])]),a(Y,{id:"modalPopUp","close-func":h.closeModal,"custom-classes":["modal-lg"]},{title:r(()=>[u(" Добавление ассортимента для промо-акции ")]),body:r(()=>[Is]),footer:r(()=>[a(j,{onClick:h.addProduct,type:"button",class:"btn-success w-25",disabled:!h.isFormValid},{default:r(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},ws={class:"row"},ks={class:"col-lg-5"},xs={class:"card"},Es=e("div",{class:"card-header bg-primary text-white"},"Укажите общие данные промо-акции",-1),Bs={class:"card-body mt-3"},Cs={class:"row g-3"},Ts={class:"col-md-6"},Os=e("option",{disabled:"",selected:"",value:""},"- Выберите вид промо-акции -",-1),Vs=["value"],qs={class:"col-md-6"},Us={class:"input-group"},Fs=e("span",{class:"input-group-text"},"%",-1),As={class:"col-md-6"},Rs={class:"col-md-6"},Ns=["disabled"],Ms=e("option",{disabled:"",selected:"",value:""},"- Выберите канал продаж -",-1),Ls=["value"],Ds={class:"col-md-6"},js=["disabled"],Hs=e("option",{disabled:"",selected:"",value:""},"- Выберите дистрибутора -",-1),Gs=["value"],Ks={class:"col-md-6"},Qs=["disabled"],Ys=e("option",{disabled:"",selected:"",value:""},"- Выберите торговую сеть -",-1),zs=["value"],Js={class:"col-md-6"},Ws=e("option",{disabled:"",selected:"",value:""},"- Выберите регион -",-1),Xs=["value","selected"],Zs={class:"col-md-6"},eo=e("option",{disabled:"",selected:"",value:""},"- Выберите город -",-1),to=["value","selected"],so={class:"col-md-6"},oo=e("div",{id:"start_date_help",class:"form-text"},"укажите дату начала акции",-1),lo={class:"col-md-6"},ao=e("div",{id:"end_date_help",class:"form-text"},"укажите дату окончания акции",-1),ro={class:"col-md-6"},no={class:"input-group"},io=["disabled"],co={key:0,class:"input-group-text border-success bg-success text-white px-4"},uo={key:1,class:"input-group-text border-warning bg-warning px-4"},_o=e("div",{id:"products_help",class:"form-text"},"только для скидочных акций",-1),po={class:"col-md-6"},mo={class:"input-group"},fo=["disabled"],ho={key:0,class:"input-group-text border-success bg-success text-white px-4"},vo={key:1,class:"input-group-text border-warning bg-warning px-4"},yo=e("div",{id:"sellers_help",class:"form-text"},"только для мотивации ТП",-1),bo={class:"col-12"},go={class:"card-footer"},Po={class:"col-lg-7"},So={__name:"Create",setup(C){const{get:x,post:h}=W(),S=ce(),k=pe(),A=ue().getUser,s=de();te("#start_date",{locale:J,onSelect:({date:d,datepicker:l})=>{o.promo.startDate=se(d),l.hide()}}),te("#end_date",{locale:J,onSelect:({date:d,datepicker:l})=>{o.promo.endDate=se(d),l.hide()}});const E=()=>({promoType:"",promoForRetail:!1,discount:null,userId:A.id,regionId:"",cityId:"",channelId:"",customerId:"",retailerId:"",startDate:"",endDate:"",comments:"",products:[],sellers:[]}),o=z({customerSellers:[],customers:[],retailers:[],cities:[],channels:[],promo:E()});let _=z({isForRetail:!1,type:"",title:"",code:""});le(async()=>{await H()});const R=async d=>{const{data:l}=await x(K.CHANNEL);o.channels=l.channels.filter(t=>t.isForRetail===d.isForRetail)},H=async()=>{const{data:d}=await x(K.CUSTOMER,{params:{region:!0,city:!0,user:!0,retailers:!0}});o.customers=d.customers},L=async d=>{const{status:l,data:t}=await x(`${K.CUSTOMER}/${d}`,{params:{customer_sellers:!0}});l==="success"&&(o.customerSellers=t.customerSellers)};Q(()=>o.promo.promoType,async d=>{const l=d;_=oe.find(t=>t.type===l),o.promo.products=[],o.promo.sellers=[],o.promo.discount=null,o.promo.promoForRetail=_.isForRetail,l==="SALES_PEOPLE_BOOST"&&o.promo.customerId&&await L(o.promo.customerId),await R(_)}),Q(()=>o.promo.customerId,async d=>{o.promo.promoType==="SALES_PEOPLE_BOOST"&&await L(o.promo.customerId),w(d)});const w=d=>{const l=o.customers.find(t=>+t.id==+d);o.promo.regionId=l.region.id,o.promo.cityId=l.city.id,o.promo.retailerId="",o.customers.map(t=>{+t.id==+d&&(o.retailers=t.retailers)})},v=d=>{o.promo.products.push(d)},c=d=>{o.promo.products.splice(d,1)},$=d=>{o.promo.sellers=d},g=async()=>{const d=await h(K.PROMO,o.promo);d&&d.status==="success"&&(S.clear(),o.promo=E(),await k.push({name:"Manager.Promo.Index"}))},y=M(()=>s.sortArrayByStringColumn(o.customers,"name")),I=M(()=>s.getUniqueObjectsFromArray(y.value.map(d=>d.region))),B=M(()=>s.getUniqueObjectsFromArray(y.value.map(d=>d.city)));return(d,l)=>(n(),m("div",ws,[e("div",ks,[e("div",xs,[Es,e("div",Bs,[a(me),e("div",Cs,[e("div",Ts,[a(P,{for:"promo_type",required:""},{default:r(()=>[u("Вид промо-акции")]),_:1}),F(e("select",{"onUpdate:modelValue":l[0]||(l[0]=t=>o.promo.promoType=t),id:"promo_type",class:"form-select"},[Os,(n(!0),m(T,null,V(f(oe),t=>(n(),m("option",{key:t.id,value:t.type},b(t.title),9,Vs))),128))],512),[[N,o.promo.promoType]])]),e("div",qs,[a(P,{for:"discount",required:f(_).type==="DISCOUNT"},{default:r(()=>[u("Величина скидки")]),_:1},8,["required"]),e("div",Us,[a(q,{id:"discount",modelValue:o.promo.discount,"onUpdate:modelValue":l[1]||(l[1]=t=>o.promo.discount=t),type:"number",min:"5",step:"1",max:"50",disabled:f(_).type!=="DISCOUNT"},null,8,["modelValue","disabled"]),Fs])]),e("div",As,[a(P,{for:"user_id"},{default:r(()=>[u("Менеджер")]),_:1}),a(q,{id:"user_id",type:"text",value:f(A).fullName,disabled:"disabled"},null,8,["value"])]),e("div",Rs,[a(P,{for:"channel_id",required:f(_).type!==""},{default:r(()=>[u("Канал продаж")]),_:1},8,["required"]),F(e("select",{"onUpdate:modelValue":l[2]||(l[2]=t=>o.promo.channelId=t),id:"channel_id",class:"form-select",disabled:f(_).type===""},[Ms,(n(!0),m(T,null,V(o.channels,t=>(n(),m("option",{key:t.id,value:t.id},b(t.name),9,Ls))),128))],8,Ns),[[N,o.promo.channelId]])]),e("div",Ds,[a(P,{for:"customer_id",required:f(_).type!==""},{default:r(()=>[u("Дистрибутор")]),_:1},8,["required"]),F(e("select",{"onUpdate:modelValue":l[3]||(l[3]=t=>o.promo.customerId=t),id:"customer_id",class:"form-select",disabled:f(_).type===""},[Hs,(n(!0),m(T,null,V(y.value,t=>(n(),m("option",{key:t.id,value:t.id},b(t.name),9,Gs))),128))],8,js),[[N,o.promo.customerId]])]),e("div",Ks,[a(P,{for:"retailer_id",required:o.retailers.length>0&&f(_).isForRetail===!0},{default:r(()=>[u("Торговая сеть")]),_:1},8,["required"]),F(e("select",{"onUpdate:modelValue":l[4]||(l[4]=t=>o.promo.retailerId=t),id:"retailer_id",class:"form-select",disabled:o.retailers.length===0||!f(_).isForRetail},[Ys,(n(!0),m(T,null,V(o.retailers,t=>(n(),m("option",{key:t.id,value:t.id},b(t.name),9,zs))),128))],8,Qs),[[N,o.promo.retailerId]])]),e("div",Js,[a(P,{for:"region_id",required:""},{default:r(()=>[u("Регион")]),_:1}),F(e("select",{"onUpdate:modelValue":l[5]||(l[5]=t=>o.promo.regionId=t),id:"region_id",class:"form-select",disabled:"disabled"},[Ws,(n(!0),m(T,null,V(I.value,t=>(n(),m("option",{key:t.id,value:t.id,selected:o.promo.regionId},b(t.name),9,Xs))),128))],512),[[N,o.promo.regionId]])]),e("div",Zs,[a(P,{for:"city_id",required:""},{default:r(()=>[u("Город")]),_:1}),F(e("select",{"onUpdate:modelValue":l[6]||(l[6]=t=>o.promo.cityId=t),id:"city_id",class:"form-select",disabled:"disabled"},[eo,(n(!0),m(T,null,V(B.value,t=>(n(),m("option",{key:t.id,value:t.id,selected:o.promo.cityId},b(t.name),9,to))),128))],512),[[N,o.promo.cityId]])]),e("div",so,[a(P,{for:"start_date",required:""},{default:r(()=>[u("Начало промо-акции")]),_:1}),a(q,{id:"start_date",type:"text",readonly:"readonly","aria-describedby":"start_date_help"}),oo]),e("div",lo,[a(P,{for:"end_date",required:""},{default:r(()=>[u("Окончание промо-акции")]),_:1}),a(q,{id:"end_date",type:"text",readonly:"readonly","aria-describedby":"end_date_help"}),ao]),e("div",ro,[a(P,{for:"products",required:f(_).isForRetail===!0},{default:r(()=>[u("Ассортимент для акции")]),_:1},8,["required"]),e("div",no,[e("input",{id:"products",type:"text",class:"form-control",value:"Ассортимент добавлен?","aria-describedby":"products_help",disabled:!f(_).isForRetail,readonly:""},null,8,io),f(_).isForRetail===!0?(n(),m(T,{key:0},[o.promo.products.length>0?(n(),m("span",co,"Да")):(n(),m("span",uo,"Нет"))],64)):U("",!0)]),_o]),e("div",po,[a(P,{for:"sellers",required:f(_).type==="SALES_PEOPLE_BOOST"},{default:r(()=>[u("Команда ТП")]),_:1},8,["required"]),e("div",mo,[e("input",{id:"sellers",type:"text",class:"form-control",value:"Команда добавлена?","aria-describedby":"sellers_help",disabled:f(_).type!=="SALES_PEOPLE_BOOST",readonly:""},null,8,fo),f(_).type==="SALES_PEOPLE_BOOST"?(n(),m(T,{key:0},[o.promo.sellers.length>0?(n(),m("span",ho,"Да")):(n(),m("span",vo,"Нет"))],64)):U("",!0)]),yo]),e("div",bo,[a(P,{for:"comments"},{default:r(()=>[u("Механика промо-акции")]),_:1}),F(e("textarea",{id:"comments","onUpdate:modelValue":l[7]||(l[7]=t=>o.promo.comments=t),class:"form-control",style:{height:"100px"}},null,512),[[_e,o.promo.comments]])])])]),e("div",go,[a(j,{onClick:g,type:"button",class:"btn-primary w-25"},{default:r(()=>[u(" Сохранить ")]),_:1})])])]),e("div",Po,[f(_).type==="DISCOUNT"?(n(),D(ht,{key:0,title:f(_).title,onAddProductToPromo:v,onRemoveProductFromPromo:c},null,8,["title"])):U("",!0),f(_).type==="SALES_PEOPLE_BOOST"&&o.promo.customerId?(n(),D(Kt,{key:1,title:f(_).title,sellers:o.customerSellers,"customer-id":+o.promo.customerId,onAddSellersToPromo:$},null,8,["title","sellers","customer-id"])):U("",!0),f(_).type==="GIFT_FOR_PURCHASE"?(n(),D(es,{key:2,title:f(_).title},null,8,["title"])):U("",!0),f(_).type==="RETAILERS_BOOST"?(n(),D(ns,{key:3,title:f(_).title},null,8,["title"])):U("",!0),f(_).type==="COVERAGE_INCREASE"?(n(),D(hs,{key:4,title:f(_).title},null,8,["title"])):U("",!0),f(_).type==="IN_OUT"?(n(),D(Ss,{key:5,title:f(_).title},null,8,["title"])):U("",!0)])]))}};export{So as default};
