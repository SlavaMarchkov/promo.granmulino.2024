import{d as k,o as d,c,f as e,X as ue,u as _e,a as me,b as pe,r as N,e as he,A as b,t as r,s as h,y as ve,g as o,w as i,T as q,F as v,h as g,i as f,j as n,k as fe,a0 as ye,l as be,x as K,m as we,n as Ee,p as V,q as ge,I as T,L as Ve,v as O,R as ke,a1 as z,E as Se,D as Re}from"./app-LDVDDXIB.js";import{u as Ie}from"./useHttpService-H3Bhthf8.js";import{u as De}from"./useArrayHandlers-JXOu8LuP.js";import{_ as Y}from"./TheCheckbox--M688_LN.js";import{_ as B}from"./InputGroup-DFOwqnPq.js";import{_ as Ae,a as C}from"./TdButton-Cll3J42i.js";import{_ as D}from"./TheBadge-BK2ZTkEW.js";import{_ as Ue}from"./TheFilter-Bt1ein-f.js";import{_ as j}from"./Modal-Buqgi5Td.js";const xe={class:"input-group"},$e={class:"input-group-text"},Le=["id","name","value","checked"],Te=["for"],Be={__name:"RadioButton",props:{id:String,name:String,modelValue:{type:String,default:""},value:{type:String,default:""}},emits:["update:modelValue"],setup(M,{emit:y}){const _=M,A=y,m=()=>{A("update:modelValue",_.value)},w=k(()=>_.modelValue===_.value);return(U,H)=>(d(),c("div",xe,[e("div",$e,[e("input",{id:_.id,name:_.name,value:_.value,checked:w.value,class:"form-check-input mt-0",type:"radio",onChange:m},null,40,Le)]),e("label",{for:_.id,class:"form-control text-start"},[ue(U.$slots,"default")],8,Te)]))}},Ce={class:"row mb-4"},Me={class:"col-6"},He={class:"mb-0"},Pe={class:"col-6 text-end"},Fe={class:"row mb-4"},Ne={class:"col-12"},qe={class:"col-md-4 mb-2"},Ke={class:"col-md-4 mb-2"},Oe={class:"col-md-4 mb-2"},ze={class:"col-md-2 mb-2"},Ye={class:"col-md-2 mb-2"},je={class:"row mb-4"},Xe={class:"col-12"},Ge={class:"card"},Je={class:"card-body pb-0"},Qe={key:0,class:"table-responsive"},We={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Ze={scope:"row"},et={class:"text-start"},tt={class:"text-start"},st=["title"],lt={class:"text-start"},ot={class:"text-start"},it={key:1,class:"mt-3 text-center lead"},at={class:"fw-bold"},nt={key:0},dt=e("br",null,null,-1),rt={key:1},ct={class:"row g-3"},ut={class:"col-12"},_t={class:"col-12"},mt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите дистрибутора, который поставляет в эту ТС -- ",-1),pt=["value"],ht={class:"col-12"},vt=e("option",{disabled:"",selected:"",value:""},"-- Выберите тип торговой сети --",-1),ft=e("option",{value:"local"},"Локальная",-1),yt=e("option",{value:"regional"},"Региональная",-1),bt=e("option",{value:"federal"},"Федеральная",-1),wt=[vt,ft,yt,bt],Et={class:"col-12"},gt=e("option",{disabled:"",selected:"",value:"null"},"-- Выберите город, где находится штаб-квартира ТС -- ",-1),Vt=["value"],kt={class:"col-12"},St={class:"col-12"},Rt={class:"form-check"},It=["checked"],Dt=e("label",{class:"form-check-label",for:"is-direct"}," Прямой контракт (да/нет) ",-1),At={class:"col-12"},Ut={class:"form-check"},xt=["checked"],$t=e("label",{class:"form-check-label",for:"is-active"}," ТС активная (да/нет) ",-1),Lt={key:0},Tt={key:1},Bt={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},Ct=e("th",{style:{width:"30%"}},"ID",-1),Mt=e("th",null,"Название",-1),Ht=e("th",null,"Контрагент",-1),Pt=e("th",null,"Город",-1),Ft=e("th",null,"Прямой контракт?",-1),Nt=e("th",null,"Активна?",-1),qt=e("span",null,null,-1),Zt={__name:"Index",setup(M){const y=_e(),_=me(),A=pe(),m=De(),{get:w,post:U,update:H,destroy:X}=Ie(),G=A.getUser.role,x=k(()=>G===ke.SUPER_ADMIN),J=k(()=>x.value?z.concat(Se,Re):z),S=()=>({name:"",type:"",description:"",isActive:!0,isDirect:!1,customerId:null,cityId:null}),s=N({retailers:[],customers:[],cities:[],retailer:S(),isEditing:!1}),u=N({name:"",city:"",customer:"",type:"",isActive:!1,isDirect:!1});let p=null,E=null;function R(){s.isEditing=!1,s.retailer=S(),document.activeElement&&document.activeElement.blur()}he(async()=>{await I(),await Q(),await W(),p=new bootstrap.Modal(document.getElementById("modalPopUp")),p._element.addEventListener("hide.bs.modal",R)});const I=async()=>{const{data:a}=await w(b.RETAILER);s.retailers=a.retailers},Q=async()=>{const{data:a}=await w(b.CUSTOMER);s.customers=a.customers},W=async()=>{const{data:a}=await w(b.CITY);s.cities=a.cities},P=a=>s.retailers.find(l=>l.id===a),Z=()=>{y.clear(),s.isEditing=!1,s.retailer=S(),p.show()},ee=a=>{y.clear(),s.isEditing=!0,s.retailer=P(a),p.show()},te=a=>{E=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.retailer=P(a),E.show(),E._element.addEventListener("hide.bs.modal",R)},se=()=>{p.hide(),p._element.removeEventListener("hide.bs.modal",R)},le=()=>{E.hide(),E._element.removeEventListener("hide.bs.modal",R)},oe=()=>{m.resetSearchKeys(u),m.resetSortKeys()},ie=async()=>{if(s.isEditing){const a=await H(`${b.RETAILER}/${s.retailer.id}`,s.retailer);a&&a.status==="success"&&(y.clear(),p.hide(),await I())}else{const a=await U(b.RETAILER,s.retailer);a&&a.status==="success"&&(y.clear(),s.retailer=S(),p.hide(),m.resetSearchKeys(u),m.resetSortKeys("id",!1),await I())}},ae=async a=>{if(confirm("Точно удалить торговую сеть? Уверены?")){const l=await X(`${b.RETAILER}/${a}`);l&&l.status==="success"&&await I()}},ne=k(()=>m.sortArray(s.retailers)),$=k(()=>m.filterArray(ne.value,u));return(a,l)=>{const de=fe("RouterLink");return d(),c(v,null,[e("div",Ce,[e("div",Me,[e("h3",He,r(a.$route.meta.title),1)]),h(e("div",Pe,[o(q,{class:"btn-primary",onClick:Z},{default:i(()=>[n("Новая торговая сеть ")]),_:1})],512),[[ve,x.value]])]),e("div",Fe,[e("div",Ne,[o(Ue,{onResetFilter:oe},{default:i(()=>[e("div",qe,[o(B,{modelValue:u.name,"onUpdate:modelValue":l[0]||(l[0]=t=>u.name=t),placeholder:"Поиск по названию ТС"},{default:i(()=>[n("Название")]),_:1},8,["modelValue"])]),(d(!0),c(v,null,g(f(ye),t=>(d(),c("div",{class:"col-md-2 mb-2",key:t.id},[o(Be,{id:t.id,value:t.value,name:"retailer-type",modelValue:u.type,"onUpdate:modelValue":l[1]||(l[1]=L=>u.type=L)},{default:i(()=>[n(r(t.title),1)]),_:2},1032,["id","value","modelValue"])]))),128)),e("div",Ke,[o(B,{modelValue:u.city,"onUpdate:modelValue":l[2]||(l[2]=t=>u.city=t),placeholder:"Поиск по городу"},{default:i(()=>[n("Город")]),_:1},8,["modelValue"])]),e("div",Oe,[o(B,{modelValue:u.customer,"onUpdate:modelValue":l[3]||(l[3]=t=>u.customer=t),placeholder:"Поиск по контрагенту"},{default:i(()=>[n("Контрагент")]),_:1},8,["modelValue"])]),e("div",ze,[o(Y,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":l[4]||(l[4]=t=>u.isActive=t)},{default:i(()=>[n("Только активные")]),_:1},8,["modelValue"])]),e("div",Ye,[o(Y,{id:"is_direct",modelValue:u.isDirect,"onUpdate:modelValue":l[5]||(l[5]=t=>u.isDirect=t)},{default:i(()=>[n("Только прямые")]),_:1},8,["modelValue"])])]),_:1})])]),e("div",je,[e("div",Xe,[e("div",Ge,[e("div",Je,[$.value.length>0?(d(),c("div",Qe,[e("table",We,[e("thead",null,[e("tr",null,[(d(!0),c(v,null,g(J.value,({column:t,label:L,sortable:re,is_num:F,width:ce})=>(d(),be(Ae,{key:t,column:t,"is-numeric":F,"sort-by-asc":f(m).sortBy.asc,"sort-by-column":f(m).sortBy.column===t,sortable:re,width:ce,onSetSort:Kt=>f(m).setSort(t,F)},{default:i(()=>[n(r(L),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(d(!0),c(v,null,g($.value,t=>(d(),c("tr",{key:t.id},[e("th",Ze,r(t.id),1),e("td",et,[o(de,{to:{name:"Retailer.View",params:{id:t.id}}},{default:i(()=>[n(r(t.name),1)]),_:2},1032,["to"])]),e("td",tt,[e("span",{class:K(["badge",t.typeBgColor]),title:t.typeDescription,style:{"font-size":"0.8em"}},r(t.label),11,st)]),e("td",lt,r(t.customer),1),e("td",ot,r(t.city),1),e("td",null,[o(D,{"is-active":t.isDirect},null,8,["is-active"])]),e("td",null,[o(D,{"is-active":t.isActive},null,8,["is-active"])]),o(C,{id:t.id,intent:"view",onRunButtonHandler:te},{default:i(()=>[n("View ")]),_:2},1032,["id"]),x.value?(d(),c(v,{key:0},[o(C,{id:t.id,intent:"edit",onRunButtonHandler:ee},{default:i(()=>[n("Edit ")]),_:2},1032,["id"]),o(C,{id:t.id,intent:"delete",onRunButtonHandler:ae},{default:i(()=>[n("Delete ")]),_:2},1032,["id"])],64)):we("",!0)]))),128))])])])):(d(),c("p",it,r(f(_).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[n("Всего записей: "),e("span",at,r($.value.length),1)])])])])]),o(j,{id:"modalPopUp","close-func":se,"custom-classes":[""]},{title:i(()=>[s.isEditing?(d(),c("span",nt,[n("Редактирование торговой сети "),dt,e("b",null,r(s.retailer.name),1)])):(d(),c("span",rt,"Добавление торговой сети"))]),body:i(()=>[o(Ee),e("div",ct,[e("div",ut,[o(V,{for:"name",required:""},{default:i(()=>[n("Название торговой сети")]),_:1}),o(ge,{id:"name",modelValue:s.retailer.name,"onUpdate:modelValue":l[6]||(l[6]=t=>s.retailer.name=t),placeholder:"Например: Пятёрочка",type:"text"},null,8,["modelValue"])]),e("div",_t,[o(V,{for:"customer_id",required:""},{default:i(()=>[n("Контрагент")]),_:1}),h(e("select",{id:"customer_id","onUpdate:modelValue":l[7]||(l[7]=t=>s.retailer.customerId=t),class:"form-select"},[mt,(d(!0),c(v,null,g(s.customers,t=>(d(),c("option",{key:t.id,value:t.id},r(t.name),9,pt))),128))],512),[[T,s.retailer.customerId]])]),e("div",ht,[o(V,{for:"type",required:""},{default:i(()=>[n("Тип торговой сети")]),_:1}),h(e("select",{id:"type","onUpdate:modelValue":l[8]||(l[8]=t=>s.retailer.type=t),class:"form-select"},wt,512),[[T,s.retailer.type]])]),e("div",Et,[o(V,{for:"city_id",required:""},{default:i(()=>[n("Город")]),_:1}),h(e("select",{id:"city_id","onUpdate:modelValue":l[9]||(l[9]=t=>s.retailer.cityId=t),class:"form-select"},[gt,(d(!0),c(v,null,g(s.cities,t=>(d(),c("option",{key:t.id,value:t.id},r(t.name),9,Vt))),128))],512),[[T,s.retailer.cityId]])]),e("div",kt,[o(V,{for:"description"},{default:i(()=>[n("Описание для торговой сети")]),_:1}),h(e("textarea",{id:"description","onUpdate:modelValue":l[10]||(l[10]=t=>s.retailer.description=t),class:"form-control",placeholder:"Укажите произвольное описание"},null,512),[[Ve,s.retailer.description]])]),e("div",St,[e("div",Rt,[h(e("input",{id:"is-direct","onUpdate:modelValue":l[11]||(l[11]=t=>s.retailer.isDirect=t),checked:s.retailer.isDirect,class:"form-check-input",type:"checkbox"},null,8,It),[[O,s.retailer.isDirect]]),Dt])]),e("div",At,[e("div",Ut,[h(e("input",{id:"is-active","onUpdate:modelValue":l[12]||(l[12]=t=>s.retailer.isActive=t),checked:s.retailer.isActive,class:"form-check-input",type:"checkbox"},null,8,xt),[[O,s.retailer.isActive]]),$t])])])]),footer:i(()=>[o(q,{class:K([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:f(_).isButtonDisabled,loading:f(_).isButtonDisabled,type:"button",onClick:ie},{default:i(()=>[s.isEditing?(d(),c("span",Lt,"Сохранить")):(d(),c("span",Tt,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),o(j,{id:"viewModalPopUp","close-func":le,"custom-classes":["modal-lg","modal-dialog-scrollable"]},{title:i(()=>[n(" Просмотр торговой сети "),e("b",null,r(s.retailer.name),1)]),body:i(()=>[e("table",Bt,[e("tbody",null,[e("tr",null,[Ct,e("td",null,r(s.retailer.id),1)]),e("tr",null,[Mt,e("td",null,r(s.retailer.name),1)]),e("tr",null,[Ht,e("td",null,r(s.retailer.customer),1)]),e("tr",null,[Pt,e("td",null,r(s.retailer.city),1)]),e("tr",null,[Ft,e("td",null,[o(D,{"is-active":s.retailer.isDirect},null,8,["is-active"])])]),e("tr",null,[Nt,e("td",null,[o(D,{"is-active":s.retailer.isActive},null,8,["is-active"])])])])])]),footer:i(()=>[qt]),_:1})],64)}}};export{Zt as default};
