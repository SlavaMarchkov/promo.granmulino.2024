import{u as fe,a as ve,b as ge,d as f,r as G,y as ye,e as be,A as E,c,f as e,s as $,C as we,g as a,w as l,T as W,F as v,h as x,t as r,i as h,j as i,k as Ee,o as n,m as I,l as Ie,n as Ve,p as V,q as R,I as Pe,v as Se,x as ke,R as Y,Q as B,E as j,D as Ue,S as De,V as Re,W as Ae,X as Ce}from"./app-BPdZrYo3.js";import{u as Le}from"./useArrayHandlers-D3DGTb70.js";import{u as Te}from"./useHttpService-BNZ4gPHT.js";import{_ as $e}from"./TheCheckbox-CGFEuL4J.js";import{_ as xe}from"./SelectGroup-DoxylUzK.js";import{_ as Be,a as M}from"./TheFilter-BiC8Pmxx.js";import{_ as z}from"./TheBadge-DfL1MJO3.js";import{_ as Q}from"./Modal-BJimFcRn.js";import{_ as Me,a as A}from"./TdButton-DMXdDj8-.js";import{f as X}from"./formatters-hPmLyB9N.js";const Fe={class:"row mb-4"},Ne={class:"col-12"},Oe={class:"row mb-2"},He={class:"col-12"},qe={class:"col-md-4 mb-2"},Ke={class:"col-md-4 mb-2"},Ge={class:"col-md-4 mb-2"},We={class:"col-md-4 mb-2"},Ye={key:0,class:"col-md-4 mb-2"},je={class:"row mb-4"},ze={class:"col-12"},Qe={class:"card"},Xe={class:"card-body pb-0"},Je={key:0,class:"table-responsive"},Ze={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},et={scope:"row"},tt={class:"text-start"},st={class:"text-start"},ot={key:1,class:"mt-3 text-center lead"},at={class:"fw-bold"},lt={key:0},dt=e("br",null,null,-1),it={key:1},nt={class:"row g-3"},ct={class:"col-12"},rt={class:"col-6"},ut={key:0,class:"col-6"},mt={class:"col-12"},_t=e("option",{disabled:"",selected:"",value:""},"-- Выберите группу товара --",-1),pt=["value"],ht={class:"col-12"},ft={class:"form-check"},vt=["checked"],gt=e("label",{class:"form-check-label",for:"is-active"}," Продукт в продаже? ",-1),yt={class:"col-12"},bt=["src"],wt={key:0},Et={key:1},It={class:"table table-bordered mt-3 align-top text-wrap",style:{width:"100%"}},Vt=e("th",{style:{width:"40%"}},"ID",-1),Pt=e("th",null,"Название",-1),St=e("th",null,"Вес, г",-1),kt={key:0},Ut=e("th",null,"Себестоимость, руб.",-1),Dt=e("th",null,"Группа товаров",-1),Rt=e("th",null,"В продаже?",-1),At=e("th",null,"Картинка",-1),Ct=["src","alt"],Lt=e("span",null,null,-1),Wt={__name:"Index",setup(Tt){const P=fe(),C=ve(),J=ge(),m=Le(),{get:F,post:Z,update:ee,destroy:te}=Te(),N=J.getUser.role,L=f(()=>N===Y.SUPER_ADMIN),g=f(()=>N===Y.PRICE_ADMIN),se=f(()=>L.value?B.concat(j,Ue):g.value?B.concat(De,j):B),y=()=>({name:"",weight:"",price:"",categoryId:"",categoryName:"",image:"",isActive:!0}),s=G({products:[],categories:[],product:y(),isEditing:!1}),S=ye(null),u=G({name:"",weight:"",price:"",categoryId:"",isActive:!1});let p=null,b=null;function k(){s.isEditing=!1,s.product=y(),document.activeElement&&document.activeElement.blur()}be(async()=>{await U(),await oe(),p=new bootstrap.Modal(document.getElementById("modalPopUp")),p._element.addEventListener("hide.bs.modal",k)});const U=async()=>{const{data:d}=await F(E.PRODUCT,{params:{category:!0,is_active:!1}});s.products=d.products},O=d=>s.products.find(o=>o.id===d),oe=async()=>{const{data:d}=await F(E.CATEGORY,{params:{products:!1,product_is_active:!0}});s.categories=d.categories},ae=()=>{P.clear(),s.isEditing=!1,s.product=y(),p.show()},H=d=>{P.clear(),s.isEditing=!0,s.product=O(d),p.show()},le=d=>{b=new bootstrap.Modal(document.getElementById("viewModalPopUp")),s.product=O(d),b.show(),b._element.addEventListener("hide.bs.modal",k)},de=()=>{p.hide(),p._element.removeEventListener("hide.bs.modal",k)},ie=()=>{b.hide(),b._element.removeEventListener("hide.bs.modal",k)},ne=()=>{m.resetSearchKeys(u),m.resetSortKeys()},q=f(()=>s.product.image?`${Re}${s.product.image}`:[Ae]),ce=d=>{const o=d.target.files;if(!o.length){alert("Не выбран файл!");return}const t=o[0],D=t.name.toLowerCase();if(Ce.some(_=>D.endsWith(_))){const _=new FileReader;_.onerror=()=>alert(`Произошла ошибка при чтении файла: ${D}`),_.onloadend=()=>S.value.src=_.result,_.readAsDataURL(t)}else alert("Загружать можно только изображения")},re=()=>{s.isEditing?me():ue()},ue=async()=>{const d={...s.product,image:S.value.src},o=await Z(E.PRODUCT,d);o&&o.status==="success"&&(P.clear(),s.product=y(),p.hide(),m.resetSearchKeys(u),m.resetSortKeys("id",!1),await U())},me=async()=>{const d={...s.product},o=S.value.src;o.indexOf("base64")!==-1&&(d.image=d.image!==null&&o.includes(d.image.toString())?d.image.toString():o);const w=await ee(`${E.PRODUCT}/${d.id}`,d);w&&w.status==="success"&&(P.clear(),s.product=y(),p.hide(),await U())},_e=async d=>{if(confirm("Точно удалить продукт? Уверены?")){const{status:o}=await te(`${E.PRODUCT}/${d}`);o==="success"&&await U()}},pe=f(()=>m.sortArray(s.products)),T=f(()=>m.filterArray(pe.value,u));return(d,o)=>{const w=Ee("RouterLink");return n(),c(v,null,[e("div",Fe,[e("div",Ne,[$(a(W,{class:"btn-primary",onClick:ae},{default:l(()=>[i("Новый продукт ")]),_:1},512),[[we,L.value]])])]),e("div",Oe,[e("div",He,[a(Be,{onResetFilter:ne},{default:l(()=>[e("div",qe,[a(M,{modelValue:u.name,"onUpdate:modelValue":o[0]||(o[0]=t=>u.name=t),placeholder:"Поиск по названию"},{default:l(()=>[i("Продукт ")]),_:1},8,["modelValue"])]),e("div",Ke,[a(xe,{modelValue:u.categoryId,"onUpdate:modelValue":o[1]||(o[1]=t=>u.categoryId=t),chooseFrom:"-- Выберите группу товара --",items:s.categories},{default:l(()=>[i("Группа товара ")]),_:1},8,["modelValue","items"])]),e("div",Ge,[a($e,{id:"is_active",modelValue:u.isActive,"onUpdate:modelValue":o[2]||(o[2]=t=>u.isActive=t)},{default:l(()=>[i(" Продукт в продаже? ")]),_:1},8,["modelValue"])]),e("div",We,[a(M,{modelValue:u.weight,"onUpdate:modelValue":o[3]||(o[3]=t=>u.weight=t),placeholder:"Фильтр по макс. весу"},{default:l(()=>[i("Макс. вес ")]),_:1},8,["modelValue"])]),g.value?(n(),c("div",Ye,[a(M,{modelValue:u.price,"onUpdate:modelValue":o[4]||(o[4]=t=>u.price=t),placeholder:"Поиск по цене"},{default:l(()=>[i("Цена ")]),_:1},8,["modelValue"])])):I("",!0)]),_:1})])]),e("div",je,[e("div",ze,[e("div",Qe,[e("div",Xe,[T.value.length>0?(n(),c("div",Je,[e("table",Ze,[e("thead",null,[e("tr",null,[(n(!0),c(v,null,x(se.value,({column:t,label:D,sortable:K,is_num:_,width:he})=>(n(),Ie(Me,{key:t,column:t,"is-numeric":_,"sort-by-asc":h(m).sortBy.asc,"sort-by-column":h(m).sortBy.column===t,sortable:K,width:he,onSetSort:$t=>h(m).setSort(t,_)},{default:l(()=>[i(r(D),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),e("tbody",null,[(n(!0),c(v,null,x(T.value,t=>(n(),c("tr",{key:t.id},[e("th",et,r(t.id),1),e("td",tt,[a(w,{to:{name:"Product.View",params:{id:t.id}}},{default:l(()=>[i(r(t.name),1)]),_:2},1032,["to"])]),e("td",null,r(h(X)(t.weight)),1),e("td",st,r(t.categoryName),1),e("td",null,[a(z,{"is-active":t.isActive},null,8,["is-active"])]),a(A,{id:t.id,intent:"view",onRunButtonHandler:le},{default:l(()=>[i("View ")]),_:2},1032,["id"]),g.value?(n(),c(v,{key:0},[e("td",null,r(t.price),1),a(A,{id:t.id,intent:"edit",onRunButtonHandler:H},{default:l(()=>[i("Edit ")]),_:2},1032,["id"])],64)):I("",!0),L.value?(n(),c(v,{key:1},[a(A,{id:t.id,intent:"edit",onRunButtonHandler:H},{default:l(()=>[i("Edit ")]),_:2},1032,["id"]),a(A,{id:t.id,intent:"delete",onRunButtonHandler:_e},{default:l(()=>[i("Delete ")]),_:2},1032,["id"])],64)):I("",!0)]))),128))])])])):(n(),c("p",ot,r(h(C).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),e("p",null,[i("Всего записей: "),e("span",at,r(T.value.length),1)])])])])]),a(Q,{id:"modalPopUp","close-func":de,"custom-classes":[""]},{title:l(()=>[s.isEditing?(n(),c("span",lt,[i("Редактирование продукта "),dt,e("b",null,r(s.product.name),1)])):(n(),c("span",it,"Добавление продукта"))]),body:l(()=>[a(Ve),e("div",nt,[e("div",ct,[a(V,{for:"name",required:""},{default:l(()=>[i("Название продукта")]),_:1}),a(R,{id:"name",modelValue:s.product.name,"onUpdate:modelValue":o[5]||(o[5]=t=>s.product.name=t),placeholder:"Например: Бантики, 400 г",type:"text"},null,8,["modelValue"])]),e("div",rt,[a(V,{for:"weight",required:""},{default:l(()=>[i("Вес пачки, г")]),_:1}),a(R,{id:"weight",modelValue:s.product.weight,"onUpdate:modelValue":o[6]||(o[6]=t=>s.product.weight=t),max:"50000",min:"0",placeholder:"Например: 400",step:"50",type:"number"},null,8,["modelValue"])]),g.value?(n(),c("div",ut,[a(V,{for:"price",required:""},{default:l(()=>[i("Отпускная цена, руб.")]),_:1}),a(R,{id:"price",modelValue:s.product.price,"onUpdate:modelValue":o[7]||(o[7]=t=>s.product.price=t),max:"299.99",min:"0.00",placeholder:"Например: 36.99",step:"0.01",type:"number"},null,8,["modelValue"])])):I("",!0),e("div",mt,[a(V,{for:"category_id",required:""},{default:l(()=>[i("Группа товара")]),_:1}),$(e("select",{id:"category_id","onUpdate:modelValue":o[8]||(o[8]=t=>s.product.categoryId=t),class:"form-select"},[_t,(n(!0),c(v,null,x(s.categories,t=>(n(),c("option",{key:t.id,value:t.id},r(t.name),9,pt))),128))],512),[[Pe,s.product.categoryId]])]),e("div",ht,[e("div",ft,[$(e("input",{id:"is-active","onUpdate:modelValue":o[9]||(o[9]=t=>s.product.isActive=t),checked:s.product.isActive,class:"form-check-input",type:"checkbox"},null,8,vt),[[Se,s.product.isActive]]),gt])]),e("div",yt,[a(V,{for:"image"},{default:l(()=>[i("Изображение продукта")]),_:1}),a(R,{id:"image",type:"file",onChange:ce,accept:"image/*"}),e("img",{ref_key:"uploadedProductImageRef",ref:S,src:q.value,alt:"Изображение продукта",class:"img-thumbnail mt-3",width:"150"},null,8,bt)])])]),footer:l(()=>[a(W,{class:ke([s.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:h(C).isButtonDisabled,loading:h(C).isButtonDisabled,type:"button",onClick:re},{default:l(()=>[s.isEditing?(n(),c("span",wt,"Сохранить")):(n(),c("span",Et,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(Q,{id:"viewModalPopUp","close-func":ie,"custom-classes":["modal-dialog-scrollable"]},{title:l(()=>[i(" Просмотр продукта "),e("b",null,r(s.product.name),1)]),body:l(()=>[e("table",It,[e("tbody",null,[e("tr",null,[Vt,e("td",null,r(s.product.id),1)]),e("tr",null,[Pt,e("td",null,r(s.product.name),1)]),e("tr",null,[St,e("td",null,r(h(X)(s.product.weight)),1)]),g.value?(n(),c("tr",kt,[Ut,e("td",null,r(s.product.price),1)])):I("",!0),e("tr",null,[Dt,e("td",null,r(s.product.categoryName),1)]),e("tr",null,[Rt,e("td",null,[a(z,{"is-active":s.product.isActive},null,8,["is-active"])])]),e("tr",null,[At,e("td",null,[e("img",{src:q.value,alt:s.product.name,class:"img-thumbnail"},null,8,Ct)])])])])]),footer:l(()=>[Lt]),_:1})],64)}}};export{Wt as default};
