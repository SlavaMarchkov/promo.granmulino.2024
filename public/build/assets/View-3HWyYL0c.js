import{u as os,r as Y,d as y,o as v,c as w,g as o,w as a,f as s,t as d,j as n,i as _,T as Q,l as W,p,q as b,x as M,m as ss,F as A,s as I,M as L,a as as,y as J,e as ls,a1 as $,H as ns,h as cs,z as ds,B as rs,k as is,n as Z}from"./app-CcRn7-yu.js";import{u as us,a as ms}from"./useHttpService-F7Gi0evP.js";import{u as ts}from"./useArrayHandlers-HI3WadKX.js";import{T as _s}from"./TheSpinner-DbgObbVj.js";import{_ as ps,u as es}from"./TheModal-BP7wSSzT.js";import{f as r,i as T,c as P,p as E}from"./formatters-hPmLyB9N.js";import{_ as V,a as q}from"./TwoColumnRow-DboPzJPi.js";const fs={class:"mb-0"},gs={class:"mb-0 fw-bold text-primary"},bs=s("hr",null,null,-1),vs=s("hr",null,null,-1),hs=s("h4",{class:"mb-0"},"Редактирование акционного продукта",-1),xs={class:"fw-bold text-primary"},ys={class:"fw-bold text-primary"},$s=s("hr",null,null,-1),Ps={class:"row mb-3 g-3"},ws={class:"col-md-2"},ks={class:"input-group"},Vs=s("span",{class:"input-group-text"},"шт.",-1),Ms={class:"col-md-2"},Os={class:"input-group"},Us=s("span",{class:"input-group-text"},"шт.",-1),Ss={class:"col-md-2"},Ns={class:"input-group"},Cs=s("span",{class:"input-group-text"},"%",-1),Bs={class:"col-md-2"},Ds={class:"input-group"},Ts=s("span",{class:"input-group-text"},"шт.",-1),As={class:"col-md-2"},Rs={class:"input-group"},js=s("span",{class:"input-group-text"},"%",-1),Is={class:"col-md-2"},Ls={class:"input-group"},Es=s("span",{class:"input-group-text"},"%",-1),qs={class:"row g-3"},Fs={class:"col-md-2"},Hs={class:"input-group"},Ks=s("span",{class:"input-group-text"},"руб.",-1),zs={class:"col-md-2"},Gs={class:"input-group"},Js=s("span",{class:"input-group-text"},"руб.",-1),Qs={class:"col-md-2"},Ws={class:"input-group"},Xs=s("span",{class:"input-group-text"},"руб.",-1),Ys={class:"col-md-2"},Zs={class:"input-group"},st=s("span",{class:"input-group-text"},"руб.",-1),tt={class:"col-md-2"},et={class:"input-group"},ot=s("span",{class:"input-group-text"},"руб.",-1),at={class:"col-md-2"},lt={class:"input-group"},nt=s("span",{class:"input-group-text"},"руб.",-1),ct={__name:"PromoProductItem",props:{index:{type:Number,default:1},product:{type:Object,required:!0}},emits:["updateProductItem"],setup(f,{emit:N}){const{calcDifferencePercentage:O,calcBudget:u}=es(),C=os(),h=f,k=N,x=Y({editModalPopUp:!1}),g=()=>({id:h.product.id.toString(),salesBefore:r(h.product.salesBefore),salesPlan:r(h.product.salesPlan),salesOnTime:"",profitPerUnit:h.product.profitPerUnit,compensation:h.product.compensation,budgetPlan:r(h.product.budgetPlan),budgetActual:"",budgetDiff:"",promoProfit:""}),t=Y({form:g()}),m=()=>{C.clear(),x.editModalPopUp=!0,t.form=g()},R=()=>t.form.salesOnTime!=="",F=()=>{k("updateProductItem",H()),x.editModalPopUp=!1},H=()=>{const c={};return Object.keys(t.form).map(e=>c[e]=P(t.form[e])),c},B=y(()=>{const c=O(t.form.salesBefore,t.form.salesPlan);if(!isNaN(c))return r(c)}),j=y(()=>{const c=O(t.form.salesBefore,t.form.salesOnTime);if(!isNaN(c))return U(),r(c)}),D=y(()=>{let c=0;const e=B.value,l=j.value;let S,X;return e!==void 0&&l!==void 0&&(S=T(e)?-1*P(e):P(e),X=T(l)?-1*P(l):P(l),c=X-S),r(c)}),K=y(()=>T(D.value)?"bg-danger-subtle text-danger":D.value.toString()==="0"?"bg-warning-subtle text-black":"bg-success-subtle text-success"),U=()=>{t.form.budgetActual=r(u(t.form.salesOnTime,t.form.compensation)),z(),G()},z=()=>{const c=P(t.form.budgetPlan),e=P(t.form.budgetActual);t.form.budgetDiff=r(c-e)},G=()=>{const c=P(t.form.salesOnTime);t.form.promoProfit=r(t.form.profitPerUnit*c)},i=y(()=>{if(t.form.budgetDiff){const c=P(t.form.budgetDiff);return T(c)?"bg-success-subtle text-success":c===0?"bg-warning-subtle text-black":"bg-danger-subtle text-danger"}else return"bg-warning-subtle text-black"});return(c,e)=>(v(),w(A,null,[o(q,{"header-classes":["bg-secondary-subtle py-2 fw-bold text-black"],"with-footer":""},{header:a(()=>[s("h5",fs,d(f.product.categoryName),1)]),body:a(()=>[s("h5",gs,d(f.product.productName),1),bs,o(V,{title:'Продажи "До"'},{default:a(()=>[n(d(_(r)(f.product.salesBefore))+" шт.",1)]),_:1}),o(V,{title:"План"},{default:a(()=>[n(d(_(r)(f.product.salesPlan))+" шт.",1)]),_:1}),o(V,{title:"Прирост"},{default:a(()=>[n(d(_(r)(B.value))+" %",1)]),_:1}),o(V,{title:"Бюджет, план"},{default:a(()=>[n(d(_(r)(f.product.budgetPlan))+" руб.",1)]),_:1}),vs,o(V,{cols:"7",title:'Продажи "Во время"'},{default:a(()=>[n(d(_(r)(f.product.salesOnTime))+" шт.",1)]),_:1}),o(V,{title:"Бюджет, факт"},{default:a(()=>[n(d(_(r)(f.product.budgetActual))+" руб.",1)]),_:1}),o(V,{title:"Прибыль на SKU"},{default:a(()=>[n(d(_(r)(f.product.promoProfit))+" руб.",1)]),_:1})]),footer:a(()=>[o(Q,{class:"btn-warning w-100",onClick:m},{default:a(()=>[n("Редактировать ")]),_:1})]),_:1}),x.editModalPopUp?(v(),W(ps,{key:0,modelValue:x.editModalPopUp,"onUpdate:modelValue":e[13]||(e[13]=l=>x.editModalPopUp=l),id:"editModalPopUp","custom-classes":["modal-xl"]},{title:a(()=>[hs]),body:a(()=>[s("h5",null,[n("Группа товара: "),s("span",xs,d(f.product.categoryName),1)]),s("h5",null,[n("Продукт: "),s("span",ys,d(f.product.productName),1)]),$s,s("div",Ps,[s("div",ws,[o(p,{for:"sales_before"},{default:a(()=>[n('Продажи "До акции"')]),_:1}),s("div",ks,[o(b,{id:"sales_before",modelValue:t.form.salesBefore,"onUpdate:modelValue":e[0]||(e[0]=l=>t.form.salesBefore=l),type:"text",class:"text-end bg-warning-light",onBlur:e[1]||(e[1]=l=>_(E)(l.target.value,"sales_before"))},null,8,["modelValue"]),Vs])]),s("div",Ms,[o(p,{for:"sales_plan"},{default:a(()=>[n("План продаж")]),_:1}),s("div",Os,[o(b,{id:"sales_plan",modelValue:t.form.salesPlan,"onUpdate:modelValue":e[2]||(e[2]=l=>t.form.salesPlan=l),type:"text",class:"text-end bg-warning-light",onBlur:e[3]||(e[3]=l=>_(E)(l.target.value,"sales_plan"))},null,8,["modelValue"]),Us])]),s("div",Ss,[o(p,{for:"surplus_plan"},{default:a(()=>[n("План прироста")]),_:1}),s("div",Ns,[o(b,{id:"surplus_plan",type:"text","model-value":B.value,class:"text-end bg-warning-light",readonly:"readonly"},null,8,["model-value"]),Cs])]),s("div",Bs,[o(p,{for:"sales_on_time",required:""},{default:a(()=>[n('Продажи "Во время"')]),_:1}),s("div",Ds,[o(b,{id:"sales_on_time",modelValue:t.form.salesOnTime,"onUpdate:modelValue":e[4]||(e[4]=l=>t.form.salesOnTime=l),type:"text",class:"text-end",onBlur:e[5]||(e[5]=l=>_(E)(l.target.value,"sales_on_time"))},null,8,["modelValue"]),Ts])]),s("div",As,[o(p,{for:"surplus_actual"},{default:a(()=>[n("Факт прироста")]),_:1}),s("div",Rs,[o(b,{id:"surplus_actual",type:"text","model-value":j.value,class:"text-end bg-warning-light",readonly:"readonly"},null,8,["model-value"]),js])]),s("div",Is,[o(p,{for:"surplus_diff"},{default:a(()=>[n("Отклонение")]),_:1}),s("div",Ls,[o(b,{id:"surplus_diff",type:"text","model-value":D.value,class:M(["text-end fw-bold",K.value]),readonly:"readonly"},null,8,["model-value","class"]),Es])])]),s("div",qs,[s("div",Fs,[o(p,{for:"budget_plan"},{default:a(()=>[n("Бюджет, план")]),_:1}),s("div",Hs,[o(b,{id:"budget_plan",modelValue:t.form.budgetPlan,"onUpdate:modelValue":e[6]||(e[6]=l=>t.form.budgetPlan=l),type:"text",class:"text-end bg-warning-light",onBlur:e[7]||(e[7]=l=>_(E)(l.target.value,"budget_plan"))},null,8,["modelValue"]),Ks])]),s("div",zs,[o(p,{for:"budget_actual"},{default:a(()=>[n("Бюджет, факт")]),_:1}),s("div",Gs,[o(b,{id:"budget_actual",type:"text",modelValue:t.form.budgetActual,"onUpdate:modelValue":e[8]||(e[8]=l=>t.form.budgetActual=l),class:"text-end bg-warning-light",readonly:"readonly"},null,8,["modelValue"]),Js])]),s("div",Qs,[o(p,{for:"budget_diff"},{default:a(()=>[n("Бюджет, план - факт")]),_:1}),s("div",Ws,[o(b,{id:"budget_diff",type:"text",modelValue:t.form.budgetDiff,"onUpdate:modelValue":e[9]||(e[9]=l=>t.form.budgetDiff=l),class:M(["text-end fw-bold",i.value]),readonly:"readonly"},null,8,["modelValue","class"]),Xs])]),s("div",Ys,[o(p,{for:"compensation"},{default:a(()=>[n("Компенсация на 1 шт.")]),_:1}),s("div",Zs,[o(b,{id:"compensation",modelValue:t.form.compensation,"onUpdate:modelValue":e[10]||(e[10]=l=>t.form.compensation=l),type:"text",class:"text-end bg-warning-light"},null,8,["modelValue"]),st])]),s("div",tt,[o(p,{for:"profit_per_unit",required:""},{default:a(()=>[n("Прибыль на 1 шт.")]),_:1}),s("div",et,[o(b,{id:"profit_per_unit",modelValue:t.form.profitPerUnit,"onUpdate:modelValue":e[11]||(e[11]=l=>t.form.profitPerUnit=l),type:"text",class:"text-end bg-warning-light"},null,8,["modelValue"]),ot])]),s("div",at,[o(p,{for:"total_profit",required:""},{default:a(()=>[n("Прибыль на SKU")]),_:1}),s("div",lt,[o(b,{id:"total_profit",modelValue:t.form.promoProfit,"onUpdate:modelValue":e[12]||(e[12]=l=>t.form.promoProfit=l),type:"text",class:"text-end bg-warning-light"},null,8,["modelValue"]),nt])])])]),footer:a(()=>[o(Q,{class:M(["btn-warning w-25",{"btn-cursor-not-allowed":!R()}]),disabled:!R(),type:"button",onClick:F},{default:a(()=>[n("Сохранить изменения")]),_:1},8,["class","disabled"])]),_:1},8,["modelValue"])):ss("",!0)],64))}},dt={class:"row mb-4"},rt={class:"col-3"},it={class:"fw-bold fs-5"},ut={class:"col-3"},mt={class:"fw-bold fs-5"},_t={class:"col-3"},pt={class:"fw-bold fs-5"},ft={class:"col-3 text-center"},gt={class:"row"},bt={class:"col-6"},vt={class:"form-floating"},ht=s("label",{for:"promo_comments"},"Выводы по промо-акции",-1),xt={class:"col-6 align-content-center"},yt={__name:"PromoMark",props:{mark:{type:Object,required:!0}},emits:["updatePromoMark"],setup(f,{emit:N}){const{getAverageOfArray:O}=ts(),u=f,C=N,h=()=>{const g={sales:u.mark.sales,goals:u.mark.goals,staff:u.mark.staff};return Array.from(Object.entries(g),([t,m])=>m)},k=y(()=>{const g=h();return O(g)}),x=()=>{C("updatePromoMark",u.mark)};return(g,t)=>(v(),w(A,null,[s("div",dt,[s("div",rt,[o(p,{for:"promo_goals"},{default:a(()=>[n("Цель промо-акции: "),s("span",it,d(u.mark.goals),1)]),_:1}),I(s("input",{id:"promo_goals","onUpdate:modelValue":t[0]||(t[0]=m=>u.mark.goals=m),class:"form-range",max:"5",min:"0",step:"0.5",type:"range"},null,512),[[L,u.mark.goals]])]),s("div",ut,[o(p,{for:"promo_sales"},{default:a(()=>[n("Продажи: "),s("span",mt,d(u.mark.sales),1)]),_:1}),I(s("input",{id:"promo_sales","onUpdate:modelValue":t[1]||(t[1]=m=>u.mark.sales=m),class:"form-range",max:"5",min:"0",step:"0.5",type:"range"},null,512),[[L,u.mark.sales]])]),s("div",_t,[o(p,{for:"promo_staff"},{default:a(()=>[n("Участие персонала: "),s("span",pt,d(u.mark.staff),1)]),_:1}),I(s("input",{id:"promo_staff","onUpdate:modelValue":t[2]||(t[2]=m=>u.mark.staff=m),class:"form-range",max:"5",min:"0",step:"0.5",type:"range"},null,512),[[L,u.mark.staff]])]),s("div",ft,[o(p,{for:"total_promo_mark"},{default:a(()=>[n("Средняя оценка")]),_:1}),o(b,{id:"total_promo_mark","model-value":k.value,class:"text-center w-50 mx-auto fw-bold"},null,8,["model-value"])])]),s("div",gt,[s("div",bt,[s("div",vt,[I(s("textarea",{id:"promo_comments","onUpdate:modelValue":t[3]||(t[3]=m=>u.mark.comments=m),class:"form-control border border-dark",placeholder:"Укажите здесь свои выводы по промо-акции",style:{height:"60px"}},null,512),[[L,u.mark.comments]]),ht])]),s("div",xt,[o(Q,{class:"btn-primary",onClick:x},{default:a(()=>[n("Сохранить оценку и выводы ")]),_:1})])])],64))}},$t={key:0,class:"row"},Pt={class:"col-12"},wt={class:"my-4"},kt={key:0,class:"row promo-view"},Vt={class:"col-12"},Mt={class:"card"},Ot={class:"card-header bg-light d-flex justify-content-between align-items-center"},Ut={class:"mb-0"},St={class:"text-secondary fs-5"},Nt={class:"mb-0"},Ct={class:"mb-0"},Bt={class:"card-body mt-2 g-3"},Dt={class:"row mb-2"},Tt={class:"col-4"},At={class:"mb-0 alert border-primary"},Rt={class:"mb-0 text-secondary"},jt={class:"fw-bold text-accent"},It={class:"col-4"},Lt={class:"mb-0 alert border-success",role:"alert"},Et={class:"mb-0 text-secondary"},qt={class:"fw-bold text-accent"},Ft={class:"col-4"},Ht={class:"mb-0 alert border-info",role:"alert"},Kt={class:"mb-0 text-secondary"},zt={class:"fw-bold text-accent"},Gt={class:"row"},Jt={class:"col-4"},Qt=s("h5",{class:"mb-0 card-title p-0"},"Бюджет",-1),Wt={class:"d-flex align-items-center"},Xt=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-currency-dollar"})],-1),Yt={class:"ps-3"},Zt={class:"text-success small pt-1 fw-bold"},se=s("span",{class:"text-muted small pt-2 ps-1"}," | план",-1),te={class:"col-4"},ee=s("h5",{class:"mb-0 card-title p-0"},"Продажи",-1),oe={class:"d-flex align-items-center"},ae=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-cart"})],-1),le={class:"ps-3"},ne={class:"text-success small pt-1 fw-bold"},ce=s("span",{class:"text-muted small pt-2 ps-1"}," | план",-1),de={class:"col-4"},re=s("h5",{class:"mb-0 card-title p-0"},"Общая прибыль",-1),ie={class:"d-flex align-items-center"},ue=s("div",{class:"card-icon rounded-circle d-flex align-items-center justify-content-center"},[s("i",{class:"bi bi-cash-stack"})],-1),me={class:"ps-3"},_e={class:"card-footer"},pe={id:"promoDetails",class:"accordion"},fe={class:"accordion-item"},ge=s("h2",{id:"promoComments",class:"accordion-header"},[s("button",{"aria-controls":"collapsePromoComments","aria-expanded":"false",class:"accordion-button collapsed","data-bs-target":"#collapsePromoComments","data-bs-toggle":"collapse",type:"button"},[s("span",{class:"card-title p-0 m-0"},"Механика промо-акции")])],-1),be={id:"collapsePromoComments","aria-labelledby":"promoComments",class:"accordion-collapse collapse","data-bs-parent":"#promoDetails"},ve={class:"accordion-body"},he={class:"accordion-item"},xe=s("h2",{id:"promoMark",class:"accordion-header"},[s("button",{"aria-controls":"collapsePromoMark","aria-expanded":"false",class:"accordion-button collapsed","data-bs-target":"#collapsePromoMark","data-bs-toggle":"collapse",type:"button"},[s("span",{class:"card-title p-0 m-0"},"Оценки промо-акции")])],-1),ye={id:"collapsePromoMark","aria-labelledby":"promoMark",class:"accordion-collapse collapse","data-bs-parent":"#promoDetails"},$e={class:"accordion-body"},Pe={key:0,class:"col-12"},we={class:"card"},ke=s("div",{class:"card-header"},[s("h4",{class:"mb-0"},"Акционная продукция")],-1),Ve={class:"card-body mt-3"},Me={class:"row"},Oe={class:"col-12"},Ue={class:"row row-cols-xl-4 row-cols-lg-3 row-cols-md-3 row-cols-sm-2 row-cols-1 g-3"},Se=s("hr",null,null,-1),je={__name:"View",setup(f){const N=ds();rs();const O=as();ts();const{makeConvertibleObject:u,toCamel:C}=ms(),{calcDifferencePercentage:h}=es(),{get:k,update:x}=us(),g=+N.params.id,t=J({}),m=J([]),R=J([]);ls(async()=>{await H(g)});const F=y(()=>Object.keys(t.value).length!==0),H=async i=>{const{status:c,data:e}=await k(`${$.PROMO}/${i}`);c==="success"&&(t.value=e)};ns(()=>t.value.promoType,i=>{switch(i){case"DISCOUNT":B(g);break;case"SALES_PEOPLE_BOOST":j(g);break}});const B=async i=>{const{status:c,data:e}=await k(`${$.PROMO}/${i}${$.PRODUCT}`,{params:{category:!0,product:!0}});c==="success"&&(m.value=e)},j=async i=>{const{status:c,data:e}=await k(`${$.PROMO}/${i}${$.SELLER}`);c==="success"&&(R.value=e)},D=async i=>{const c=await x(`${$.PROMO}/${g}${$.PRODUCT}/${i.id}`,i);if(c&&c.status==="success"){const e=u(JSON.parse(c.data),C),l=m.value.findIndex(S=>S.id===i.id);m.value[l]={...m.value[l],...e.product},t.value={...t.value,...e.promo}}},K=async i=>{const c=await x(`${$.PROMO}/${g}${$.MARK}/${i.id}`,i);c&&c.status==="success"&&(t.value={...c.data})},U=y(()=>{const i=h(t.value.totalSalesPlan,t.value.totalSalesOnTime);if(!isNaN(i))return r(i)}),z=y(()=>T(U.value)?"text-danger":U.value===0?"text-secondary":"text-success"),G=y(()=>t.value.totalMark>0&&t.value.totalMark<=3?"bg-danger":t.value.totalMark>3&&t.value.totalMark<=5?"bg-success":"bg-secondary");return(i,c)=>{const e=is("RouterLink");return v(),w(A,null,[_(O).isLoading?(v(),w("div",$t,[s("div",Pt,[s("h4",wt,[o(_s)])])])):(v(),w(A,{key:1},[F.value?(v(),w("div",kt,[s("div",Vt,[s("div",Mt,[s("div",Ot,[s("h3",Ut,[n(d(t.value.promoCode)+d(t.value.discount!==null?`-${t.value.discount}`:"")+" ",1),s("span",St,"| "+d(t.value.channelName),1)]),s("h4",Nt,[s("span",{class:M(["badge",t.value.statusColor])},d(t.value.statusLabel),3)]),s("h2",Ct,[s("span",{class:M(["badge",G.value])},d(t.value.totalMark),3)])]),s("div",Bt,[s("div",Dt,[s("div",Tt,[s("div",At,[s("h5",Rt,[n("Дистрибутор: "),s("span",jt,d(t.value.customerName),1)])])]),s("div",It,[s("div",Lt,[s("h5",Et,[n("Сеть: "),s("span",qt,d(t.value.retailerName),1)])])]),s("div",Ft,[s("div",Ht,[s("h5",Kt,[n("Период: "),s("span",zt,d(t.value.startDate)+" - "+d(t.value.endDate),1)])])])]),s("div",Gt,[s("div",Jt,[o(q,{class:"info-card revenue-card"},{header:a(()=>[Qt]),body:a(()=>[s("div",Wt,[Xt,s("div",Yt,[s("h6",null,d(_(r)(t.value.totalBudgetActual))+" ₽",1),s("span",Zt,d(_(r)(t.value.totalBudgetPlan))+" ₽",1),se])])]),_:1})]),s("div",te,[o(q,{class:"info-card sales-card"},{header:a(()=>[ee,s("h5",{class:M(["mb-0 fw-bold",z.value])},[s("i",{class:M(["bi",U.value>=0?"bi-arrow-up":"bi-arrow-down"])},null,2),n(" "+d(U.value)+" %",1)],2)]),body:a(()=>[s("div",oe,[ae,s("div",le,[s("h6",null,d(_(r)(t.value.totalSalesOnTime))+" шт.",1),s("span",ne,d(_(r)(t.value.totalSalesPlan))+" шт.",1),n(),ce])])]),_:1})]),s("div",de,[o(q,{class:"info-card profit-card"},{header:a(()=>[re]),body:a(()=>[s("div",ie,[ue,s("div",me,[s("h6",null,d(_(r)(t.value.totalPromoProfit))+" ₽",1)])])]),_:1})])])]),s("div",_e,[s("div",pe,[s("div",fe,[ge,s("div",be,[s("div",ve,d(t.value.comments),1)])]),s("div",he,[xe,s("div",ye,[s("div",$e,[o(yt,{mark:t.value.mark,onUpdatePromoMark:K},null,8,["mark"])])])])])])])]),m.value.length>0?(v(),w("div",Pe,[s("div",we,[ke,s("div",Ve,[s("div",Me,[s("div",Oe,[o(Z)])]),s("div",Ue,[(v(!0),w(A,null,cs(m.value,(l,S)=>(v(),W(ct,{key:l.id,index:S,product:l,onUpdateProductItem:D},null,8,["index","product"]))),128))])])])])):ss("",!0)])):(v(),W(Z,{key:1,class:"mt-3"}))],64)),Se,o(e,{to:{name:"Manager.Promo.Index"},class:"btn btn-secondary my-2",role:"button"},{default:a(()=>[n("Обратно на Мои Промо-акции ")]),_:1})],64)}}};export{je as default};
