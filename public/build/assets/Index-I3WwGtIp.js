import{u as nt,a as it,b as dt,d as x,r as $,e as rt,A as g,c,f as t,t as i,s as A,y as ct,g as a,w as l,T as P,F as b,h as B,i as p,j as d,k as ut,o as r,l as _t,m as mt,n as yt,p as h,q as w,I as pt,x as ht,R as ft,J as H,E as vt,D as gt,O as bt,K as wt}from"./app-LDVDDXIB.js";import{u as Et}from"./useHttpService-H3Bhthf8.js";import{u as Vt}from"./useArrayHandlers-JXOu8LuP.js";import{_ as R}from"./InputGroup-DFOwqnPq.js";import{_ as St}from"./TheFilter-Bt1ein-f.js";import{_ as M}from"./Modal-Buqgi5Td.js";import{_ as It,a as L}from"./TdButton-Cll3J42i.js";const xt={class:"row mb-4"},Ct={class:"col-6"},Ut={class:"mb-0"},kt={class:"col-6 text-end"},Bt={class:"row mb-4"},Rt={class:"col-12"},Lt={class:"col-md-4 mb-2"},Dt={class:"col-md-4 mb-2"},Nt={class:"col-md-4 mb-2"},Tt={class:"row mb-4"},$t={class:"col-12"},At={class:"card"},Pt={class:"card-body pb-0"},Ht={key:0,class:"table-responsive"},Mt={class:"table table-bordered my-4 text-center align-middle text-nowrap",style:{width:"100%"}},Ft={scope:"row"},Kt={class:"text-start"},Ot={class:"text-start"},Yt={class:"text-start"},qt={class:"text-start"},jt={class:"text-start"},Wt={key:1,class:"mt-3 text-center lead"},zt={class:"fw-bold"},Gt={key:0},Jt={key:1},Qt={class:"row g-3"},Xt={class:"col-12"},Zt={class:"col-6"},te={class:"col-6"},ee={class:"col-6"},se={class:"col-6"},oe={class:"col-12"},ae=t("option",{disabled:"",selected:"",value:""},"-- Выберите регион --",-1),le=["value"],ne={key:0},ie={key:1},de={class:"table table-bordered mt-3 align-middle text-wrap",style:{width:"100%"}},re=t("th",{style:{width:"30%"}},"ID",-1),ce=t("th",null,"Название",-1),ue=t("th",null,"Регион",-1),_e=t("th",null,"Широта",-1),me=t("th",null,"Долгота",-1),ye=t("th",null,"Страна",-1),pe=t("th",null,"Локация",-1),he=t("span",null,null,-1),xe={__name:"Index",setup(fe){const E=nt(),C=it(),F=dt(),u=Vt(),{get:D,post:K,update:O,destroy:Y}=Et(),q=F.getUser.role,U=x(()=>q===ft.SUPER_ADMIN),j=x(()=>U.value?H.concat(vt,gt):H),V=()=>({name:"",regionId:"",longitude:"",latitude:"",country:"",state:""}),e=$({cities:[],regions:[],city:V(),isEditing:!1}),_=$({name:"",state:"",regionName:""});let m=null,f=null;function S(){e.isEditing=!1,e.city=V(),document.activeElement&&document.activeElement.blur()}rt(async()=>{await I(),await W(),m=new bootstrap.Modal(document.getElementById("modalPopUp")),m._element.addEventListener("hide.bs.modal",S)});const I=async()=>{const{data:n}=await D(g.CITY);e.cities=n.cities},N=n=>e.cities.find(o=>o.id===n),W=async()=>{const{data:n}=await D(g.REGION);e.regions=n.regions},z=()=>{E.clear(),e.isEditing=!1,e.city=V(),m.show()},G=n=>{E.clear(),e.isEditing=!0,e.city=N(n),m.show()},J=n=>{f=new bootstrap.Modal(document.getElementById("viewModalPopUp")),e.city=N(n),f.show(),f._element.addEventListener("hide.bs.modal",S)},Q=()=>{m.hide(),m._element.removeEventListener("hide.bs.modal",S)},X=()=>{f.hide(),f._element.removeEventListener("hide.bs.modal",S)},Z=()=>{u.resetSearchKeys(_),u.resetSortKeys()},tt=async()=>{if(e.isEditing){const n=await O(`${g.CITY}/${e.city.id}`,e.city);n&&n.status==="success"&&(E.clear(),m.hide(),await I())}else{const n=await K(g.CITY,e.city);n&&n.status==="success"&&(E.clear(),e.city=V(),m.hide(),u.resetSearchKeys(_),u.resetSortKeys("id",!1),await I())}},et=async n=>{if(confirm("Точно удалить город? Уверены?")){const o=await Y(`${g.CITY}/${n}`);o&&o.status==="success"&&await I()}},st=x(()=>u.sortArray(e.cities)),k=x(()=>u.filterArray(st.value,_)),ot=async n=>{const o=new URL(bt);o.searchParams.set("q",n),o.searchParams.set("appid",wt);try{const y=(await(await fetch(o.toString())).json())[0];e.city.latitude=y.lat,e.city.longitude=y.lon,e.city.country=y.country,e.city.state=y.state}catch(v){alert("Error: "+v.message)}};return(n,o)=>{const v=ut("RouterLink");return r(),c(b,null,[t("div",xt,[t("div",Ct,[t("h3",Ut,i(n.$route.meta.title),1)]),A(t("div",kt,[a(P,{class:"btn-primary",onClick:z},{default:l(()=>[d("Новый город ")]),_:1})],512),[[ct,U.value]])]),t("div",Bt,[t("div",Rt,[a(St,{onResetFilter:Z},{default:l(()=>[t("div",Lt,[a(R,{modelValue:_.name,"onUpdate:modelValue":o[0]||(o[0]=s=>_.name=s),placeholder:"Поиск по названию города"},{default:l(()=>[d("Город ")]),_:1},8,["modelValue"])]),t("div",Dt,[a(R,{modelValue:_.state,"onUpdate:modelValue":o[1]||(o[1]=s=>_.state=s),placeholder:"Поиск по локации (EN)"},{default:l(()=>[d("Локация ")]),_:1},8,["modelValue"])]),t("div",Nt,[a(R,{modelValue:_.regionName,"onUpdate:modelValue":o[2]||(o[2]=s=>_.regionName=s),placeholder:"Поиск по названию региона"},{default:l(()=>[d("Регион ")]),_:1},8,["modelValue"])])]),_:1})])]),t("div",Tt,[t("div",$t,[t("div",At,[t("div",Pt,[k.value.length>0?(r(),c("div",Ht,[t("table",Mt,[t("thead",null,[t("tr",null,[(r(!0),c(b,null,B(j.value,({column:s,label:y,sortable:at,is_num:T,width:lt})=>(r(),_t(It,{key:s,column:s,"is-numeric":T,"sort-by-asc":p(u).sortBy.asc,"sort-by-column":p(u).sortBy.column===s,sortable:at,width:lt,onSetSort:ve=>p(u).setSort(s,T)},{default:l(()=>[d(i(y),1)]),_:2},1032,["column","is-numeric","sort-by-asc","sort-by-column","sortable","width","onSetSort"]))),128))])]),t("tbody",null,[(r(!0),c(b,null,B(k.value,s=>(r(),c("tr",{key:s.id},[t("th",Ft,i(s.id),1),t("td",Kt,[a(v,{to:{name:"City.View",params:{id:s.id}}},{default:l(()=>[d(i(s.name),1)]),_:2},1032,["to"])]),t("td",Ot,i(s.latitude),1),t("td",Yt,i(s.longitude),1),t("td",qt,i(s.state),1),t("td",jt,[a(v,{to:{name:"Region.View",params:{id:s.regionId}}},{default:l(()=>[d(i(s.regionName),1)]),_:2},1032,["to"])]),a(L,{id:s.id,intent:"view",onRunButtonHandler:J},{default:l(()=>[d("View ")]),_:2},1032,["id"]),U.value?(r(),c(b,{key:0},[a(L,{id:s.id,intent:"edit",onRunButtonHandler:G},{default:l(()=>[d("Edit ")]),_:2},1032,["id"]),a(L,{id:s.id,intent:"delete",onRunButtonHandler:et},{default:l(()=>[d("Delete ")]),_:2},1032,["id"])],64)):mt("",!0)]))),128))])])])):(r(),c("p",Wt,i(p(C).isLoading?"Подождите, загружаю...":"Записей не найдено..."),1)),t("p",null,[d("Всего записей: "),t("span",zt,i(k.value.length),1)])])])])]),a(M,{id:"modalPopUp","close-func":Q,"custom-classes":[""]},{title:l(()=>[e.isEditing?(r(),c("span",Gt,[d("Редактирование города "),t("b",null,i(e.city.name),1)])):(r(),c("span",Jt,"Добавление города"))]),body:l(()=>[a(yt),t("div",Qt,[t("div",Xt,[a(h,{for:"name",required:""},{default:l(()=>[d("Наименование города")]),_:1}),a(w,{id:"name",modelValue:e.city.name,"onUpdate:modelValue":o[3]||(o[3]=s=>e.city.name=s),onBlur:o[4]||(o[4]=s=>ot(e.city.name)),placeholder:"Например: Новосибирск",type:"text"},null,8,["modelValue"])]),t("div",Zt,[a(h,{for:"latitude"},{default:l(()=>[d("Геокоординаты. Широта")]),_:1}),a(w,{id:"latitude",modelValue:e.city.latitude,"onUpdate:modelValue":o[5]||(o[5]=s=>e.city.latitude=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",te,[a(h,{for:"longitude"},{default:l(()=>[d("Геокоординаты. Долгота")]),_:1}),a(w,{id:"longitude",modelValue:e.city.longitude,"onUpdate:modelValue":o[6]||(o[6]=s=>e.city.longitude=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",ee,[a(h,{for:"country"},{default:l(()=>[d("Страна")]),_:1}),a(w,{id:"country",modelValue:e.city.country,"onUpdate:modelValue":o[7]||(o[7]=s=>e.city.country=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",se,[a(h,{for:"state"},{default:l(()=>[d("Локация")]),_:1}),a(w,{id:"state",modelValue:e.city.state,"onUpdate:modelValue":o[8]||(o[8]=s=>e.city.state=s),type:"text",readonly:"readonly"},null,8,["modelValue"])]),t("div",oe,[a(h,{for:"region_id",required:""},{default:l(()=>[d("Регион")]),_:1}),A(t("select",{id:"region_id","onUpdate:modelValue":o[9]||(o[9]=s=>e.city.regionId=s),class:"form-select"},[ae,(r(!0),c(b,null,B(e.regions,s=>(r(),c("option",{key:s.id,value:s.id},i(s.name),9,le))),128))],512),[[pt,e.city.regionId]])])])]),footer:l(()=>[a(P,{class:ht([e.isEditing?"btn-warning":"btn-primary","w-25"]),disabled:p(C).isButtonDisabled,loading:p(C).isButtonDisabled,onClick:tt},{default:l(()=>[e.isEditing?(r(),c("span",ne,"Сохранить")):(r(),c("span",ie,"Создать"))]),_:1},8,["class","disabled","loading"])]),_:1}),a(M,{id:"viewModalPopUp","close-func":X,"custom-classes":["modal-dialog-scrollable"]},{title:l(()=>[d(" Просмотр города "),t("b",null,i(e.city.name),1)]),body:l(()=>[t("table",de,[t("tbody",null,[t("tr",null,[re,t("td",null,i(e.city.id),1)]),t("tr",null,[ce,t("td",null,i(e.city.name),1)]),t("tr",null,[ue,t("td",null,i(e.city.regionName),1)]),t("tr",null,[_e,t("td",null,i(e.city.latitude),1)]),t("tr",null,[me,t("td",null,i(e.city.longitude),1)]),t("tr",null,[ye,t("td",null,i(e.city.country),1)]),t("tr",null,[pe,t("td",null,i(e.city.state),1)])])])]),footer:l(()=>[he]),_:1})],64)}}};export{xe as default};
