import{o as m,c as p,f as t,g as f,x as T,q as b,i as B,a8 as R,w as j,T as D,a9 as C,r as L,d as P,aa as O,t as I,F as S,h as V,l as F,m as U,G as M,k as G,j as x,N as H,Y as Q}from"./app-CvDqXEOd.js";import{u as z}from"./useHttpService-Cv4QBHm9.js";import{u as W}from"./useArrayHandlers-Dmi2z74m.js";import{c as w,f as $,b as A}from"./formatters-CphxWokN.js";const Y={class:"list-group-item m-0 px-2"},J={class:"row g-2"},K={class:"col-md-5 col-sm-12"},X={class:"col-md-2 col-sm-6"},Z={class:"col-md-2 col-sm-6"},ee={class:"col-md-2 col-sm-6"},se={class:"col-md-1 col-sm-6 text-center"},le=t("i",{class:"bi-x-lg"},null,-1),q={__name:"SalesPeopleSellerItem",props:{seller:{type:Object,required:!0},index:{type:Number,default:1}},emits:["addSeller"],setup(v,{emit:E}){const d=v,g=E,_=(o,e)=>{let s=d.seller;const u=document.getElementById(`${e}_salesBefore`),a=document.getElementById(`${e}_surplusPlan`),l=document.getElementById(`${e}_salesPlan`);let r=w(o.target.value),n,c,h;isNaN(r)?(n=0,c=0,h=0,u.value="",a.value="",l.value="",a.setAttribute("readonly","readonly"),l.setAttribute("readonly","readonly")):r===0?(r=0,n=0,c=0,h=0,a.value=n,l.value=c,a.setAttribute("readonly","readonly"),l.removeAttribute("readonly")):(n=a.value===""?R:w(a.value),c=+(r+r*n/100).toFixed(2),h=y(c),u.value=$(r),l.value=A(c),l.setAttribute("readonly","readonly"),a.removeAttribute("readonly"),a.value=n),s.sellerId=s.id,s.salesBefore=r,s.surplusPlan=n,s.salesPlan=c,s.budgetPlan=h,g("addSeller",s)},N=(o,e)=>{let s=d.seller;const u=document.getElementById(`${e}_salesBefore`),a=document.getElementById(`${e}_surplusPlan`),l=document.getElementById(`${e}_salesPlan`);let r=w(u.value),n=w(o.target.value),c,h;isNaN(n)&&(n=0,a.value=n),c=+(r+r*n/100).toFixed(2),h=y(c),a.value=$(n),l.value=A(c),s.sellerId=s.id,s.salesBefore=r,s.surplusPlan=n,s.salesPlan=c,s.budgetPlan=h,g("addSeller",s)},i=(o,e)=>{let s=d.seller;const u=document.getElementById(`${e}_salesPlan`);let a=w(o.target.value),l=0,r=0,n;isNaN(a)?(a=0,u.value=a):(n=y(a),a=+a.toFixed(2),u.value=$(a)),s.salesBefore=l,s.surplusPlan=r,s.salesPlan=a,s.budgetPlan=n,g("addSeller",s)},y=o=>+(o*C/100).toFixed(2),k=o=>{let e=d.seller;const s=document.getElementById(`${o}_salesBefore`),u=document.getElementById(`${o}_surplusPlan`),a=document.getElementById(`${o}_salesPlan`);s.value="",u.value="",a.value="",u.setAttribute("readonly","readonly"),a.setAttribute("readonly","readonly"),e.salesBefore=0,e.surplusPlan=0,e.salesPlan=0,e.budgetPlan=0,g("addSeller",e)};return(o,e)=>(m(),p("li",Y,[t("div",J,[t("div",K,[f(b,{value:d.seller.shortName,class:T({"border-danger":!d.seller.supervisorId}),readonly:""},null,8,["value","class"])]),t("div",X,[f(b,{id:`${v.index}_salesBefore`,class:T(["text-end",{"border-danger":!d.seller.supervisorId}]),onInput:e[0]||(e[0]=s=>_(s,v.index))},null,8,["id","class"])]),t("div",Z,[f(b,{id:`${v.index}_surplusPlan`,class:T(["text-end",{"border-danger":!d.seller.supervisorId}]),"model-value":B(R),onInput:e[1]||(e[1]=s=>N(s,v.index)),maxlength:"3",readonly:"readonly"},null,8,["id","class","model-value"])]),t("div",ee,[f(b,{id:`${v.index}_salesPlan`,class:T(["text-end",{"border-danger":!d.seller.supervisorId}]),onInput:e[2]||(e[2]=s=>i(s,v.index)),readonly:"readonly"},null,8,["id","class"])]),t("div",se,[f(D,{class:"btn-outline-danger",onClick:e[3]||(e[3]=s=>k(v.index))},{default:j(()=>[le]),_:1})])])]))}},te={class:"list-group-item m-0 px-2"},ae={class:"row g-2"},re={class:"col-md-5 col-sm-12"},oe={class:"input-group"},ne={class:"input-group-text"},de=["value"],ie={class:"col-md-2 col-sm-6"},ce={class:"col-md-2 col-sm-6"},ue={class:"col-md-2 col-sm-6"},me=t("div",{class:"col-md-1 col-sm-6 text-center"},null,-1),ve={__name:"SalesPeopleSupervisorItem",props:{supervisor:{type:Object,required:!0},index:{type:Number,default:1},sellers:{type:Array,required:!0,default:()=>[]}},emits:["addToCheckedSellers"],setup(v,{emit:E}){const d=v,g=E,_=L({sellers:[]}),N=o=>{g("addToCheckedSellers",o);let e=d.supervisor;const s=_.sellers.findIndex(l=>l.id===o.id);s===-1?_.sellers.push(o):_.sellers[s]={...o};const u=document.getElementById(`${d.supervisor.id}_SV_salesBefore`),a=document.getElementById(`${d.supervisor.id}_SV_salesPlan`);u.value=i.value===0?"":$(i.value),a.value=y.value===0?"":A(y.value),e.sellerId=e.id,e.salesBefore=i,e.salesPlan=y,e.budgetPlan=k,g("addToCheckedSellers",e)},i=P(()=>_.sellers.reduce((o,e)=>(isNaN(e.salesBefore)&&(e.salesBefore=0),o+e.salesBefore),0)),y=P(()=>_.sellers.reduce((o,e)=>o+e.salesPlan,0)),k=P(()=>+(y.value*O/100).toFixed(2));return(o,e)=>(m(),p(S,null,[t("li",te,[t("div",ae,[t("div",re,[t("div",oe,[t("span",ne,I(v.index+1),1),t("input",{value:d.supervisor.shortName,class:"form-control fw-bold",readonly:"",type:"text"},null,8,de)])]),t("div",ie,[f(b,{id:`${d.supervisor.id}_SV_salesBefore`,class:"fw-bold border-primary text-end",type:"text",readonly:""},null,8,["id"])]),t("div",ce,[f(b,{disabled:"disabled"})]),t("div",ue,[f(b,{id:`${d.supervisor.id}_SV_salesPlan`,class:"fw-bold border-success text-end",type:"text",readonly:""},null,8,["id"])]),me])]),(m(!0),p(S,null,V(d.sellers,(s,u)=>(m(),p(S,{key:s.id},[s.supervisorId===d.supervisor.id?(m(),F(q,{key:0,seller:s,index:u,onAddSeller:N},null,8,["seller","index"])):U("",!0)],64))),128))],64))}},_e={class:"card"},pe={class:"card-header bg-secondary text-white"},fe={class:"card-body mt-3"},he={class:"d-flex justify-content-between align-items-center"},ye=t("h4",{class:"mb-0"},"Планируемый бюджет на промо-акцию:",-1),be={class:"text-primary fw-bold mb-0"},ge=t("hr",null,null,-1),Pe={class:"fw-bold text-primary"},Se={key:0,class:"mt-5 alert alert-warning alert-dismissible fade show",role:"alert"},xe=t("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),Be={class:"mt-3 alert border-primary fade show",role:"alert"},Ie={class:"mb-0"},$e={class:"fw-bold text-primary"},Ee={key:0,class:"mt-4 alert alert-warning alert-dismissible fade show",role:"alert"},Ne=t("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),ke={key:1},we=t("p",null,"Введите план для торговых представителей, участвующих в акции.",-1),Te={class:"list-group"},Ae=H('<li class="list-group-item m-0 px-2"><div class="row g-2 text-center align-items-center p-0"><div class="col-md-5 col-sm-12">ФИО</div><div class="col-md-2 col-sm-6">Продажи, факт</div><div class="col-md-2 col-sm-6">План, %</div><div class="col-md-2 col-sm-6">Продажи, план</div><div class="col-md-1 col-sm-6">Del</div></div></li>',1),Ce={class:"list-group-item m-0 px-2 bg-warning-light"},Oe={class:"row g-2 text-center align-items-center p-0"},Ve=t("div",{class:"col-md-5 col-sm-12"},[t("span",{class:"fw-bold"},"ИТОГО")],-1),Fe={class:"col-md-2 col-sm-6"},Re={class:"col-md-2 col-sm-6"},je={class:"col-md-2 col-sm-6"},Le=t("div",{class:"col-md-1 col-sm-6"},null,-1),Ge={__name:"SalesPeopleBoost",props:{title:{type:String,required:!0,default:"Title is required"},customerId:{type:Number,required:!0},customerName:{type:String,default:""}},emits:["addSellersToPromo"],setup(v,{emit:E}){const{get:d}=z();W();const g=()=>({sellerId:"",salesBefore:0,salesPlan:0,surplusPlan:0,salesAfter:0,budgetPlan:0,budgetActual:0}),_=v,N=E,i=L({sellers:[],checkedSellers:[],form:g()}),y=async l=>{const{status:r,data:n}=await d(`${Q.CUSTOMER}/${l}`,{params:{customer_sellers:!0}});r==="success"&&(i.sellers=n.sellers)},k=P(()=>i.sellers.filter(l=>l.isActive).filter(l=>l.isSupervisor).map(l=>({...l,...i.form,compensation:O}))),o=P(()=>i.sellers.filter(l=>l.isActive).filter(l=>!l.isSupervisor).map(l=>({...l,...i.form,compensation:C}))),e=l=>{const r=i.checkedSellers.findIndex(n=>n.id===l.id);r===-1?i.checkedSellers.push(l):i.checkedSellers[r]={...l},N("addSellersToPromo",i.checkedSellers,s.value,u.value,a.value)},s=P(()=>i.checkedSellers.reduce((l,r)=>((r.isSupervisor||r.supervisorId===null)&&(l+=parseInt(r.salesBefore)),l),0)),u=P(()=>i.checkedSellers.reduce((l,r)=>((r.isSupervisor||r.supervisorId===null)&&(l+=r.salesPlan),l),0)),a=P(()=>i.checkedSellers.reduce((l,r)=>l+parseInt(r.budgetPlan),0));return M(()=>_.customerId,async l=>{await y(l),i.checkedSellers=[]}),(l,r)=>{const n=G("RouterLink");return m(),p("div",null,[t("div",_e,[t("div",pe,I(_.title),1),t("div",fe,[t("div",he,[ye,t("h4",be,I(isNaN(a.value)?"0":B($)(a.value))+" руб.",1)]),ge,t("h5",null,[x("Мотивация для расчёта бюджета: "),t("span",Pe," СВ: "+I(B(O))+" % ТП: "+I(B(C))+" %",1)]),_.customerId?(m(),p(S,{key:1},[t("div",Be,[t("h5",Ie,[x("Дистрибутор: "),t("span",$e,I(_.customerName),1)])]),i.sellers.length===0?(m(),p("div",Ee,[Ne,x(" В команду дистрибьютора не добавлено ни одного торгового представителя. "),f(n,{to:{name:"Manager.Customer.View",params:{id:_.customerId}},class:"fw-bold"},{default:j(()=>[x("Перейдите в карточку контрагента")]),_:1},8,["to"]),x(' на вкладку "Команда ТП" и добавьте торговых представителей. ')])):(m(),p("div",ke,[we,t("ul",Te,[Ae,(m(!0),p(S,null,V(k.value,(c,h)=>(m(),F(ve,{key:c.id,index:h,sellers:o.value,supervisor:c,onAddToCheckedSellers:e},null,8,["index","sellers","supervisor"]))),128)),(m(!0),p(S,null,V(o.value,(c,h)=>(m(),p(S,{key:c.id},[c.supervisorId===null?(m(),F(q,{key:0,seller:c,index:h,onAddSeller:e},null,8,["seller","index"])):U("",!0)],64))),128)),t("li",Ce,[t("div",Oe,[Ve,t("div",Fe,[f(b,{value:isNaN(s.value)?"":B($)(s.value),class:"fw-bold border-secondary text-end",type:"text",readonly:""},null,8,["value"])]),t("div",Re,[f(b,{disabled:"disabled"})]),t("div",je,[f(b,{value:B(A)(u.value),class:"fw-bold border-secondary text-end",type:"text",readonly:""},null,8,["value"])]),Le])])])]))],64)):(m(),p("div",Se,[xe,x(" Выберите дистрибутора в общих настройках промо-акции для подгрузки его торгового персонала. ")]))])])])}}};export{Ge as default};
