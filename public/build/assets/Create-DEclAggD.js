const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TheDiscount-XxY17pGj.js","assets/app-CcRn7-yu.js","assets/app-ClSdrvIZ.css","assets/useHttpService-F7Gi0evP.js","assets/formatters-hPmLyB9N.js","assets/TheModal-BP7wSSzT.js","assets/TwoColumnRow-DboPzJPi.js","assets/SalesPeopleBoost-B4NGosmL.js","assets/useArrayHandlers-HI3WadKX.js","assets/GiftForPurchase-Cf0aAqQ5.js","assets/Modal-BjgBNvva.js","assets/RetailersBoost-C5glMutk.js"])))=>i.map(i=>d[i]);
import{o as i,c,f as t,t as y,g as n,w as a,j as u,T as N,u as de,a as ae,b as ie,a3 as V,r as H,e as ne,a1 as w,H as B,d as F,p as m,s as v,I as S,F as h,h as I,i as s,q as O,m as p,M as ce,x as ue,l as P,a4 as T,a5 as j,B as _e,a6 as me,a7 as pe,n as he,a8 as G,a9 as k,aa as A}from"./app-CcRn7-yu.js";import{u as ye}from"./useHttpService-F7Gi0evP.js";import{a as W}from"./formatters-hPmLyB9N.js";import{u as fe}from"./useArrayHandlers-HI3WadKX.js";import{_ as K}from"./Modal-BjgBNvva.js";var U={};Object.defineProperty(U,"__esModule",{value:!0});var q=U.default=void 0,ve={days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],daysShort:["Вос","Пон","Вто","Сре","Чет","Пят","Суб"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Очистить",dateFormat:"dd.MM.yyyy",timeFormat:"HH:mm",firstDay:1};q=U.default=ve;const be={class:"card"},ge={class:"card-header bg-dark text-white"},Se={class:"card-body mt-3"},Ie={class:"d-flex justify-content-between align-items-center"},Pe=t("span",null,"Инфо по покрытию",-1),Ee=t("hr",null,null,-1),Oe=t("div",{class:"row g-3"},null,-1),Te={__name:"CoverageIncrease",props:{title:{type:String,required:!0,default:"Title is required"}},setup(E){const b=E;return(_,f)=>(i(),c("div",null,[t("div",be,[t("div",ge,y(b.title),1),t("div",Se,[t("div",Ie,[Pe,t("button",{onClick:f[0]||(f[0]=(...g)=>_.addProductModalInit&&_.addProductModalInit(...g)),class:"btn btn-success",type:"button"}," Добавить ")]),Ee])]),n(K,{id:"modalPopUp","close-func":_.closeModal,"custom-classes":["modal-lg"]},{title:a(()=>[u(" Добавление ассортимента для промо-акции ")]),body:a(()=>[Oe]),footer:a(()=>[n(N,{onClick:_.addProduct,type:"button",class:"btn-success w-25",disabled:!_.isFormValid},{default:a(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},ke={class:"card"},Ae={class:"card-header bg-danger text-white"},Re={class:"card-body mt-3"},xe={class:"d-flex justify-content-between align-items-center"},Ce=t("span",null,"Ассортимент для промо-акции",-1),De=t("hr",null,null,-1),we=t("div",{class:"row g-3"},null,-1),Be={__name:"TheInOut",props:{title:{type:String,required:!0,default:"Title is required"}},setup(E){const b=E;return(_,f)=>(i(),c("div",null,[t("div",ke,[t("div",Ae,y(b.title),1),t("div",Re,[t("div",xe,[Ce,t("button",{onClick:f[0]||(f[0]=(...g)=>_.addProductModalInit&&_.addProductModalInit(...g)),class:"btn btn-success",type:"button"}," Добавить ")]),De])]),n(K,{id:"modalPopUp","close-func":_.closeModal,"custom-classes":["modal-lg"]},{title:a(()=>[u(" Добавление ассортимента для промо-акции ")]),body:a(()=>[we]),footer:a(()=>[n(N,{onClick:_.addProduct,type:"button",class:"btn-success w-25",disabled:!_.isFormValid},{default:a(()=>[u(" Добавить ")]),_:1},8,["onClick","disabled"])]),_:1},8,["close-func"])]))}},Fe={class:"row"},qe={class:"col-lg-5"},Ne={class:"card"},Ue=t("div",{class:"card-header bg-primary text-white"},"Укажите общие данные промо-акции",-1),Le={class:"card-body mt-3"},$e={class:"row g-3"},Me={class:"col-md-6"},Ve=t("option",{disabled:"",selected:"",value:""},"- Выберите вид промо-акции -",-1),He=["value"],je={class:"col-md-6"},Ge={class:"input-group"},We=t("span",{class:"input-group-text"},"%",-1),Ke={class:"col-md-6"},ze={class:"col-md-6"},Ye=["disabled"],Je=t("option",{disabled:"",selected:"",value:""},"- Выберите канал продаж -",-1),Qe=["value"],Xe={class:"col-md-6"},Ze=["disabled"],et=t("option",{disabled:"",selected:"",value:""},"- Выберите дистрибутора -",-1),tt=["value"],ot={class:"col-md-6"},st=["disabled"],rt=t("option",{disabled:"",selected:"",value:""},"- Выберите торговую сеть -",-1),lt=["value"],dt={class:"col-md-6"},at=t("option",{disabled:"",selected:"",value:""},"- Выберите регион -",-1),it=["value","selected"],nt={class:"col-md-6"},ct=t("option",{disabled:"",selected:"",value:""},"- Выберите город -",-1),ut=["value","selected"],_t={class:"col-md-6"},mt=t("div",{id:"start_date_help",class:"form-text"},"укажите дату начала акции",-1),pt={class:"col-md-6"},ht=t("div",{id:"end_date_help",class:"form-text"},"укажите дату окончания акции",-1),yt={class:"col-md-6"},ft={class:"input-group"},vt=["disabled"],bt={key:0,class:"input-group-text border-success bg-success text-white px-4"},gt={key:1,class:"input-group-text border-warning bg-warning px-4"},St=t("div",{id:"products_help",class:"form-text"},"только для скидочных акций",-1),It={class:"col-md-6"},Pt={class:"input-group"},Et=["disabled"],Ot={key:0,class:"input-group-text border-success bg-success text-white px-4"},Tt={key:1,class:"input-group-text border-warning bg-warning px-4"},kt=t("div",{id:"sellers_help",class:"form-text"},"только для мотивации ТП",-1),At={class:"col-12"},Rt={class:"card-footer"},xt={class:"col-lg-7"},Ct=t("p",null,"Loading...",-1),Dt=t("p",null,"Loading...",-1),wt=t("p",null,"Loading...",-1),Bt=t("p",null,"Loading...",-1),Ft={key:6,class:"alert alert-warning alert-dismissible fade show",role:"alert"},qt=t("h4",{class:"alert-heading"},"Детали промо-акции",-1),Nt=t("p",null,"Здесь будут выведены поля для ввода ассортимента, команды торговых представителей и др. в зависимости от выбранного вида промо-акции.",-1),Ut=t("hr",null,null,-1),Lt=t("p",null,"Выберите вид промо-акции в выпадающем списке в панели общих настроек промо-акции.",-1),$t=[qt,Nt,Ut,Lt],Wt={__name:"Create",setup(E){const{get:b,post:_}=ye(),f=de(),g=ae(),z=_e(),L=ie().getUser,R=fe();V("#start_date",{locale:q,startDate:me,onSelect:({date:d,datepicker:r})=>{e.promo.startDate=W(d),r.hide()}}),V("#end_date",{locale:q,startDate:pe,onSelect:({date:d,datepicker:r})=>{e.promo.endDate=W(d),r.hide()}});const Y=k({loader:()=>A(()=>import("./TheDiscount-XxY17pGj.js"),__vite__mapDeps([0,1,2,3,4,5,6]))}),J=k({loader:()=>A(()=>import("./SalesPeopleBoost-B4NGosmL.js"),__vite__mapDeps([7,1,2,3,8,4]))}),Q=k(()=>A(()=>import("./GiftForPurchase-Cf0aAqQ5.js"),__vite__mapDeps([9,1,2,10]))),X=k({loader:()=>A(()=>import("./RetailersBoost-C5glMutk.js"),__vite__mapDeps([11,1,2,10]))}),$=()=>({promoType:"",promoForRetail:!1,discount:null,userId:L.id,channelId:"",customerId:"",retailerId:"",regionId:"",cityId:"",startDate:"",endDate:"",comments:"",totalSalesBefore:0,totalSalesPlan:0,totalBudgetPlan:0,products:[],sellers:[]}),e=H({customers:[],retailers:[],cities:[],channels:[],customerName:"",retailerName:"",promo:$()});let l=H({isForRetail:!1,type:"",title:"",code:""});ne(async()=>{e.promo=$(),await ee()});const Z=async d=>{const{data:r}=await b(w.CHANNEL);e.channels=r.channels.filter(o=>o.isForRetail===d.isForRetail)},ee=async()=>{const{data:d}=await b(w.CUSTOMER,{params:{region:!0,city:!0,user:!0,retailers:!0}});e.customers=d.customers};B(()=>e.promo.promoType,async d=>{const r=d;l=G.find(o=>o.type===r),e.promo.promoForRetail=l.isForRetail,e.promo.discount=null,e.promo.channelId="",e.promo.customerId="",e.promo.retailerId="",e.promo.regionId="",e.promo.cityId="",e.promo.products=[],e.promo.sellers=[],await Z(l)}),B(()=>e.promo.customerId,d=>{if(d!==""){const r=e.customers.find(o=>+o.id==+d);e.promo.regionId=r.region.id,e.promo.cityId=r.city.id,e.promo.products=[],e.promo.sellers=[],e.customerName=r.name,e.promo.retailerId="",e.customers.map(o=>{+o.id==+d&&(e.retailers=o.retailers)})}else e.customerName=d.toString()}),B(()=>e.promo.retailerId,d=>{e.retailerName=d!==""?e.retailerName=e.retailers.find(r=>+r.id==+d).name:d.toString()});const te=(d,r,o,C)=>{e.promo.products=d,e.promo.totalSalesBefore=r,e.promo.totalSalesPlan=o,e.promo.totalBudgetPlan=C},oe=(d,r,o,C)=>{e.promo.sellers=d.filter(D=>(D.salesBefore!==0||D.salesBefore!==null)&&D.salesPlan!==0),e.promo.totalSalesBefore=r,e.promo.totalSalesPlan=o,e.promo.totalBudgetPlan=C},M=()=>l.type==="DISCOUNT"&&e.promo.products.length>0||l.type==="SALES_PEOPLE_BOOST"&&e.promo.sellers.length>0,se=async()=>{const d=await _(w.PROMO,e.promo);d&&d.status==="success"&&(f.clear(),await z.push({name:"Manager.Promo.Index"}))},x=F(()=>R.sortArrayByStringColumn(e.customers,"name")),re=F(()=>R.getUniqueObjectsFromArray(x.value.map(d=>d.region))),le=F(()=>R.getUniqueObjectsFromArray(x.value.map(d=>d.city)));return(d,r)=>(i(),c("div",Fe,[t("div",qe,[t("div",Ne,[Ue,t("div",Le,[n(he),t("div",$e,[t("div",Me,[n(m,{for:"promo_type",required:""},{default:a(()=>[u("Вид промо-акции")]),_:1}),v(t("select",{"onUpdate:modelValue":r[0]||(r[0]=o=>e.promo.promoType=o),id:"promo_type",class:"form-select"},[Ve,(i(!0),c(h,null,I(s(G),o=>(i(),c("option",{key:o.id,value:o.type},y(o.title),9,He))),128))],512),[[S,e.promo.promoType]])]),t("div",je,[n(m,{for:"discount",required:s(l).type==="DISCOUNT"},{default:a(()=>[u("Величина скидки")]),_:1},8,["required"]),t("div",Ge,[n(O,{id:"discount",modelValue:e.promo.discount,"onUpdate:modelValue":r[1]||(r[1]=o=>e.promo.discount=o),type:"number",min:"5",step:"1",max:"50",disabled:s(l).type!=="DISCOUNT"},null,8,["modelValue","disabled"]),We])]),t("div",Ke,[n(m,{for:"user_id"},{default:a(()=>[u("Менеджер")]),_:1}),n(O,{id:"user_id",type:"text",value:s(L).fullName,disabled:"disabled"},null,8,["value"])]),t("div",ze,[n(m,{for:"channel_id",required:s(l).type!==""},{default:a(()=>[u("Канал продаж")]),_:1},8,["required"]),v(t("select",{"onUpdate:modelValue":r[2]||(r[2]=o=>e.promo.channelId=o),id:"channel_id",class:"form-select",disabled:s(l).type===""},[Je,(i(!0),c(h,null,I(e.channels,o=>(i(),c("option",{key:o.id,value:o.id},y(o.name),9,Qe))),128))],8,Ye),[[S,e.promo.channelId]])]),t("div",Xe,[n(m,{for:"customer_id",required:s(l).type!==""},{default:a(()=>[u("Дистрибутор")]),_:1},8,["required"]),v(t("select",{"onUpdate:modelValue":r[3]||(r[3]=o=>e.promo.customerId=o),id:"customer_id",class:"form-select",disabled:s(l).type===""},[et,(i(!0),c(h,null,I(x.value,o=>(i(),c("option",{key:o.id,value:o.id},y(o.name),9,tt))),128))],8,Ze),[[S,e.promo.customerId]])]),t("div",ot,[n(m,{for:"retailer_id",required:e.retailers.length>0&&s(l).isForRetail===!0},{default:a(()=>[u("Торговая сеть")]),_:1},8,["required"]),v(t("select",{"onUpdate:modelValue":r[4]||(r[4]=o=>e.promo.retailerId=o),id:"retailer_id",class:"form-select",disabled:e.retailers.length===0||!s(l).isForRetail},[rt,(i(!0),c(h,null,I(e.retailers,o=>(i(),c("option",{key:o.id,value:o.id},y(o.name),9,lt))),128))],8,st),[[S,e.promo.retailerId]])]),t("div",dt,[n(m,{for:"region_id",required:""},{default:a(()=>[u("Регион")]),_:1}),v(t("select",{"onUpdate:modelValue":r[5]||(r[5]=o=>e.promo.regionId=o),id:"region_id",class:"form-select",disabled:"disabled"},[at,(i(!0),c(h,null,I(re.value,o=>(i(),c("option",{key:o.id,value:o.id,selected:e.promo.regionId},y(o.name),9,it))),128))],512),[[S,e.promo.regionId]])]),t("div",nt,[n(m,{for:"city_id",required:""},{default:a(()=>[u("Город")]),_:1}),v(t("select",{"onUpdate:modelValue":r[6]||(r[6]=o=>e.promo.cityId=o),id:"city_id",class:"form-select",disabled:"disabled"},[ct,(i(!0),c(h,null,I(le.value,o=>(i(),c("option",{key:o.id,value:o.id,selected:e.promo.cityId},y(o.name),9,ut))),128))],512),[[S,e.promo.cityId]])]),t("div",_t,[n(m,{for:"start_date",required:""},{default:a(()=>[u("Начало промо-акции")]),_:1}),n(O,{id:"start_date",type:"text",readonly:"readonly","aria-describedby":"start_date_help"}),mt]),t("div",pt,[n(m,{for:"end_date",required:""},{default:a(()=>[u("Окончание промо-акции")]),_:1}),n(O,{id:"end_date",type:"text",readonly:"readonly","aria-describedby":"end_date_help"}),ht]),t("div",yt,[n(m,{for:"products",required:s(l).isForRetail===!0},{default:a(()=>[u("Ассортимент для акции")]),_:1},8,["required"]),t("div",ft,[t("input",{id:"products",type:"text",class:"form-control",value:"Ассортимент добавлен?","aria-describedby":"products_help",disabled:!s(l).isForRetail,readonly:""},null,8,vt),s(l).isForRetail===!0?(i(),c(h,{key:0},[e.promo.products.length>0?(i(),c("span",bt,"Да")):(i(),c("span",gt,"Нет"))],64)):p("",!0)]),St]),t("div",It,[n(m,{for:"sellers",required:s(l).type==="SALES_PEOPLE_BOOST"},{default:a(()=>[u("Команда ТП")]),_:1},8,["required"]),t("div",Pt,[t("input",{id:"sellers",type:"text",class:"form-control",value:"Команда добавлена?","aria-describedby":"sellers_help",disabled:s(l).type!=="SALES_PEOPLE_BOOST",readonly:""},null,8,Et),s(l).type==="SALES_PEOPLE_BOOST"?(i(),c(h,{key:0},[e.promo.sellers.length>0?(i(),c("span",Ot,"Да")):(i(),c("span",Tt,"Нет"))],64)):p("",!0)]),kt]),t("div",At,[n(m,{for:"comments"},{default:a(()=>[u("Механика промо-акции")]),_:1}),v(t("textarea",{id:"comments","onUpdate:modelValue":r[7]||(r[7]=o=>e.promo.comments=o),class:"form-control",style:{height:"100px"}},null,512),[[ce,e.promo.comments]])])])]),t("div",Rt,[n(N,{onClick:se,class:ue(["btn-primary",{"btn-cursor-not-allowed":!M()}]),disabled:s(g).isButtonDisabled||!M(),loading:s(g).isButtonDisabled},{default:a(()=>[u("Сохранить ")]),_:1},8,["class","disabled","loading"])])])]),t("div",xt,[s(l).type==="DISCOUNT"?(i(),P(T,{key:0},{default:a(()=>[n(s(Y),{title:s(l).title,"customer-name":e.customerName,"retailer-name":e.retailerName,onAddProductsToPromo:te},null,8,["title","customer-name","retailer-name"])]),fallback:a(()=>[Ct]),_:1})):p("",!0),s(l).type==="SALES_PEOPLE_BOOST"?(i(),P(T,{key:1},{default:a(()=>[n(s(J),{title:s(l).title,"customer-id":e.promo.customerId,"customer-name":e.customerName,onAddSellersToPromo:oe},null,8,["title","customer-id","customer-name"])]),fallback:a(()=>[Dt]),_:1})):p("",!0),s(l).type==="GIFT_FOR_PURCHASE"?(i(),P(T,{key:2},{default:a(()=>[n(s(Q),{title:s(l).title},null,8,["title"])]),fallback:a(()=>[wt]),_:1})):p("",!0),s(l).type==="RETAILERS_BOOST"?(i(),P(T,{key:3},{default:a(()=>[n(s(X),{title:s(l).title},null,8,["title"])]),fallback:a(()=>[Bt]),_:1})):p("",!0),s(l).type==="COVERAGE_INCREASE"?(i(),P(j(Te),{key:4,title:s(l).title},null,8,["title"])):p("",!0),s(l).type==="IN_OUT"?(i(),P(j(Be),{key:5,title:s(l).title},null,8,["title"])):p("",!0),s(l).type===""?(i(),c("div",Ft,$t)):p("",!0)])]))}};export{Wt as default};
